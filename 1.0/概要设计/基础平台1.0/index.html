
<!DOCTYPE html>

<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="基础平台" name="description"/>
<meta content="罗潇" name="author"/>
<link href="../" rel="prev"/>
<link href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/" rel="next"/>
<link href="../../assets/meta/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.3.1" name="generator"/>
<title>基础平台1.0 - 基础平台</title>
<link href="../../assets/stylesheets/main.046329b4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.85d0ee34.min.css" rel="stylesheet"/>
<style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6v2Z"/></svg>');}</style>
<link href="../../assets/css/custom_attributes.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
<link href="https://unpkg.com/tippy.js@6/animations/scale-subtle.css" rel="stylesheet"/>
<link href="https://unpkg.com/tippy.js@6/themes/translucent.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" referrerpolicy="no-referrer" rel="stylesheet"/>
<meta content="None" name="site_url"/>
<meta content="基础平台1.0" property="og:title"/>
<meta content="基础平台1.0" name="twitter:title"/>
<meta content="基础平台" name="og:description"/>
<meta content="基础平台" name="twitter:description"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Noneassets/meta/SEO.png" property="og:image"/>
<meta content="Noneassets/meta/SEO.png" name="twitter:image"/>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="light-blue" data-md-color-primary="teal" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#11">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="基础平台" class="md-header__button md-logo" data-md-component="logo" href="../.." title="基础平台">
<img alt="logo" src="../../assets/meta/favicons.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            基础平台
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              基础平台1.0
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="teal" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<a aria-label="分享" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="分享">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0/">
          
  
    
  
  架构设计

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/">
          
  
    
  
  概要设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/%E5%B8%90%E5%8F%B7%E6%A0%B8%E6%9F%A5%E6%94%B9%E7%9B%B8%E5%85%B3/">
          
  
    
  
  详细设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">
          
  
    
  
  数据库设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E5%9F%BA%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
          
  
    
  
  接口设计

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="基础平台" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="基础平台">
<img alt="logo" src="../../assets/meta/favicons.png"/>
</a>
    基础平台
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    架构设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            架构设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0/">
<span class="md-ellipsis">
    基础平台1.0
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    概要设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            概要设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0总体设计
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
<span class="md-ellipsis">
    功能设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_2">
<span class="md-nav__icon md-icon"></span>
            功能设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0用户管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0系统管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E4%BA%A7%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0资产管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1/">
<span class="md-ellipsis">
    基础平台1.0系统后台服务
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    详细设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            详细设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/%E5%B8%90%E5%8F%B7%E6%A0%B8%E6%9F%A5%E6%94%B9%E7%9B%B8%E5%85%B3/">
<span class="md-ellipsis">
    帐号核查改相关
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    数据库设计
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            数据库设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    接口设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            接口设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E5%9F%BA%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
<span class="md-ellipsis">
    基础平台1.0基事件源设计文档
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/">
<span class="md-ellipsis">
    基础平台1.0接口设计规范
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%94%A8%E6%88%B7api%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0用户api设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9Fapi%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0系统api设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
<span class="md-ellipsis">
    基础平台1.0系统管理事件源设计文档
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E6%BA%90%E4%B8%AD%E5%BF%83API%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0资源中心API接口设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E6%BA%90%E4%B8%AD%E5%BF%83%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0资源中心事件源设计
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#11">
    1.1 总体设计
  </a>
<nav aria-label="1.1 总体设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111">
    1.1.1 数据库设计
  </a>
<nav aria-label="1.1.1 数据库设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1111">
    1.1.1.1 用户中心
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112">
    1.1.1.2 资源中心
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1113">
    1.1.1.3 系统管理
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#112">
    1.1.2 缓存机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#113">
    1.1.3 国际化
  </a>
<nav aria-label="1.1.3 国际化" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1131">
    1.1.3.1 后端国际化
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1132">
    1.1.3.2 前端国际化
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#114">
    1.1.4 日志处理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#115">
    1.1.5 密钥管理
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    功能概要设计
  </a>
<nav aria-label="功能概要设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111_1">
    1.1.1 用户管理
  </a>
<nav aria-label="1.1.1 用户管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1111_1">
    1.1.1.1 组织管理
  </a>
<nav aria-label="1.1.1.1 组织管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11111">
    1.1.1.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11112">
    1.1.1.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111121">
    1.1.1.1.2.1组织机构列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111122">
    1.1.1.1.2.2组织机构新增
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111123">
    1.1.1.1.2.3组织机构修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111124">
    1.1.1.1.2.4组织机构拖拽
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111125">
    1.1.1.1.2.5组织机构删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111126">
    1.1.1.1.2.6组织机构导入模板下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111127">
    1.1.1.1.2.7组织机构导入
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111128">
    1.1.1.1.2.8组织机构导出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11113">
    1.1.1.1.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112_1">
    1.1.1.2 用户管理
  </a>
<nav aria-label="1.1.1.2 用户管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11121">
    1.1.1.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11122">
    1.1.1.2.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111221">
    1.1.1.2.2.1用户列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111222">
    1.1.1.2.2.2用户新增
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111223">
    1.1.1.2.2.3用户修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111224">
    1.1.1.2.2.4用户复制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111225">
    1.1.1.2.2.5用户删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111226">
    1.1.1.2.2.6用户锁定解锁
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111227">
    1.1.1.2.2.7用户导入模板下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111228">
    1.1.1.2.2.8用户导入
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111229">
    1.1.1.2.2.9用户导出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112210">
    1.1.1.2.2.10用户绑定系统角色
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11123">
    1.1.1.2.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1113otp">
    1.1.1.3 OTP管理
  </a>
<nav aria-label="1.1.1.3 OTP管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11131">
    1.1.1.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11132">
    1.1.1.3.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111321">
    1.1.1.3.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111322otp">
    1.1.1.3.2.2国际/国密OTP新增
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111323">
    1.1.1.3.2.3删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111324otp">
    1.1.1.3.2.4OTP绑定用户
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11133">
    1.1.1.3.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1114">
    1.1.1.4 用户核查
  </a>
<nav aria-label="1.1.1.4 用户核查" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11141">
    1.1.1.4.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11142">
    1.1.1.4.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111421">
    1.1.1.4.2.1核查定时任务
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111422">
    1.1.1.4.2.2核查结果
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11143">
    1.1.1.4.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1115">
    1.1.1.5 用户口令策略
  </a>
<nav aria-label="1.1.1.5 用户口令策略" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11151">
    1.1.1.5.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11152">
    1.1.1.5.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111521">
    1.1.1.5.2.1密码长度限制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111522">
    1.1.1.5.2.2密码复杂度限制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111523">
    1.1.1.5.2.3密码周期限制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111524">
    1.1.1.5.2.4密码历史比对
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111525">
    1.1.1.5.2.5密码错误登录锁定
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111526">
    1.1.1.5.2.6内置弱口令校验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11153">
    1.1.1.5.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1116">
    1.1.1.6 扩展属性管理
  </a>
<nav aria-label="1.1.1.6 扩展属性管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11161">
    1.1.1.6.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11162">
    1.1.1.6.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111621">
    1.1.1.6.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111622">
    1.1.1.6.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111623">
    1.1.1.6.2.3删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11163">
    1.1.1.6.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1117">
    1.1.1.7 数据同步
  </a>
<nav aria-label="1.1.1.7 数据同步" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11171">
    1.1.1.7.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11172">
    1.1.1.7.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111_2">
    1.1.1 资源管理
  </a>
<nav aria-label="1.1.1 资源管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1111_2">
    1.1.1.1 资源组管理
  </a>
<nav aria-label="1.1.1.1 资源组管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11111_1">
    1.1.1.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11112_1">
    1.1.1.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11113_1">
    1.1.1.1.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112_2">
    1.1.1.2 系统资源管理
  </a>
<nav aria-label="1.1.1.2 系统资源管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11121_1">
    1.1.1.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11122_1">
    1.1.1.2.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111221_1">
    1.1.1.2.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111222_1">
    1.1.1.2.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111223_1">
    1.1.1.2.2.3导入/导出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111224_1">
    1.1.1.2.2.4删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11123_1">
    1.1.1.2.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1113_1">
    1.1.1.3 应用资源管理
  </a>
<nav aria-label="1.1.1.3 应用资源管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11131_1">
    1.1.1.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11132_1">
    1.1.1.3.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111321_1">
    1.1.1.3.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111322">
    1.1.1.3.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111323_1">
    1.1.1.3.2.3导入/导出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111324">
    1.1.1.3.2.4删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11133_1">
    1.1.1.3.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1114_1">
    1.1.1.4 帐号管理
  </a>
<nav aria-label="1.1.1.4 帐号管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11141_1">
    1.1.1.4.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11142_1">
    1.1.1.4.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111421_1">
    1.1.1.4.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111422_1">
    1.1.1.4.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111423">
    1.1.1.4.2.3删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11143_1">
    1.1.1.4.3导入/导出
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11144">
    1.1.1.4.4数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1115_1">
    1.1.1.5 登录协议管理
  </a>
<nav aria-label="1.1.1.5 登录协议管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11151_1">
    1.1.1.5.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11152_1">
    1.1.1.5.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111521_1">
    1.1.1.5.2.1查询
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111522_1">
    1.1.1.5.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111523_1">
    1.1.1.5.2.3删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11153_1">
    1.1.1.5.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1116_1">
    1.1.1.6 资源口令策略
  </a>
<nav aria-label="1.1.1.6 资源口令策略" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11161_1">
    1.1.1.6.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11162_1">
    1.1.1.6.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111621_1">
    1.1.1.6.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111622_1">
    1.1.1.6.2.2新增/编辑
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111623_1">
    1.1.1.6.2.3内置弱口令校验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111624">
    1.1.1.6.2.4删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11163_1">
    1.1.1.6.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1117_1">
    1.1.1.7 帐号核查
  </a>
<nav aria-label="1.1.1.7 帐号核查" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11171_1">
    1.1.1.7.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11172_1">
    1.1.1.7.2核查流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111721">
    1.1.1.7.2.1帐号采集流程图
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111722">
    1.1.1.7.2.2帐号核查流程图
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11173">
    1.1.1.7.3功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111731">
    1.1.1.7.3.1核查结果
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111732">
    1.1.1.7.3.2核查任务
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111733">
    1.1.1.7.3.3核查策略
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11174">
    1.1.1.7.4数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1118">
    1.1.1.8 扩展属性管理
  </a>
<nav aria-label="1.1.1.8 扩展属性管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11181">
    1.1.1.8.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11182">
    1.1.1.8.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111821">
    1.1.1.8.2.1列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111822">
    1.1.1.8.2.2新增/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111823">
    1.1.1.8.2.3删除
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11183">
    1.1.1.8.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1119">
    1.1.1.9 数据同步
  </a>
<nav aria-label="1.1.1.9 数据同步" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11191">
    1.1.1.9.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11192">
    1.1.1.9.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111_3">
    1.1.1 系统管理
  </a>
<nav aria-label="1.1.1 系统管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1111_3">
    1.1.1.1 能力组件管理
  </a>
<nav aria-label="1.1.1.1 能力组件管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11111_2">
    1.1.1.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11112_2">
    1.1.1.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111121_1">
    1.1.1.1.2.1获取能力组件列表
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111122_1">
    1.1.1.1.2.2新增能力组件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111123_1">
    1.1.1.1.2.3修改能力组件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111124_1">
    1.1.1.1.2.4删除能力组件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111125_1">
    1.1.1.1.2.5能力组件状态上报接收接口
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111126_1">
    1.1.1.1.2.6能力组件关联资源组
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111127_1">
    1.1.1.1.2.7能力组件关联组织机构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11113_2">
    1.1.1.1.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112_3">
    1.1.1.2 系统主备管理
  </a>
<nav aria-label="1.1.1.2 系统主备管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11121_2">
    1.1.1.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11122_2">
    1.1.1.2.2主备流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111221_2">
    1.1.1.2.2.1配置主机热备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111222_2">
    1.1.1.2.2.2备机申请加入主备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111223_2">
    1.1.1.2.2.3主机同意备机加入主备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111224_2">
    1.1.1.2.2.4停止主机热备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111225_1">
    1.1.1.2.2.5停止备机热备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11123_2">
    1.1.1.2.3功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111231">
    1.1.1.2.3.1主备配置约束条件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111232">
    1.1.1.2.3.2进入主备菜单
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111233">
    1.1.1.2.3.3查看主备信息
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111234">
    1.1.1.2.3.4配置主机热备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111235">
    1.1.1.2.3.5配置备机热备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111236">
    1.1.1.2.3.6主备上报事件接收
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111237">
    1.1.1.2.3.7处理主备上报事件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111238">
    1.1.1.2.3.8相关服务监控
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111239">
    1.1.1.2.3.9主备事件通知接收人配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112310">
    1.1.1.2.3.10版本信息提供
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112311">
    1.1.1.2.3.11同步的数据库表信息
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1113_2">
    1.1.1.3 系统参数配置
  </a>
<nav aria-label="1.1.1.3 系统参数配置" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11131_2">
    1.1.1.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11132_2">
    1.1.1.3.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111321_2">
    1.1.1.3.2.1登录配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111322_1">
    1.1.1.3.2.2业务参数配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111323_2">
    1.1.1.3.2.3系统配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111324_1">
    1.1.1.3.2.4通知服务配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11133_2">
    1.1.1.3.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1114_2">
    1.1.1.4 系统权限管理
  </a>
<nav aria-label="1.1.1.4 系统权限管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11141_2">
    1.1.1.4.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11142_2">
    1.1.1.4.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111421_2">
    1.1.1.4.2.1查询角色树
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111422_2">
    1.1.1.4.2.2新增/修改角色
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111423_1">
    1.1.1.4.2.3删除角色
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111424">
    1.1.1.4.2.4查询/更新角色下功能权限
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111425">
    1.1.1.4.2.5查询/更新角色下数据权限
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111426">
    1.1.1.4.2.6角色下用户查询/修改
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111427">
    1.1.1.4.2.7查询用户菜单树
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111428">
    1.1.1.4.2.8 
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11143_2">
    1.1.1.4.3数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1115_2">
    1.1.1.5 系统日志管理
  </a>
<nav aria-label="1.1.1.5 系统日志管理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11151_2">
    1.1.1.5.1系统登录日志
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111511">
    1.1.1.5.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111512">
    1.1.1.5.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11152_2">
    1.1.1.5.2系统操作日志
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111521_2">
    1.1.1.5.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111522_2">
    1.1.1.5.2.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11153_2">
    1.1.1.5.3系统日志
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111531">
    1.1.1.5.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111532">
    1.1.1.5.3.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1116_2">
    1.1.1.6 系统配置
  </a>
<nav aria-label="1.1.1.6 系统配置" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11161_2">
    1.1.1.6.1邮件配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111611">
    1.1.1.6.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111612">
    1.1.1.6.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111613">
    1.1.1.6.1.3数据结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11162_2">
    1.1.1.6.2短信配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111621_2">
    1.1.1.6.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111622_2">
    1.1.1.6.2.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111623_2">
    1.1.1.6.2.3数据结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11163https">
    1.1.1.6.3HTTPS配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111631">
    1.1.1.6.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111632">
    1.1.1.6.3.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11164">
    1.1.1.6.4日志外发配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111641">
    1.1.1.6.4.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111642">
    1.1.1.6.4.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11165">
    1.1.1.6.5电源管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111651">
    1.1.1.6.5.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111652">
    1.1.1.6.5.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11166">
    1.1.1.6.6网络配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111661">
    1.1.1.6.6.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111662">
    1.1.1.6.6.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11167">
    1.1.1.6.7时间管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111671">
    1.1.1.6.7.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111672">
    1.1.1.6.7.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11111_3">
    1.1.1.1.1配置备份
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111673">
    1.1.1.6.7.3功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111674">
    1.1.1.6.7.4功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111675">
    1.1.1.6.7.5数据结构
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1117_2">
    1.1.1.7 系统信息
  </a>
<nav aria-label="1.1.1.7 系统信息" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11171_2">
    1.1.1.7.1系统组件管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111711">
    1.1.1.7.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111712">
    1.1.1.7.1.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11172_2">
    1.1.1.7.2系统升级
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111721_1">
    1.1.1.7.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111722_1">
    1.1.1.7.2.2功能设计
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11173license">
    1.1.1.7.3License管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111731_1">
    1.1.1.7.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111732_1">
    1.1.1.7.3.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1118_1">
    1.1.1.8 系统登录
  </a>
<nav aria-label="1.1.1.8 系统登录" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11181_1">
    1.1.1.8.1统一登录界面
  </a>
<nav aria-label="1.1.1.8.1统一登录界面" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111811">
    1.1.1.8.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111812">
    1.1.1.8.1.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11182_1">
    1.1.1.8.2自服务
  </a>
<nav aria-label="1.1.1.8.2自服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111821_1">
    1.1.1.8.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111822_1">
    1.1.1.8.2.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111_4">
    1.1.1 系统后台服务
  </a>
<nav aria-label="1.1.1 系统后台服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1111_4">
    1.1.1.1 通知服务
  </a>
<nav aria-label="1.1.1.1 通知服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11111_4">
    1.1.1.1.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11112_3">
    1.1.1.1.2功能设计
  </a>
<nav aria-label="1.1.1.1.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111121_2">
    1.1.1.1.2.1事件处理
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1112_4">
    1.1.1.2 邮件服务
  </a>
<nav aria-label="1.1.1.2 邮件服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11121_3">
    1.1.1.2.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11122_3">
    1.1.1.2.2功能设计
  </a>
<nav aria-label="1.1.1.2.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111221_3">
    1.1.1.2.2.1事件处理
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1113_3">
    1.1.1.3 短信服务
  </a>
<nav aria-label="1.1.1.3 短信服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11131_3">
    1.1.1.3.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11132_3">
    1.1.1.3.2功能设计
  </a>
<nav aria-label="1.1.1.3.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111321_3">
    1.1.1.3.2.1事件处理
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1114api">
    1.1.1.4 API网关
  </a>
<nav aria-label="1.1.1.4 API网关" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11141_3">
    1.1.1.4.1权限处理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11142_3">
    1.1.1.4.2路由配置
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1115_3">
    1.1.1.5 日志服务
  </a>
<nav aria-label="1.1.1.5 日志服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11151_3">
    1.1.1.5.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11152_3">
    1.1.1.5.2功能设计
  </a>
<nav aria-label="1.1.1.5.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111521_3">
    1.1.1.5.2.1日志外发
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111522_3">
    1.1.1.5.2.2系统登录日志
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111523_2">
    1.1.1.5.2.3系统操作日志
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111524_1">
    1.1.1.5.2.4系统运行日志
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1116_3">
    1.1.1.6 定时任务服务
  </a>
<nav aria-label="1.1.1.6 定时任务服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11161_3">
    1.1.1.6.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11162_3">
    1.1.1.6.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1117_3">
    1.1.1.7 数据同步服务
  </a>
<nav aria-label="1.1.1.7 数据同步服务" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11171_3">
    1.1.1.7.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11172_3">
    1.1.1.7.2功能设计
  </a>
<nav aria-label="1.1.1.7.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111721_2">
    1.1.1.7.2.1能力组件新增事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111722_2">
    1.1.1.7.2.2组织机构增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111723">
    1.1.1.7.2.3用户增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111724">
    1.1.1.7.2.4资源组增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111725">
    1.1.1.7.2.5系统资源增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111726">
    1.1.1.7.2.6应用资源增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111727">
    1.1.1.7.2.7资源帐号增删改事件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111728">
    1.1.1.7.2.8资源组关联能力组件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111729">
    1.1.1.7.2.9资源组取消关联能力组件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1117210">
    1.1.1.7.2.10能力组件删除事件数据同步
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1118root">
    1.1.1.8 系统配置服务(ROOT)
  </a>
<nav aria-label="1.1.1.8 系统配置服务(ROOT)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11181_2">
    1.1.1.8.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11182_2">
    1.1.1.8.2功能设计
  </a>
<nav aria-label="1.1.1.8.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111821_2">
    1.1.1.8.2.1 网络时间配置
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111822_2">
    1.1.1.8.2.2事件处理
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1119root">
    1.1.1.9 配置备份服务(ROOT)
  </a>
<nav aria-label="1.1.1.9 配置备份服务(ROOT)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11191_1">
    1.1.1.9.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11192_1">
    1.1.1.9.2功能设计
  </a>
<nav aria-label="1.1.1.9.2功能设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111921">
    1.1.1.9.2.1定时备份
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111922">
    1.1.1.9.2.2事件处理
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11110root">
    1.1.1.10 升级服务(ROOT)
  </a>
<nav aria-label="1.1.1.10 升级服务(ROOT)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111101">
    1.1.1.10.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111102">
    1.1.1.10.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11111root">
    1.1.1.11 主备服务(ROOT)
  </a>
<nav aria-label="1.1.1.11 主备服务(ROOT)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#111111">
    1.1.1.11.1功能描述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#111112">
    1.1.1.11.2功能设计
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->
<!-- Tags -->
<!-- Actions -->
<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->
<h1>基础平台1.0</h1>
<!-- Page content -->
<h3 id="11">1.1 <strong>总体设计</strong><a class="headerlink" href="#11" title="Permanent link">¶</a></h3>
<h4 id="111">1.1.1 <strong>数据库设计</strong><a class="headerlink" href="#111" title="Permanent link">¶</a></h4>
<h5 id="1111">1.1.1.1 <strong>用户中心</strong><a class="headerlink" href="#1111" title="Permanent link">¶</a></h5>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps33.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps33.jpg"/></a> </p>
<h5 id="1112">1.1.1.2 <strong>资源中心</strong><a class="headerlink" href="#1112" title="Permanent link">¶</a></h5>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps34.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps34.jpg"/></a> </p>
<h5 id="1113">1.1.1.3 <strong>系统管理</strong><a class="headerlink" href="#1113" title="Permanent link">¶</a></h5>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps35.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps35.jpg"/></a> </p>
<h4 id="112">1.1.2 <strong>缓存机制</strong><a class="headerlink" href="#112" title="Permanent link">¶</a></h4>
<p>Ø 使用原则</p>
<p>缓存中心把频繁读取及多个服务共用的数据缓存起来，提高数据读取的效率、减少对DB的查询，同时多个服务可以共用缓存中心的数据，避免每个服务各自缓存数据，缓存中心遵循的原则是“使用频繁或多服务公用的数据、变更不频繁的数据”。</p>
<p>Ø 读缓存机制</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps36.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps36.png"/></a> </p>
<p>以系统管理服务为例，服务查询数据时首先从缓存中读数据，第一次发现缓存中不存在相应数据，则从DB查询，并把查询到的数据写入缓存中心。第二次查询该数据时，缓存中心已存在该数据，可从缓存中心直接读取到数据，减少了DB访问。</p>
<p>Ø 清缓存机制</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps37.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps37.png"/></a> </p>
<p>为避免DB和缓存中心数据不一致的问题，当DB数据需要变更或删除时，先删除缓存中的数据，再执行DB操作。当该数据被再次使用时遵循读缓存机制，先从DB查询最新的数据，并把查询到的数据写入缓存，供后续使用。</p>
<p>Ø 定义缓存key</p>
<h4 id="113">1.1.3 <strong>国际化</strong><a class="headerlink" href="#113" title="Permanent link">¶</a></h4>
<h5 id="1131">1.1.3.1 <strong>后端国际化</strong><a class="headerlink" href="#1131" title="Permanent link">¶</a></h5>
<p>默认根据浏览器Accept-Language中的语言信息判断选择语言版本；</p>
<p>提供切换语言按钮URL?lang=zh_CN，切换后将语言信息存入cookie；</p>
<p>若客户浏览器中存在语言cookie则优先使用cookie选择显示语言；</p>
<p>1、配置国际化参数</p>
<p>默认解析器：LocaleResolver 用于设置当前会话的默认的国际化语言。</p>
<p>默认拦截器：LocaleChangeInterceptor 指定切换国际化语言的参数名。例如?lang=zh_CN 表示读取国际化文件messages_zh_CN.properties。</p>
<p>/**</p>
<p> * 配置国际化语言</p>
<p> */</p>
<p>@Configuration</p>
<p>public class LocaleConfig {</p>
<p>    /**</p>
<p>     * 默认解析器 其中locale表示默认语言</p>
<p>     */</p>
<p>    @Bean</p>
<p>    public LocaleResolver localeResolver() {</p>
<p>        SessionLocaleResolver localeResolver = new SessionLocaleResolver();</p>
<p>        localeResolver.setDefaultLocale(Locale.US);</p>
<p>        return localeResolver;</p>
<p>    }</p>
<p>    /**</p>
<p>     * 默认拦截器 其中lang表示切换语言的参数名</p>
<p>     */</p>
<p>    @Bean</p>
<p>    public WebMvcConfigurer localeInterceptor() {</p>
<p>        return new WebMvcConfigurer() {</p>
<p>            @Override</p>
<p>            public void addInterceptors(InterceptorRegistry registry) {</p>
<p>                LocaleChangeInterceptor localeInterceptor = new LocaleChangeInterceptor();</p>
<p>                localeInterceptor.setParamName(“lang”);</p>
<p>                registry.addInterceptor(localeInterceptor);</p>
<p>            }</p>
<p>        };</p>
<p>    }</p>
<p>}</p>
<p>2、添加国际化文件</p>
<p>配置文件 application.yml 写入国际化文件的相对路径，表示读取classpath: /i18n/messages_language_country.properties 。例如：</p>
<p>spring:</p>
<p>  messages:</p>
<p>    basename: i18n/messages <strong class="hash" id="相对路径">相对路径</strong> 开头请勿添加斜杠</p>
<p>然后在 classpath: /i18n 目录中添加如下国际化文件：</p>
<p>英语：messages_en_US.properties</p>
<p>中文：messages_zh_CN.properties</p>
<p>3、代码国际化</p>
<p>通过工具类的静态方法MessageUtils.get(“user.title”) 快速获取当前国际化的翻译值。</p>
<p>/**</p>
<p> * 国际化工具类</p>
<p> */</p>
<p>@Component</p>
<p>public class MessageUtils{</p>
<p>    private static MessageSource messageSource;</p>
<p>    public MessageUtils(MessageSource messageSource) {</p>
<p>        FastLocale.messageSource = messageSource;</p>
<p>    }</p>
<p>    /**</p>
<p>     * 获取单个国际化翻译值</p>
<p>     */</p>
<p>    public static String get(String msgKey) {</p>
<p>        try {</p>
<p>            return messageSource.getMessage(msgKey, null, LocaleContextHolder.getLocale());</p>
<p>        } catch (Exception e) {</p>
<p>            return msgKey;</p>
<p>        }</p>
<p>    }</p>
<p>4、CookieLocaleResolver支持的属性</p>
<p>属性 默认值 描述</p>
<p>cookieName classname + LOCALE cookie名</p>
<p>cookieMaxAge Integer.MAX_INT cookie被保存在客户端的最长时间。如果该值为-1，那么cookie将不会被持久化，在客户端浏览器关闭之后就失效了</p>
<p>cookiePath / 限制了cookie仅对站点下的某些特定路径可见。如果指定了cookiePath，那么cookie将仅对该路径及其子路径下的所有站点可见</p>
<h5 id="1132">1.1.3.2 <strong>前端国际化</strong><a class="headerlink" href="#1132" title="Permanent link">¶</a></h5>
<p>前端在界面中提供给用户国际化的切换入口。用户点击不同的语言之后，将语言参数存储在本地cookie中，用于保存语言状态，同时刷新界面以切换当前界面的语言。</p>
<p>用户进入界面时，系统按照URL参数、Cookie的优先级来查找语言参数，进行语言的切换。</p>
<p>在前端代码中，需要根据语言参数使用angular的translate和ng-zarro组件的i18n API对语言进行设置，不在此赘述。</p>
<p>国际化资源文件以及国际化API使用参考《天榕产线-基础平台-前端开发规范》文档。</p>
<h4 id="114">1.1.4 <strong>日志处理</strong><a class="headerlink" href="#114" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps38.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps38.png"/></a> </p>
<p>1.用户管理、资源管理、系统管理、认证中心以及后端数据同步服务、系统配置服务、升级服务等子系统服务都将服务运行日志发送至消息中心，日志不需要单独的topic，日志服务会监听所有的topic并且把它入库保存 </p>
<p>2.用户管理、资源管理、系统管理等web子系统服务，将注解日志发送至消息中心，日志不需要单独的topic，日志服务会监听所有的topic并且把它入库保存 </p>
<h4 id="115">1.1.5 <strong>密钥</strong><strong>管理</strong><a class="headerlink" href="#115" title="Permanent link">¶</a></h4>
<p><strong>概述</strong></p>
<p>为了解决主机,备机,服务部署在不同服务器,密钥一致性问题.密钥配置信息的导出和导入依赖于实施人员通过文件上传方式来解决配置一致性问题</p>
<p><strong>脚本流程</strong></p>
<p>整个脚本交付流程如下图:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps39.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps39.jpg"/></a> </p>
<p>执行安装脚本</p>
<p>判断是否存在/etc/magic.d密钥配置文件</p>
<p>如果存在执行后续流程</p>
<p>完成安装</p>
<p>如果不存在,为兼容老版本升级会提示老版升级还是全新安装</p>
<p>选择老版本升级</p>
<p>生成老版本对应的加密配置信息</p>
<p>将对应的配置信息写入到数据库做备份</p>
<p>执行后续安装流程</p>
<p>完成安装</p>
<p>选择全新安装</p>
<p>选择算法</p>
<p>生成密钥</p>
<p>生成密钥配置文件</p>
<p>将对应的配置信息写入到数据库做备份</p>
<p>执行后续安装流程</p>
<p>完成安装</p>
<p><strong>实施流程</strong></p>
<p>主要包括主机安装,备机安装2个流程</p>
<p><em>主机安装</em></p>
<p>主机安装时序图如下图:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps40.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps40.jpg"/></a> </p>
<p>对应首次安装和覆盖安装流程上区别是 是否提示选择加密算法,如果系统中不存在对应的密钥配置文件.将提示选择加密算法,主要流程如下</p>
<p>第一步运行安装脚本</p>
<p>安装程序将判断是否存在密钥配置文件(判断/etc/magic.d是否已经存在)</p>
<p>如果存在执行后续安装流程</p>
<p>如果不存在会提示选择加密算法提示符(当前支持老版本AES加密和国密SM4加密)选择加密算法后执行后续安装流程</p>
<p><em>备机安装</em></p>
<p>备机安装和主机安装唯一区别就是首先需要将主机上对应的密钥配置文件下载下来上传到备机的对应目录在执行安装脚本流程如下:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps41.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps41.jpg"/></a> </p>
<p>第一步到主机下载密钥配置文件</p>
<p>第二步上传密钥配置文件到/etc/目录下(文件名magic.d)</p>
<p>开始执行安装脚本</p>
<p>安装成功</p>
<h3 id="_1">功能概要设计<a class="headerlink" href="#_1" title="Permanent link">¶</a></h3>
<h4 id="111_1">1.1.1 <strong>用户管理</strong><a class="headerlink" href="#111_1" title="Permanent link">¶</a></h4>
<h5 id="1111_1">1.1.1.1 <strong>组织管理</strong><a class="headerlink" href="#1111_1" title="Permanent link">¶</a></h5>
<h6 id="11111">1.1.1.1.1<strong>功能描述</strong><a class="headerlink" href="#11111" title="Permanent link">¶</a></h6>
<p>组织管理，为用户的上级节点属性，一个组织机构下面会有多个用户，组织机构作为树形结构呈现，包含组织机构名称、简称等基本属性；</p>
<p>支持拖拽方式移动组织机构树；</p>
<p>支持导入导出、批量删除等功能；</p>
<p>支持动态扩展属性，例如组织性质等属性通过动态方式扩展。</p>
<h6 id="11112">1.1.1.1.2<strong>功能设计</strong><a class="headerlink" href="#11112" title="Permanent link">¶</a></h6>
<h6 id="111121">1.1.1.1.2.1<strong>组织机构列表</strong><a class="headerlink" href="#111121" title="Permanent link">¶</a></h6>
<p>1.列表显示顺序：名称、名称全路径、简称、操作。</p>
<p>2.列表查询条件为名称、名称全路径的模糊查询。</p>
<p>3.列表头可排序的字段是：名称、名称全路径。可点击名称、简称的标题处进行升序和降序查询数据。默认排序为修改时间倒序。</p>
<h6 id="111122">1.1.1.1.2.2<strong>组织机构新增</strong><a class="headerlink" href="#111122" title="Permanent link">¶</a></h6>
<p>1.组织机构新增必填项父节点名称、名称。校验规则为产品标准输入输出校验规则。</p>
<p>2.新增的组织机构在当前父组织机构下唯一。</p>
<p>3.新增组织机构页面动态加载扩展属性。</p>
<p>4.新增组织机构数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步等操作。</p>
<h6 id="111123">1.1.1.1.2.3<strong>组织机构修改</strong><a class="headerlink" href="#111123" title="Permanent link">¶</a></h6>
<p>1.组织机构修改名称属性时，同时修改子节点名称全路径。</p>
<p>2.修改的组织机构名称在当前父组织机构下唯一。</p>
<p>3.修改组织机构页面动态加载扩展属性。</p>
<p>4.修改组织机构数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步等操作。</p>
<h6 id="111124">1.1.1.1.2.4<strong>组织机构拖拽</strong><a class="headerlink" href="#111124" title="Permanent link">¶</a></h6>
<p>1.拖拽组织机构修改当前组织机构及其子节点的名称全路径；</p>
<p>2.当前组织机构在拖拽到的父组织机构下唯一；</p>
<p>3.用户对应的组织id值不会发生变化。</p>
<h6 id="111125">1.1.1.1.2.5<strong>组织机构删除</strong><a class="headerlink" href="#111125" title="Permanent link">¶</a></h6>
<p>1.组织机构列表页面删除按钮删除组织机构：组织机构批量删除按钮，组织机构列表可以勾选要删除的组织机构信息。删除组织机构时会校验组织机构下是否有用户，如果存在用户，那么当前删除操作所选中的组织机构都不会被删除。当不存在用户的时候，可以级联删除当前组织机构及其子节点的组织机构。</p>
<p>2.删除组织机构数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步等操作。</p>
<p>3.组织机构和默认分组不允许修改和删除。</p>
<h6 id="111126">1.1.1.1.2.6<strong>组织机构导入模板下载</strong><a class="headerlink" href="#111126" title="Permanent link">¶</a></h6>
<p>根据组织机构表结构动态生成组织机构导入模板，表头新增扩展属性（动态扩展），表字段顺序同组织机构列表显示一致。</p>
<h6 id="111127">1.1.1.1.2.7<strong>组织机构导入</strong><a class="headerlink" href="#111127" title="Permanent link">¶</a></h6>
<p>1.使用名称全路径确定唯一的组织机构，如果组织机构存在，则修改组织机构属性，如果不存在，就做新增组织机构操作；</p>
<p>2.导入组织机构数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步等操作；</p>
<p>3.导入和导出对应必填项的格式说明保持风格一致，统一以(必填)标注；</p>
<p>4.支持导出的数据模板，当没有增加新的扩展属性时，可以直接导入；</p>
<p>5.批量导入时，先检测数据的合规性，如果存在就覆盖修改，如果不存在做新增数据处理；</p>
<p>6.组织机构导入或新增、修改时，同级不能同名。</p>
<h6 id="111128">1.1.1.1.2.8<strong>组织机构导出</strong><a class="headerlink" href="#111128" title="Permanent link">¶</a></h6>
<p>导出的字段为名称全路径，类型，编号，地域，以及组织机构的扩展属性等。</p>
<h6 id="11113">1.1.1.1.3<strong>数据结构</strong><a class="headerlink" href="#11113" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps42.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps42.jpg"/></a> </p>
<h5 id="1112_1">1.1.1.2 <strong>用户管理</strong><a class="headerlink" href="#1112_1" title="Permanent link">¶</a></h5>
<h6 id="11121">1.1.1.2.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11121" title="Permanent link">¶</a></h6>
<p>实现平台登录帐号管理，包括增删改、锁定解锁和认证方式配置、导入导出等。</p>
<h6 id="11122">1.1.1.2.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11122" title="Permanent link">¶</a></h6>
<h6 id="111221">1.1.1.2.2.1<strong>用户列表</strong><a class="headerlink" href="#111221" title="Permanent link">¶</a></h6>
<p>1.列表查询条件为用户、真实姓名、手机号模糊查询，以及状态、认证方式查询。</p>
<p>2.列表头可排序的字段是：用户、真实姓名、组织机构（组织全路径）、手机号、认证方式、状态。可点击上面字段的标题处进行升序和降序查询数据。默认排序为修改时间倒序。</p>
<h6 id="111222">1.1.1.2.2.2<strong>用户新增</strong><a class="headerlink" href="#111222" title="Permanent link">¶</a></h6>
<p>1.用户新增必填项真实姓名、用户、密码、确认密码、组织机构、开始时间、结束时间、认证方式。校验规则为产品标准输输入输出校验规则。</p>
<p>2.新增的用户名唯一。</p>
<p>3.新增用户页面动态加载扩展属性。</p>
<p>4.新增用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<p>5.新增用户时，可选择绑定系统角色，且支持多选。</p>
<p>6.新增用户时，组织机构、认证方式、开始时间和结束时间有默认值，分别为默认组、静态密码、当前时间和配置项配置的默认时间。</p>
<h6 id="111223">1.1.1.2.2.3<strong>用户修改</strong><a class="headerlink" href="#111223" title="Permanent link">¶</a></h6>
<p>1.用户名不能修改、开始时间不能修改。</p>
<p>2.密码与确认密码相同。</p>
<p>3.结束时间必须大于开始时间。</p>
<p>4.修改用户页面动态加载扩展属性。</p>
<p>5.修改用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<p>6.修改用户时，可选择绑定系统角色，且支持多选。</p>
<h6 id="111224">1.1.1.2.2.4<strong>用户复制</strong><a class="headerlink" href="#111224" title="Permanent link">¶</a></h6>
<p>1.用户列表页面用户数据行操作栏点击复制按钮，复制用户基本属性(组织机构、有效期、认证方式、角色)到复制用户页面，实现新建用户的功能。</p>
<p>2.新增用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111225">1.1.1.2.2.5<strong>用户删除</strong><a class="headerlink" href="#111225" title="Permanent link">¶</a></h6>
<p>1.用户列表页面选中需要删除的用户，然后点击删除按钮即可删除用户。</p>
<p>2.删除用户为逻辑删除，只是将数据库中用户状态改为del。</p>
<p>3.删除用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步等操作。</p>
<h6 id="111226">1.1.1.2.2.6<strong>用户锁定解锁</strong><a class="headerlink" href="#111226" title="Permanent link">¶</a></h6>
<p>1.用户列表页面选中需要锁定\解锁的用户，然后点击锁定或者解锁。当 用户被锁定的时候，用户是不能够登录的。</p>
<p>2.用户锁定：管理员用户列表页面锁定用户，记录锁定原因为：管理员锁定；用户登录密码错误次数过多锁定，记录锁定原因为：密码错误次数过多；用户有效期过期锁定，记录锁定原因为：用户有效期过期。</p>
<p>3.用户解锁：管理员用户列表页面解锁用户，清除锁定原因；用户由于密码错误次数过多造成的锁定，可以在登录配置中配置自动解锁时间，超过自动解锁时间用户登录成功就会解锁成功并且清除锁定原因。</p>
<p>4.修改用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<p>5.用户锁定的逻辑处理，应是在CAS获取用户时实现的。</p>
<p>6.用户登录时，应有用户到期提醒的提示信息，默认内置7天提醒。</p>
<h6 id="111227">1.1.1.2.2.7<strong>用户导入模板下载</strong><a class="headerlink" href="#111227" title="Permanent link">¶</a></h6>
<p>根据用户表结构动态生成用户导入模板，表头新增扩展属性，表字段顺 序同用户列表显示一致。</p>
<h6 id="111228">1.1.1.2.2.8<strong>用户导入</strong><a class="headerlink" href="#111228" title="Permanent link">¶</a></h6>
<p>1.导入的用户数据已存在则做用户修改操作、导入的用户数据不存在则做用户新增操作。</p>
<p>2.新增或修改用户数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111229">1.1.1.2.2.9<strong>用户导出</strong><a class="headerlink" href="#111229" title="Permanent link">¶</a></h6>
<p>导出的字段名称为用户、真实姓名、密码、组织机构全路径、手机号、邮箱、状态、认证方式、开始时间、结束时间、角色以及用户扩展属性。</p>
<h6 id="1112210">1.1.1.2.2.10<strong>用户绑定系统角色</strong><a class="headerlink" href="#1112210" title="Permanent link">¶</a></h6>
<p>点击用户列表操作栏的绑定角色功能按钮，实现选择绑定系统角色，且支持多选。</p>
<h6 id="11123">1.1.1.2.3<strong>数据结构</strong><a class="headerlink" href="#11123" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps43.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps43.jpg"/></a> </p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps44.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps44.jpg"/></a> </p>
<h5 id="1113otp">1.1.1.3 <strong>OTP管理</strong><a class="headerlink" href="#1113otp" title="Permanent link">¶</a></h5>
<h6 id="11131">1.1.1.3.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11131" title="Permanent link">¶</a></h6>
<p>为用户提供动态口令码（OTP）的录入维护操作，可以作为用户的认证方式。</p>
<h6 id="11132">1.1.1.3.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11132" title="Permanent link">¶</a></h6>
<h6 id="111321">1.1.1.3.2.1<strong>列表</strong><a class="headerlink" href="#111321" title="Permanent link">¶</a></h6>
<p>1.OTP管理列表页面需要分别展示出坚石诚信和飞天的OTP令牌信息；</p>
<p>2.每个算法列表都会展示OTP令牌相关的信息，包含令牌编号，令牌秘钥，关联用户，描述字段信息；</p>
<p>3.列表都可以通过点击令牌编号字段的标题栏实现当前列数据升序降序排序功能。列表默认排序为修改时间降序；</p>
<p>4.列表都有令牌编号、令牌秘钥、以及关联用户这几个字段作为模糊查询条件。</p>
<h6 id="111322otp">1.1.1.3.2.2<strong>国际/国密OTP新增</strong><a class="headerlink" href="#111322otp" title="Permanent link">¶</a></h6>
<p>1. 国密算法OTP通过导入界面导入文件的方式进行新增；</p>
<p>2. 国际算法OTP录入令牌编号和令牌秘钥，都是必填项，按照标准输入输出校验。</p>
<h6 id="111323">1.1.1.3.2.3<strong>删除</strong><a class="headerlink" href="#111323" title="Permanent link">¶</a></h6>
<p>1. 删除令牌，仅能删除未绑定用户的令牌；</p>
<p>2. 列表支持批量删除操作。</p>
<h6 id="111324otp">1.1.1.3.2.4<strong>OTP绑定用户</strong><a class="headerlink" href="#111324otp" title="Permanent link">¶</a></h6>
<p>关联用户功能，一个令牌最多绑定一个用户，但是一个用户可以同时绑定一个国密算法OTP令牌和一个国际算法OTP令牌。</p>
<h6 id="11133">1.1.1.3.3<strong>数据结构</strong><a class="headerlink" href="#11133" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps45.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps45.jpg"/></a> </p>
<h5 id="1114">1.1.1.4 <strong>用户核查</strong><a class="headerlink" href="#1114" title="Permanent link">¶</a></h5>
<h6 id="11141">1.1.1.4.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11141" title="Permanent link">¶</a></h6>
<p>用户核查模块作为用户管理的二级功能，用户核查根据用户信息判断用户的帐号类型生命状态。为后台定时任务，每天凌晨一点执行。</p>
<h6 id="11142">1.1.1.4.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11142" title="Permanent link">¶</a></h6>
<h6 id="111421">1.1.1.4.2.1<strong>核查定时任务</strong><a class="headerlink" href="#111421" title="Permanent link">¶</a></h6>
<p>1.以后台定时任务方式进行用户核查，前端不再有核查任务的界面呈现；</p>
<p>2.核查类型包含：僵尸用户(未登录用户)、长时间未登录用户(90天未登录过)、过期用户、异常登录用户（密码错误次数过多被锁定用户）、孤儿用户（未授权资源的用户）；</p>
<p>3.对于核查类型做优先级判定：过期用户–&gt;孤儿用户–&gt;僵尸用户–&gt;长时间未登录用户–&gt;异常登录用户。</p>
<h6 id="111422">1.1.1.4.2.2<strong>核查结果</strong><a class="headerlink" href="#111422" title="Permanent link">¶</a></h6>
<p>1. 按组织机构维度展示用户核查结果的状态信息；</p>
<p>2. 左侧组织机构，右侧对应的组织机构下核查的用户信息，展示内容包括：用户、真实姓名、组织机构、手机号、状态、核查结果、核查时间；</p>
<p>3. 针对用户核查结果列表，可导出、删除，同时可以对用户进行锁定/解锁等操作。</p>
<h6 id="11143">1.1.1.4.3<strong>数据结构</strong><a class="headerlink" href="#11143" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps46.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps46.jpg"/></a> </p>
<h5 id="1115">1.1.1.5 <strong>用户口令</strong><strong>策略</strong><a class="headerlink" href="#1115" title="Permanent link">¶</a></h5>
<h6 id="11151">1.1.1.5.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11151" title="Permanent link">¶</a></h6>
<p>用户口令策略提供平台用户通用的口令策略，如密码长度限制、密码复杂度限制、密码有效期控制、密码过期处理、历史密码比对等。</p>
<h6 id="11152">1.1.1.5.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11152" title="Permanent link">¶</a></h6>
<h6 id="111521">1.1.1.5.2.1<strong>密码长度限制</strong><a class="headerlink" href="#111521" title="Permanent link">¶</a></h6>
<p>最小密码长度大于等于8且小于30，最大密码长度大于8且小于等于30，最大密码长度大于最小密码长度。</p>
<h6 id="111522">1.1.1.5.2.2<strong>密码复杂度限制</strong><a class="headerlink" href="#111522" title="Permanent link">¶</a></h6>
<p>密码包含小写字母、密码包含大写字母、密码包含特殊字符、密码包含 数字。</p>
<p>密码必须包含两种及以上复杂度。</p>
<h6 id="111523">1.1.1.5.2.3<strong>密码周期限制</strong><a class="headerlink" href="#111523" title="Permanent link">¶</a></h6>
<p>密码有效期：大于0，小于等于365.</p>
<p>密码到期提醒时间：密码到期前多少天提醒，大于0，小于等于60.</p>
<p>密码到期提醒时间必须小于密码有效期。</p>
<p>密码到期处理方式：管理员用户强制修改密码，普通用户两种方式，一 种是强制修改密码，另外一种是进行用户锁定，给出锁定原因：密码过期锁定。</p>
<h6 id="111524">1.1.1.5.2.4<strong>密码历史比对</strong><a class="headerlink" href="#111524" title="Permanent link">¶</a></h6>
<p>密码不得重复次数：修改的密码不能和配置次数之内历史记录密码相同，次数必须大于0，小于等于20。</p>
<h6 id="111525">1.1.1.5.2.5<strong>密码错误登录锁定</strong><a class="headerlink" href="#111525" title="Permanent link">¶</a></h6>
<p>允许密码错误次数：错误次数超过配置的错误次数密码数，将用户锁定，锁定原因密码错误次数过多，次数必须大于0，小于等于20.</p>
<h6 id="111526">1.1.1.5.2.6<strong>内置弱口令校验</strong><a class="headerlink" href="#111526" title="Permanent link">¶</a></h6>
<p>1. 用户口令策略编辑界面，提供是否启用内置弱口令策略的开关；</p>
<p>2. 对于启用内置弱口令策略后，在用户密码校验时增加其校验判断机制。</p>
<h6 id="11153">1.1.1.5.3<strong>数据结构</strong><a class="headerlink" href="#11153" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps47.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps47.jpg"/></a> </p>
<h5 id="1116">1.1.1.6 <strong>扩展属性管理</strong><a class="headerlink" href="#1116" title="Permanent link">¶</a></h5>
<h6 id="11161">1.1.1.6.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11161" title="Permanent link">¶</a></h6>
<p>扩展属性管理，以支持用户管理、组织机构等管理模块，动态扩展属性，支持文本框、文本域、单选框、下拉框、时间框、多选框等多种形式的数据呈现。</p>
<h6 id="11162">1.1.1.6.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11162" title="Permanent link">¶</a></h6>
<h6 id="111621">1.1.1.6.2.1<strong>列表</strong><a class="headerlink" href="#111621" title="Permanent link">¶</a></h6>
<p>1. 默认修改时间倒序排序；</p>
<p>2. 支持字段名称等模糊查询。</p>
<h6 id="111622">1.1.1.6.2.2<strong>新增/修改</strong><a class="headerlink" href="#111622" title="Permanent link">¶</a></h6>
<p>界面参考：</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps48.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps48.jpg"/></a> </p>
<p>1.每个输入项必须遵照输入校验规范；</p>
<p>2.新增/修改扩展属性数据，发送消息到消息中心，以便下层执行组件接收消息进行日志存储等操作；</p>
<p>3.界面中仅支持是否为启用和是否必填。</p>
<h6 id="111623">1.1.1.6.2.3<strong>删除</strong><a class="headerlink" href="#111623" title="Permanent link">¶</a></h6>
<p>1.删除扩展属性数据，发送消息到消息中心，以便下层执行组件接收消息进行日志存储等操作；</p>
<p>2.支持批量删除。</p>
<h6 id="11163">1.1.1.6.3<strong>数据结构</strong><a class="headerlink" href="#11163" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps49.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps49.jpg"/></a> </p>
<h5 id="1117">1.1.1.7 <strong>数据同步</strong><a class="headerlink" href="#1117" title="Permanent link">¶</a></h5>
<h6 id="11171">1.1.1.7.1<strong>功能描述</strong><a class="headerlink" href="#11171" title="Permanent link">¶</a></h6>
<p>用户管理相关数据变更，数据同步服务组件通过消息中心获取消息调用资源管理提供的API接口封装数据同步至堡垒机、ASCG等。</p>
<h6 id="11172">1.1.1.7.2<strong>功能设计</strong><a class="headerlink" href="#11172" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps50.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps50.png"/></a> </p>
<p>由数据同步组件订阅数据变更事件，事件中的信息能满足数据同步需求情况下，数据同步服务调用后端服务的原子API，否则数据同步服务需要根据事件中的对象ID，调用后端服务的原则API把获取到的数据进行封装后，按照能力组件的API主动向能力组件推送数据。</p>
<h4 id="111_2">1.1.1 <strong>资源管理</strong><a class="headerlink" href="#111_2" title="Permanent link">¶</a></h4>
<h5 id="1111_2">1.1.1.1 <strong>资源组管理</strong><a class="headerlink" href="#1111_2" title="Permanent link">¶</a></h5>
<h6 id="11111_1">1.1.1.1.1<strong>功能描述</strong><a class="headerlink" href="#11111_1" title="Permanent link">¶</a></h6>
<p>1.资源组管理，作为资源管理下的二级菜单功能模块呈现，为资源的上级节点属性，一个资源组下面会有多个资源，包含名称、简称等基本属性；</p>
<p>2.支持拖拽方式移动资源组树；</p>
<p>3.支持动态扩展属性，例如系统类型、备注等通过动态方式扩展。</p>
<h6 id="11112_1">1.1.1.1.2<strong>功能设计</strong><a class="headerlink" href="#11112_1" title="Permanent link">¶</a></h6>
<p>1.资源组树形结构展示，树形展示资源组名称，层级数不做限制；</p>
<p>2.新增/修改界面支持动态属性扩展，动态属性支持文本框、下拉框、多选和文本域等四种方式的呈现。</p>
<p>3.资源组和默认分组作为基础数据。不允许修改和删除。</p>
<h6 id="11113_1">1.1.1.1.3<strong>数据结构</strong><a class="headerlink" href="#11113_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps51.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps51.jpg"/></a> </p>
<h5 id="1112_2">1.1.1.2 <strong>系统资源管理</strong><a class="headerlink" href="#1112_2" title="Permanent link">¶</a></h5>
<h6 id="11121_1">1.1.1.2.1<strong>功能描述</strong><a class="headerlink" href="#11121_1" title="Permanent link">¶</a></h6>
<p>1.系统资源管理，包含基础属性维护管理；</p>
<p>2.支持导入导出、批量删除等功能。</p>
<h6 id="11122_1">1.1.1.2.2<strong>功能设计</strong><a class="headerlink" href="#11122_1" title="Permanent link">¶</a></h6>
<h6 id="111221_1">1.1.1.2.2.1<strong>列表</strong><a class="headerlink" href="#111221_1" title="Permanent link">¶</a></h6>
<p>1. 系统资源列表，支持列表头点击排序，默认按修改时间倒序排序；</p>
<p>2. 支持针对单个资源进行帐号管理操作。</p>
<h6 id="111222_1">1.1.1.2.2.2<strong>新增/修改</strong><a class="headerlink" href="#111222_1" title="Permanent link">¶</a></h6>
<p>1. 系统资源新增、修改页面中，按规范进行数据输入校验；</p>
<p>2. 资源类型的选择必须要选择到具体的版本号；</p>
<p>3. 新增资源时，录入的管理帐号、普通帐号等的密码不需要遵从资源口令策略，修改的时候下拉选择康帐号/普通帐号；</p>
<p>4. 资源指定协议时，带出默认端口号，且可编辑；</p>
<p>5. 新增/修改界面动态加载扩展属性；</p>
<p>6. 新增/修改系统资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111223_1">1.1.1.2.2.3<strong>导入/导出</strong><a class="headerlink" href="#111223_1" title="Permanent link">¶</a></h6>
<p>1. 导入的系统资源数据已存在则做系统资源修改操作、导入的系统资源数据不存在则做系统资源新增操作；</p>
<p>2. 资源的导入先对于数据进行校验，校验不通过的数据直接返回，成功的数据才会一次性导入；</p>
<p>3. 新增或修改系统资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111224_1">1.1.1.2.2.4<strong>删除</strong><a class="headerlink" href="#111224_1" title="Permanent link">¶</a></h6>
<p>1. 资源进行删除时，删除资源、资源下帐号，同时已授权该资源的用户将无法使用资源下所有帐号。</p>
<p>2. 删除系统资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<p>3. 支持批量删除资源。</p>
<h6 id="11123_1">1.1.1.2.3<strong>数据结构</strong><a class="headerlink" href="#11123_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps52.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps52.jpg"/></a> </p>
<h5 id="1113_1">1.1.1.3 <strong>应用资源管理</strong><a class="headerlink" href="#1113_1" title="Permanent link">¶</a></h5>
<h6 id="11131_1">1.1.1.3.1<strong>功能描述</strong><a class="headerlink" href="#11131_1" title="Permanent link">¶</a></h6>
<p>1. 应用资源管理，指维护管理应用系统基础属性，包括资源名称、简称、URL地址、协议、IP地址等；</p>
<p>2. 支持导入导出、批量删除等功能；</p>
<p>3. 支持标准协议的录入。</p>
<h6 id="11132_1">1.1.1.3.2<strong>功能设计</strong><a class="headerlink" href="#11132_1" title="Permanent link">¶</a></h6>
<h6 id="111321_1">1.1.1.3.2.1<strong>列表</strong><a class="headerlink" href="#111321_1" title="Permanent link">¶</a></h6>
<p>1. 应用资源列表，除操作栏支持列表头点击排序，默认按修改时间倒序排序；</p>
<p>2. 支持对单个资源的帐号管理操作。</p>
<h6 id="111322">1.1.1.3.2.2<strong>新增/修改</strong><a class="headerlink" href="#111322" title="Permanent link">¶</a></h6>
<p>1. 必填项：资源名称、应用系统名称拼音、资源组、资源类型、通讯协议、资源IP；</p>
<p>2. 每个输入项必须遵照输入校验规范；</p>
<p>3. 新增/修改界面动态加载扩展属性；</p>
<p>4. 新增/修改应用资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111323_1">1.1.1.3.2.3<strong>导入/导出</strong><a class="headerlink" href="#111323_1" title="Permanent link">¶</a></h6>
<p>1. 导入的应用资源数据已存在则做应用资源修改操作、导入的应用资源数据不存在则做应用资源新增操作；</p>
<p>2. 新增或修改应用资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111324">1.1.1.3.2.4<strong>删除</strong><a class="headerlink" href="#111324" title="Permanent link">¶</a></h6>
<p>1. 应用资源进行删除时，删除应用资源、对应应用资源下帐号，同时已授权该资源的用户将无法使用资源下所有帐号。</p>
<p>2. 删除应用资源数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<p>3. 支持批量删除。</p>
<h6 id="11133_1">1.1.1.3.3<strong>数据结构</strong><a class="headerlink" href="#11133_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps53.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps53.jpg"/></a> </p>
<h5 id="1114_1">1.1.1.4 <strong>帐号管理</strong><a class="headerlink" href="#1114_1" title="Permanent link">¶</a></h5>
<h6 id="11141_1">1.1.1.4.1<strong>功能描述</strong><a class="headerlink" href="#11141_1" title="Permanent link">¶</a></h6>
<p>针对资源（包括系统资源和应用资源）下面的帐号进行维护操作管理，资源帐号俗称为帐号。</p>
<h6 id="11142_1">1.1.1.4.2<strong>功能设计</strong><a class="headerlink" href="#11142_1" title="Permanent link">¶</a></h6>
<h6 id="111421_1">1.1.1.4.2.1<strong>列表</strong><a class="headerlink" href="#111421_1" title="Permanent link">¶</a></h6>
<p>1. 功能按钮包括：【增加】、【删除】、【导入】、【导出】、【解锁/锁定】；</p>
<p>2. 展示内容：帐号名称、资源名称、资源IP、资源组、资源类型（具体到版本）、帐号类型、状态；</p>
<p>3. 列表支持资源名称、帐号名称、资源IP等的单文本模糊查询；</p>
<p>4. 帐号列表，除操作栏支持列表头点击排序，默认按修改时间倒序排序。</p>
<h6 id="111422_1">1.1.1.4.2.2<strong>新增/修改</strong><a class="headerlink" href="#111422_1" title="Permanent link">¶</a></h6>
<p>1. 必填项：资源、帐号名称、类型、密码等；</p>
<p>2. 每个输入项必须遵照输入校验规范；</p>
<p>3. 新增/修改界面动态加载扩展属性；</p>
<p>4. 新增/修改帐号数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111423">1.1.1.4.2.3<strong>删除</strong><a class="headerlink" href="#111423" title="Permanent link">¶</a></h6>
<p>1. 帐号进行删除时，删除帐号，同时已授权该资源的用户将无法使用该帐号；</p>
<p>2. 删除帐号数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作；</p>
<p>3. 支持批量删除。</p>
<h6 id="11143_1">1.1.1.4.3<strong>导入/导出</strong><a class="headerlink" href="#11143_1" title="Permanent link">¶</a></h6>
<p>1. 导入的帐号数据已存在则做帐号修改操作、导入的帐号数据不存在则做应用帐号新增操作；</p>
<p>2. 新增或修改帐号数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="11144">1.1.1.4.4<strong>数据结构</strong><a class="headerlink" href="#11144" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps54.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps54.jpg"/></a> </p>
<h5 id="1115_1">1.1.1.5 <strong>登录协议管理</strong><a class="headerlink" href="#1115_1" title="Permanent link">¶</a></h5>
<h6 id="11151_1">1.1.1.5.1<strong>功能描述</strong><a class="headerlink" href="#11151_1" title="Permanent link">¶</a></h6>
<p>登录协议包括SSH、TELNET、SFTP、RDP、ORACLE、TERADATA、VNC、MSSQL、FTP、RLOGIN、SCP、MYSQL、DB2、POSTGRESQL、SYBASE、INFORMIX、HTTPS、HTTP、TOKEN、PEIVATE，登录协议与资源相关联，一个资源可关联多个登录协议。</p>
<h6 id="11152_1">1.1.1.5.2<strong>功能设计</strong><a class="headerlink" href="#11152_1" title="Permanent link">¶</a></h6>
<h6 id="111521_1">1.1.1.5.2.1<strong>查询</strong><a class="headerlink" href="#111521_1" title="Permanent link">¶</a></h6>
<p>1. 在新增资源的时候，可选中多个登录协议与对应的默认端口，默认端口可修改；</p>
<p>2. 在修改资源的时候，可以对选中的登录协议与端口进行修改。</p>
<h6 id="111522_1">1.1.1.5.2.2<strong>新增/修改</strong><a class="headerlink" href="#111522_1" title="Permanent link">¶</a></h6>
<p>1. 支持新增协议名称、默认端口等；</p>
<p>2. 协议名称不能重名；</p>
<p>3. 必填项协议名称、端口等；</p>
<p>4. 新增/修改登录协议数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111523_1">1.1.1.5.2.3<strong>删除</strong><a class="headerlink" href="#111523_1" title="Permanent link">¶</a></h6>
<p>1. 登录协议进行删除时，删除协议；</p>
<p>2. 删除登录协议数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作；</p>
<p>3. 支持批量删除，但是内置的协议不允许删除。</p>
<h6 id="11153_1">1.1.1.5.3<strong>数据结构</strong><a class="headerlink" href="#11153_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps55.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps55.jpg"/></a> </p>
<h5 id="1116_1">1.1.1.6 <strong>资源口令策略</strong><a class="headerlink" href="#1116_1" title="Permanent link">¶</a></h5>
<h6 id="11161_1">1.1.1.6.1<strong>功能描述</strong><a class="headerlink" href="#11161_1" title="Permanent link">¶</a></h6>
<p>1. 资源口令策略，为资源对应的帐号密码设置口令策略强度，每个资源下面的帐号密码都需遵守该口令策略；</p>
<p>2. 内置默认资源口令策略，资源新增时默认该口令策略；</p>
<p>3. 支持自定义资源口令策略，资源新增编辑时可以自定义选择对应的口令策略。</p>
<h6 id="11162_1">1.1.1.6.2<strong>功能设计</strong><a class="headerlink" href="#11162_1" title="Permanent link">¶</a></h6>
<h6 id="111621_1">1.1.1.6.2.1<strong>列表</strong><a class="headerlink" href="#111621_1" title="Permanent link">¶</a></h6>
<p>1. 支持策略名称的模糊查询；</p>
<p>2. 默认修改时间倒序排序。</p>
<h6 id="111622_1">1.1.1.6.2.2<strong>新增/编辑</strong><a class="headerlink" href="#111622_1" title="Permanent link">¶</a></h6>
<p>1. 每个输入项必须遵照输入校验规范；</p>
<p>2. 新增/修改口令策略数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作。</p>
<h6 id="111623_1">1.1.1.6.2.3<strong>内置弱口令校验</strong><a class="headerlink" href="#111623_1" title="Permanent link">¶</a></h6>
<p>1. 资源口令策略编辑界面，提供是否启用内置弱口令策略的开关；</p>
<p>2. 对于启用内置弱口令策略后，在资源帐号密码校验时增加其校验判断机制。</p>
<h6 id="111624">1.1.1.6.2.4<strong>删除</strong><a class="headerlink" href="#111624" title="Permanent link">¶</a></h6>
<p>1. 口令策略进行删除时，删除口令策略，同时绑定该口令策略的资源对应口令策略失效，用内置默认口令策略；</p>
<p>2. 删除口令策略数据，发送消息到消息中心，以便下层执行组件接收消息进行数据同步、日志存储等操作；</p>
<p>3. 支持批量删除。</p>
<h6 id="11163_1">1.1.1.6.3<strong>数据结构</strong><a class="headerlink" href="#11163_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps56.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps56.jpg"/></a> </p>
<h5 id="1117_1">1.1.1.7 <strong>帐号核查</strong><a class="headerlink" href="#1117_1" title="Permanent link">¶</a></h5>
<h6 id="11171_1">1.1.1.7.1<strong>功能描述</strong><a class="headerlink" href="#11171_1" title="Permanent link">¶</a></h6>
<p>帐号核查模块分为三部分核查结果、核查任务、帐号过滤器。作为资源管理的二级功能，帐号核查可采取目标资源（Linux、windows,数据库等）帐号信息。通过核查任务创建帐号核查任务，任务类型分为立即执行、周期执行、定时执行，可通过指定资源组、资源、资源类型对制定资源进行帐号核查。帐号过滤器中，可通过资源类型、资源两个维度对不需要采集帐号进行配置（这一阶段帐号过滤器暂未实现，下一阶段补充进该功能）。在核查结果中，左侧为资源组，右侧为所有核查结果以资源为维度进行统计的最新结果。</p>
<h6 id="11172_1">1.1.1.7.2<strong>核查流程</strong><a class="headerlink" href="#11172_1" title="Permanent link">¶</a></h6>
<p>帐号核查流程分为两部分，一部分是帐号采集，在目标设备上采集帐号信息，第二部分是帐号核查，通过设备、堡垒机日志对帐号进行核查。</p>
<h6 id="111721">1.1.1.7.2.1<strong>帐号采集流程图</strong><a class="headerlink" href="#111721" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps57.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps57.png"/></a> </p>
<p>流程描述：</p>
<p>1. 根据核查任务中资源进行帐号采集</p>
<p>2. 核查结果中根据核查策略进行过滤，去除不需要采集的帐号</p>
<p>3. 通过命令通道获取目标设备登陆日志</p>
<p>4. 根据目标设备、基础平台、堡垒机日志，检索资源帐号</p>
<p>5. 按照采集帐号类型定义对帐号进行归类</p>
<p>6. 将过滤后，核查完成的帐号采集到基础平台</p>
<h6 id="111722">1.1.1.7.2.2<strong>帐号核查流程图</strong><a class="headerlink" href="#111722" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps58.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps58.png"/></a> </p>
<p>流程描述：</p>
<p>1. 根据资源类型判断是否采集目标设备登陆日志；</p>
<p>2. 判断目标设备日志有不通过基础平台、堡垒机登陆，是为异常登陆帐号；</p>
<p>3. 根据日志信息判断帐号无登陆日志，是为僵尸帐号；</p>
<p>4. 日志信息中，帐号超过90天未登陆为长时间未登陆帐号；</p>
<p>5. 在基础平台中未授权的帐号信息，为孤儿帐号；</p>
<p>6. 在基础平台侧帐号收录为管理类型的帐号为管理帐号，否则为普通帐号。</p>
<h6 id="11173">1.1.1.7.3<strong>功能设计</strong><a class="headerlink" href="#11173" title="Permanent link">¶</a></h6>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>组件</strong></td>
<td><strong>一级功能</strong></td>
<td><strong>二级功能</strong></td>
<td><strong>三级功能</strong></td>
<td><strong>功能描述</strong></td>
<td><strong>备注</strong></td>
</tr>
<tr>
<td></td>
<td>资源管理</td>
<td>帐号核查</td>
<td>核查结果</td>
<td>核查结果列表、导出、加锁、解锁、删除</td>
<td></td>
</tr>
<tr>
<td>核查任务</td>
<td>核查任务列表，增加、删除、修改、执行</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>核查策略</td>
<td>业务操作的增加、修改、删除、查询</td>
<td>暂未实现</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h6 id="111731">1.1.1.7.3.1<strong>核查结果</strong><a class="headerlink" href="#111731" title="Permanent link">¶</a></h6>
<p>1.通过核查策略配置，根据资源类型、资源进行对采集上来的帐号进行过滤，取并集，即都要过滤，策略中配置了的帐号信息，不予录入系统；</p>
<p>2.帐号核查策略：包括根据设备上采集的帐号登录时间、帐号状态进行帐号核查；根据设备上采集的帐号登陆时间、帐号状态+日志（设备主动外发的日志+堡垒机日志）进行核查；僵尸帐号（从来没登录过）/长时间未登录（90天未登录过）/孤儿帐号（未进行主从授权）帐号判断标准，帐号核查判断标准，明确是使用4A（包含堡垒机）上的日志进行判断，帐号核查里去掉“绕行帐号”的判断依据；</p>
<p>3.帐号状态的判断、核查结果的判断，需要分系统版本处理，windows、linux主机和数据库等，暂支持windows主机、linux主机、unix主机、oracle、mysql、sqlserver、db2、informix、postgresql等</p>
<p>4.锁定、解锁：</p>
<p>修改当前选中的帐号状态，同时同步堡垒机，当目标设备支持锁定帐号时同时同步到目标资源。功能可参考帐号管理锁定、解锁。</p>
<p>5.删除：</p>
<p>没有删除功能</p>
<p>7.确认新增：</p>
<p>1. 帐号核查时，从目标设备采集到的帐号取消直接入库操作。</p>
<p>2. 在帐号核查结果列表增加 “确认新增” 列 ，对于存在于目标设备而基础平台不存在的帐号可点击“确认新增”按钮，弹出帐号修改框，填写作为基础平台正常帐号所需要填写的内容，点击保存，即可将目标帐号保存到基础平台。在目标设备和基础平台均有的帐号，该列为空，不显示“确认新增”。</p>
<p>3. 在列表上方增加按钮“确认新增”，弹出帐号修改框，不回显帐号和资源名称，填写其他属性，点击保存，即可将帐号批量入库。对于已经存在于基础平台的帐号，在帐号批量入库的时候会入库失败。</p>
<p>4. 由于帐号状态是基础平台帐号的属性，采集到的帐号没有入库时，没有该属性，该项为空。</p>
<p>5. 锁定/解锁帐号是针对平台内已有的帐号进行操作的，当选中未入库的帐号时，操作失败。</p>
<p>6. 此处密码说明：密码不作为必填项，同时不受口令策略限制。</p>
<h6 id="111732">1.1.1.7.3.2<strong>核查任务</strong><a class="headerlink" href="#111732" title="Permanent link">¶</a></h6>
<p>以任务方式进行帐号采集，帐号核查功能包括核查任务和核查策略，采集任务分为即时任务、定时任务和周期任务；</p>
<p>增加帐号过滤机制，可根据资源类型，默认一些常见的资源内置帐号，作为过滤对象，不再被采集到基础平台上，同时过滤帐号可手动增删—本阶段暂不实现；</p>
<p>核查任务结果中，对已采集的帐号提供手动过滤功能，过滤时，如该帐号已进行授权，则给出“该帐号已授权，无法执行该操作”等类似提示；</p>
<p>采集的帐号不会存入基础平台，需要在帐号核查结果页面手动确认新增，每个帐号仅可新增一次，新增之后不会改变本次核查的结果。</p>
<h6 id="111733">1.1.1.7.3.3<strong>核查策略</strong><a class="headerlink" href="#111733" title="Permanent link">¶</a></h6>
<p>1、核查策略中配置的帐号为不需要采集的帐号，可通过资源、资源类型两个维度对不需要采集的帐号进行配置。</p>
<p>2、资源类型配置核查策略，一级大类下配置了不需要核查的帐号，则这整个大类下配置的帐号都将不被采集到基础平台侧。</p>
<p>3、资源配置核查策略，对资源进行帐号配置，资源进行帐号核查时，配置的帐号将不被采集。</p>
<p>4、当资源与资源类型都配置了核查策略时，则帐号核查过滤的帐号为两种维度配置的并集。例如资源A（Linux）配置了不采集帐号sshd,资源类型linux配置了不采集帐号sshr，增采集资源A时将同时不采集帐号sshd和sshr。</p>
<h6 id="11174">1.1.1.7.4<strong>数据结构</strong><a class="headerlink" href="#11174" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps59.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps59.jpg"/></a> </p>
<h5 id="1118">1.1.1.8 <strong>扩展属性管理</strong><a class="headerlink" href="#1118" title="Permanent link">¶</a></h5>
<h6 id="11181">1.1.1.8.1<strong>功能描述</strong><a class="headerlink" href="#11181" title="Permanent link">¶</a></h6>
<p>扩展属性管理，以支持系统资源、应用资源、资源组、资源帐号等管理模块，动态扩展属性，支持文本框、文本域、单选框、下拉框、时间框、多选框等多种形式的数据呈现。</p>
<h6 id="11182">1.1.1.8.2<strong>功能设计</strong><a class="headerlink" href="#11182" title="Permanent link">¶</a></h6>
<h6 id="111821">1.1.1.8.2.1<strong>列表</strong><a class="headerlink" href="#111821" title="Permanent link">¶</a></h6>
<p>1.默认修改时间倒序排序；</p>
<p>2.支持字段名称等模糊查询。</p>
<h6 id="111822">1.1.1.8.2.2<strong>新增/修改</strong><a class="headerlink" href="#111822" title="Permanent link">¶</a></h6>
<p>界面参考：</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps60.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps60.jpg"/></a> </p>
<p>1. 每个输入项必须遵照输入校验规范；</p>
<p>2. 新增/修改扩展属性数据，发送消息到消息中心，以便下层执行组件接收消息进行日志存储等操作；</p>
<p>3. 仅支持是否为必填的控制。</p>
<h6 id="111823">1.1.1.8.2.3<strong>删除</strong><a class="headerlink" href="#111823" title="Permanent link">¶</a></h6>
<p>1. 删除扩展属性数据，发送消息到消息中心，以便下层执行组件接收消息进行日志存储等操作；</p>
<p>2. 支持批量删除。</p>
<h6 id="11183">1.1.1.8.3<strong>数据结构</strong><a class="headerlink" href="#11183" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps61.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps61.jpg"/></a> </p>
<h5 id="1119">1.1.1.9 <strong>数据同步</strong><a class="headerlink" href="#1119" title="Permanent link">¶</a></h5>
<h6 id="11191">1.1.1.9.1<strong>功能描述</strong><a class="headerlink" href="#11191" title="Permanent link">¶</a></h6>
<p>资源管理相关数据变更，数据同步服务组件通过消息中心获取消息调用资源管理提供的API接口封装数据同步至堡垒机、ASCG等。</p>
<h6 id="11192">1.1.1.9.2<strong>功能设计</strong><a class="headerlink" href="#11192" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps62.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps62.png"/></a> </p>
<p>由数据同步组件订阅数据变更事件，事件中的信息能满足数据同步需求情况下，数据同步服务调用后端服务的原子API，否则数据同步服务需要根据事件中的对象ID，调用后端服务的原则API把获取到的数据进行封装后，按照能力组件的API主动向能力组件推送数据。</p>
<h4 id="111_3">1.1.1 <strong>系统管理</strong><a class="headerlink" href="#111_3" title="Permanent link">¶</a></h4>
<h5 id="1111_3">1.1.1.1 <strong>能力组件</strong><strong>管理</strong><a class="headerlink" href="#1111_3" title="Permanent link">¶</a></h5>
<h6 id="11111_2">1.1.1.1.1<strong>功能描述</strong><a class="headerlink" href="#11111_2" title="Permanent link">¶</a></h6>
<p>能力组件支持类型2018版VBH服务器、ASCG服务器</p>
<p>能力组件管理实现能力组件地址配置和能力组件状态监控，产生能力组件变更事件。</p>
<h6 id="11112_2">1.1.1.1.2<strong>功能设计</strong><a class="headerlink" href="#11112_2" title="Permanent link">¶</a></h6>
<h6 id="111121_1">1.1.1.1.2.1<strong>获取能力组件列表</strong><a class="headerlink" href="#111121_1" title="Permanent link">¶</a></h6>
<p>1、 能力组件列表页面展示数据：组件名称、组件地址、组件类型、调用编号、秘钥、状态、cpu占用率、内存使用率、磁盘利用率、操作。</p>
<p>2、 二级列表展示堡垒机能力组件下挂载的相关应用发布服务器信息。</p>
<h6 id="111122_1">1.1.1.1.2.2<strong>新增能力组件</strong><a class="headerlink" href="#111122_1" title="Permanent link">¶</a></h6>
<p>1、能力组件类型可以为2018版VBH服务器、ASCG服务器。</p>
<p>2、组件地址为ip+端口，组件地址可以为IPV4地址也可以为IPV6地址，新增时进行组件地址校验。</p>
<p>3、调用者编号和秘钥为能力组件上配置的调用能力组件接口需要的调用者编号和秘钥，鉴权使用。</p>
<p>4、负责人，最多选择10个用户，用于能力组件监控告警时发送相应的短信或邮件给负责人。</p>
<p>5、新增能力组件之前先对能力组件的地址进行拨测，确保能力组件地址、端口、秘钥配置都为正确的信息。</p>
<p>6、产生能力组件新增成功事件，数据同步服务订阅事件，做基础数据同步到能力组件操作。针对ASCG，需要向ASCG同步组织数据,用户数据。对于18版堡垒机，需要同步组织机构数据、用户数据、资源组数据。</p>
<p>7、适配能力组件老版本对基础平台接口的调用。</p>
<p>1.1.1.1.2.2.1<strong>能力组件新增前的拨测</strong></p>
<p>1、 新增能力组件保存按钮之前提供一个拨测按钮，调用能力组件拨测接口，返回能力组件是否能正常连通信息。</p>
<p>2、 新增按钮逻辑很单独，只负责新增能力组件，不会去判断是否拨测成功</p>
<p>1.1.1.1.2.2.2<strong>新增</strong><strong>2</strong><strong>018版</strong><strong>V</strong><strong>BH能力组件</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps63.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps63.jpg"/></a> </p>
<p>3、 将前端传来的能力组件信息存入数据库中。</p>
<p>4、 发送能力组件新增事件到消息中心。</p>
<p>5、 <del>待定~~</del>：<sub>~</sub><sub>同步审批规则到当前新增的</sub><del><sub>V</sub></del><sub>BH</sub><sub>~</sub>。~~</p>
<p>6、 定时组件调用系统管理能力组件查询接口,获取全部能力组件接口密钥信息,调用能力组件状态接口获取设备状态、cpu使用率、磁盘使用率、内存使用率上报给系统管理服务</p>
<p>7、 定时组件调用系统管理能力组件查询接口,获取全部能力组件接口密钥信息,调用能力组件版本查询接口上报给系统管理服务。</p>
<p>8、 定时组件上报能力组件状态信息后,系统管理服务根据上报的信息来判断是否发送告警事件(根据系统参数配置:CPU告警阈值,磁盘阈值,内存阈值)</p>
<p>9、 定时组件调用18版堡垒机获取挂载的应用发布服务器信息，以及挂载的文档管控信息。</p>
<p>10、 定时组件将应用发布服务器信息和文档管控信息上报给系统管理服务，系统管理服务将应用发布服务器信息和文档管控信息存入能力组件表中。应用发布服务器和文档管控与父级堡垒机关系由system_parent_id字段体现。</p>
<p>1.1.1.1.2.2.3<strong>新增</strong><strong>A</strong><strong>SCG能力组件</strong></p>
<p>1、 将前端传来的能力组件信息存入数据库中。</p>
<p>2、 发送能力组件新增事件到消息中心。</p>
<p>3、 定时组件调用系统管理能力组件查询接口,获取全部能力组件接口密钥信息,调用能力组件状态接口获取设备状态、cpu使用率、磁盘使用率、内存使用率上报给系统管理服务。</p>
<p>4、 定时组件调用系统管理能力组件查询接口,获取全部能力组件接口密钥信息,调用能力组件版本查询接口上报给系统管理服务。</p>
<p>5、 定时组件上报能力组件状态信息后,系统管理服务根据上报的信息来判断是否发送告警事件(根据系统参数配置:CPU告警阈值,磁盘阈值,内存阈值)。</p>
<h6 id="111123_1">1.1.1.1.2.3<strong>修改能力组件</strong><a class="headerlink" href="#111123_1" title="Permanent link">¶</a></h6>
<p>修改能力组件同新增逻辑基本一致。</p>
<h6 id="111124_1">1.1.1.1.2.4<strong>删除能力组件</strong><a class="headerlink" href="#111124_1" title="Permanent link">¶</a></h6>
<p>1、 删除能力组件下挂载的能力组件数据。</p>
<p>2、 删除能力组件表中的数据。</p>
<p>3、 删除能力组件状态监控表中与能力组件id关联的监控信息。</p>
<p>4、 删除发送删除事件,通知能力组件已被删除</p>
<h6 id="111125_1">1.1.1.1.2.5<strong>能力组件</strong><strong>状态上报接收</strong><strong>接口</strong><a class="headerlink" href="#111125_1" title="Permanent link">¶</a></h6>
<p>定时组件调用能力组件状态接口获取设备状态、cpu使用率、磁盘使用率、内存使用率和版本查询接口,上报给系统管理服务入库,如果上报的状态信息超过系统参数配置的阈值,发送能力组件告警事件,系统通知服务完成后续通知动作</p>
<h6 id="111126_1">1.1.1.1.2.6<strong>能力组件关联资源组</strong><a class="headerlink" href="#111126_1" title="Permanent link">¶</a></h6>
<p>能力组件关联资源组</p>
<p>1. 目前仅支持2018版堡垒机、ASCG能力组件关联资源。</p>
<p>2. 当能力组件关联资源组的时候，会产生事件，下发资源同步kafka消息。数据同步服务接收到数据同步消息，然后进行相应的资源、协议、帐号同步到能力组件。</p>
<p>3. 将能力组件与资源组的关联关系写入数据库，</p>
<p>4. 能力组件取消与资源组的关联的时候，需要删除能力组件上对应的资源组下的资源信息</p>
<p>5. 需要提供资源组关联的能力组件查询接口,</p>
<p>6. 资源关联最优性能能力组件接口(下个版本考虑)</p>
<p>7. 资源组下资源变更所在资源组的时候，数据同步组件根据接收到资源变更消息，删除资源在原来资源组关联的能力组件下的信息，然后将当前资源信息放到新的资源组关联的能力组件下。</p>
<p>8. 资源组变更的时候，将原来的资源组及其子节点所关联的能力组件全部删除掉，然后将当前节点及其子节点都关联至拖拽的资源组关联的能力组件。例：有二级资源组1关联了能力组件A、B、C，二级资源组1下的三级资源组1关联了能力组件A，有二级资源组2关联了能力组件D、E、F、G，将二级资源组1拖拽到二级资源组2的时候，需要将二级资源组1及其子节点三级资源组1关联的能力组件上的当前资源组下的资源信息全部删除掉，然后再将二级资源组1及其子节点三级资源组1关联上二级资源组2关联的能力组件D、E、F、G，即当前节点及其子节点默认继承父节点关联的所有的能力组件，然后将当前二级资源组1及其子节点三级资源组1下的资源同步至D、E、F、G能力组件。</p>
<p>9. 能力组件与资源组的绑定关系，只用绑定父节点即可，子节点默认继承绑定的父节点绑定的能力组件。</p>
<h6 id="111127_1">1.1.1.1.2.7<strong>能力组件关联组织机构</strong><a class="headerlink" href="#111127_1" title="Permanent link">¶</a></h6>
<p>待定：下个版本考虑</p>
<h6 id="11113_2">1.1.1.1.3<strong>数据结构</strong><a class="headerlink" href="#11113_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps64.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps64.jpg"/></a> <a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps65.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps65.jpg"/></a></p>
<h5 id="1112_3">1.1.1.2 <strong>系统主备管理</strong><a class="headerlink" href="#1112_3" title="Permanent link">¶</a></h5>
<h6 id="11121_2">1.1.1.2.1<strong>功能描述</strong><a class="headerlink" href="#11121_2" title="Permanent link">¶</a></h6>
<p>1、 前端调用系统管理服务API发起主备配置操作。</p>
<p>2、 系统管理服务向消息中心发送主备配置消息。</p>
<p>3、 后台主备服务订阅消息执行主备动作。</p>
<p>4、 后台主备服务发送主备动作执行结果事件。</p>
<p>5、 后台主备服务调用系统管理服务主备配置执行结果保存接口、对执行结果入库。这里入库的是主备配置结果日志信息，并不是主备状态信息。系统管理查询HA服务的接口实时获取(和架构差异)</p>
<p>6、 通知服务订阅主备动作执行结果事件，并通过短信服务或邮件服务给管理员发送通知。</p>
<h6 id="11122_2">1.1.1.2.2<strong>主备流程</strong><a class="headerlink" href="#11122_2" title="Permanent link">¶</a></h6>
<h6 id="111221_2">1.1.1.2.2.1<strong>配置主机热备</strong><a class="headerlink" href="#111221_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps66.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps66.jpg"/></a> </p>
<p>1、 主机前端界面配置热备主机，调用系统服务API接口。</p>
<p>2、 系统服务响应前端，返回消息热备主机正在配置中。</p>
<p>3、 系统服务发送配置热备主机事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块订阅配置热备主机事件。</p>
<p>5、 后台主备服务主备事件处理模块使用命令行调用后台主备服务主备配置切换模块脚本。</p>
<p>6、 后台主备服务主备配置切换模块检查命令行参数，将当前设备配置为热备主机。</p>
<p>7、 后台主备服务主备配置切换模块同步返回配置热备主机结果给后台主备服务主备事件处理模块。</p>
<p>8、 后台主备服务主备事件处理模块发送配置热备主机结果事件到消息中心。</p>
<p>9、 后台主备服务事件处理模块调用系统服务配置热备主机结果处理接口。</p>
<p>10、 系统服务将配置热备主机结果存入数据库。</p>
<p>11、 通知服务订阅配置热备主机结果事件。</p>
<p>12、 通知服务通过邮件服务、短信服务发送通知。</p>
<h6 id="111222_2">1.1.1.2.2.2<strong>备机申请加入主备</strong><a class="headerlink" href="#111222_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps67.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps67.jpg"/></a> </p>
<p>备机端逻辑</p>
<p>1、 备机前端页面配置备机，调用系统服务API接口。</p>
<p>2、 系统服务响应备机前端，返回消息备机申请加入主机正在配置中。</p>
<p>3、 系统服务发送备机申请加入主备事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块订阅备机申请加入主备事件。</p>
<p>5、 后台主备服务主备事件处理模块使用命令行调用后台主备服务主备配置切换模块脚本。</p>
<p>6、 备机后台主备服务主备配置切换模块向主机后台主备服务主备配置切换模块发送加入热备申请请求，检查命令行参数，将当前设备配置为热备主机。</p>
<p>7、 主机后台主备服务主备配置切换模块校验申请备机参数。</p>
<p>8、 主机后台主备服务主备配置切换模块同步返回校验执行结果成功或失败给备机后台主备服务主备配置切换模块。</p>
<p>9、 备机后台主备服务主备配置切换模块同步返回备机申请加入主备结果。</p>
<p>10、 后台主备服务主备事件处理模块发送备机申请加入主备结果事件到消息中心。</p>
<p>11、 后台主备服务主备事件处理模块调用系统服务备机申请加入主备结果处理接口。</p>
<p>12、 系统服务将备机申请加入主备结果存入数据库。</p>
<p>13、 通知服务订阅备机申请加入主备结果事件。</p>
<p>14、 通知服务通过邮件服务、短信服务发送通知。</p>
<p>主机端逻辑</p>
<p>1、 主机后台主备服务主备配置切换模块校验申请备机参数后，执行脚本，调用后台主备服务主备事件处理模块提供的热备事件处理http接口。</p>
<p>2、 后台主备服务主备事件处理模块发送备机申请加入主备结果事件到消息中心。</p>
<p>3、 后台主备服务主备事件处理模块调用系统服务备机申请加入主备结果处理接口。</p>
<p>4、 系统服务将备机申请加入主备结果写入数据库。</p>
<p>5、 通知服务订阅备机申请加入主备结果事件。</p>
<p>6、 通知服务通过邮件服务，短信服务发送通知。</p>
<h6 id="111223_2">1.1.1.2.2.3<strong>主机同意备机加入主备</strong><a class="headerlink" href="#111223_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps68.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps68.jpg"/></a> </p>
<p>主机端逻辑</p>
<p>1、 主机前端页面管理员同意设备加入主备，调用系统服务API接口。</p>
<p>2、 系统服务响应主机前端，返回消息备机加入主备正在配置中。</p>
<p>3、 系统服务发送主机同意备机加入主备事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块订阅主机同意备机加入主备事件。</p>
<p>5、 后台主备服务主备事件处理模块使用命令行调用后台主备服务主备配置切换模块脚本。</p>
<p>6、 主机后台主备服务主备配置切换模块检查参数，处理主备逻辑。</p>
<p>7、 主机后台主备服务主备配置切换模块向备机后台主备服务主备配置切换模块发送备机申请加入热备确认结果请求。</p>
<p>8、 备机后台主备服务主备配置切换模块配置设备成为备机。</p>
<p>9、 备机后台主备服务主备配置切换模块同步返回配置备机结果给主机后台主备服务主备配置切换模块。</p>
<p>10、 主机后台主备服务主备配置切换模块同步返回主机同意备机加入主备配置结果。</p>
<p>11、 后台主备服务主备事件处理模块发送主机同意备机加入主备结果事件到消息中心。</p>
<p>12、 后台主备服务主备事件处理模块调用系统服务主机同意备机加入主备结果处理接口。</p>
<p>13、 系统服务将主机同意备机加入主备结果存入数据库。</p>
<p>14、 通知服务订阅主机同意备机加入主备结果事件。</p>
<p>15、 通知服务通过邮件服务、短信服务发送通知。</p>
<p>备机端逻辑</p>
<p>1、 备机后台主备服务主备配置切换模块配置设备成备机后，执行脚本，调用后台主备服务主备事件处理模块提供的热备事件处理http接口。</p>
<p>2、 后台主备服务主备事件处理模块发送主机同意备机加入主备结果事件到消息中心。</p>
<p>3、 后台主备服务主备事件处理模块调用系统服务主机同意备机加入主备结果处理接口。</p>
<p>4、 系统服务将主机同意备机加入主备结果写入数据库。</p>
<p>5、 通知服务订阅主机同意备机加入主备结果事件。</p>
<p>6、 通知服务通过邮件服务，短信服务发送通知。</p>
<h6 id="111224_2">1.1.1.2.2.4<strong>停止主机热备</strong><a class="headerlink" href="#111224_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps69.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps69.jpg"/></a> </p>
<p>主机端逻辑</p>
<p>1、 主机前端页面停止主机热备，调用系统服务API接口。</p>
<p>2、 系统服务响应主机前端，返回消息停止主机热备正在配置中。</p>
<p>3、  系统服务发送停止主机热备事件到消息中心。</p>
<p>4、  后台主备服务主备事件处理模块订阅停止主机热备事件。</p>
<p>5、 后台主备服务主备事件处理模块使用命令行调用后台主备服务主备配置切换模块脚本。</p>
<p>6、 主机后台主备服务主备配置切换模块检查参数，处理主机取消热备逻辑。</p>
<p>7、 主机后台主备服务主备配置切换模块向备机后台主备服务主备配置切换模块发送主机取消热备请求。</p>
<p>8、 主机后台主备服务主备配置切换模块同步返回主机取消热备结果。</p>
<p>9、 后台主备服务主备事件处理模块发送主机取消热备结果事件到消息中心。</p>
<p>10、 后台主备服务主备事件处理模块调用系统服务主机取消热备结果处理接口。</p>
<p>11、 系统服务将主机取消热备结果存入数据库。</p>
<p>12、 通知服务订阅主机取消热备结果事件。</p>
<p>13、 通知服务通过邮件服务、短信服务发送通知。</p>
<p>备机端逻辑</p>
<p>1、 备机后台主备服务主备配置切换模块处理备机取消热备逻辑。</p>
<p>2、 执行脚本，调用后台主备服务主备事件处理模块提供的热备事件处理http接口。</p>
<p>3、 后台主备服务主备事件处理模块发送备机取消热备结果事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块调用系统服务备机取消热备结果处理接口。</p>
<p>5、 系统服务将备机取消热备结果写入数据库。</p>
<p>6、 通知服务订阅备机取消热备结果事件。</p>
<p>7、 通知服务通过邮件服务，短信服务发送通知。</p>
<h6 id="111225_1">1.1.1.2.2.5<strong>停止备机热备</strong><a class="headerlink" href="#111225_1" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps70.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps70.jpg"/></a> </p>
<p>主机端逻辑</p>
<p>1、 备机前端页面停止备机热备，调用系统服务API接口。</p>
<p>2、 系统服务响应备机前端，返回消息停止备机热备正在配置中。</p>
<p>3、 系统服务发送备机取消热备事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块订阅备机取消热备事件。</p>
<p>5、 后台主备服务主备事件处理模块使用命令行调用后台主备服务主备配置切换模块脚本。</p>
<p>6、 备机后台主备服务主备配置切换模块处理备机取消热备逻辑。</p>
<p>7、 备机后台主备服务主备配置切换模块向主机后台主备服务主备配置切换模块发送备机取消热备请求。</p>
<p>8、 备机后台主备服务主备配置切换模块同步返回备机取消热备结果。</p>
<p>9、 后台主备服务主备事件处理模块发送备机取消热备结果事件到消息中心。</p>
<p>10、 后台主备服务主备事件处理模块调用系统服务备机取消热备结果处理接口。</p>
<p>11、 系统服务将备机取消热备结果存入数据库。</p>
<p>12、 通知服务订阅备机取消热备结果事件。</p>
<p>13、 通知服务通过邮件服务、短信服务发送通知。</p>
<p>主机端逻辑</p>
<p>1、 主机后台主备服务主备配置切换模块清理备机信息。</p>
<p>2、 执行脚本，调用后台主备服务主备事件处理模块提供的热备事件处理http接口。</p>
<p>3、 后台主备服务主备事件处理模块发送备机取消热备结果事件到消息中心。</p>
<p>4、 后台主备服务主备事件处理模块调用系统服务备机取消热备结果处理接口。</p>
<p>5、 系统服务将备机取消热备结果写入数据库。</p>
<p>6、 通知服务订阅备机取消热备结果事件。</p>
<p>7、 通知服务通过邮件服务，短信服务发送通知</p>
<h6 id="11123_2">1.1.1.2.3<strong>功能设计</strong><a class="headerlink" href="#11123_2" title="Permanent link">¶</a></h6>
<h6 id="111231">1.1.1.2.3.1<strong>主备配置约束条件</strong><a class="headerlink" href="#111231" title="Permanent link">¶</a></h6>
<p>1、 主备后台服务运行环境jdk1.8，python3.6，keepalived，pg10</p>
<p>2、 没有配置主备环境的服务器才能进行配置主机热备或者配置备机热备。</p>
<p>3、 配置了主机热备的服务器不能申请做为备机服务器。</p>
<p>4、 配置了备机热备的服务器不能申请做为主机热备服务器。</p>
<p>5、 配置了主机热备的服务器接收到多个备机申请加入主备的请求时，多个请求可以同时上报到主机，管理员可以同时同意多个备机加入主备的申请，但是最后只有一个能配置成功，当有一个配置成功了，其余的都会提示配置失败。</p>
<p>6、 主机拒绝备机申请加入，备机端会收到主机拒绝备机加入信息。</p>
<p>7、 只有相同版本及相同license信息(授权用户数,系统资源,应用资源数,权限点,授权类型)才能进行主备配置。具体比对校验方式为版本号和license信息。</p>
<p>8、 只有主备角色为主机的服务器才能处理备机申请加入主备请求，并且申请加入主备的主机ip必须为本机真实ip。</p>
<p>9、 主机为ipv4环境，备机为ipv6环境下主备配置不能成功，必须同为ipv4或ipv6。</p>
<p>10、 建立主备关系后备机离线会提示备机离线，主机还是主机并且正常运行。</p>
<p>11、 建立主备关系后主机离线又在线，此时备机变为主机，主机在线后角色为备机。</p>
<p>12、 建立主备关系后备机取消主备，主机还是主机并且正常运行。</p>
<p>13、 建立主备关系后主机取消主备，备机变主机，以前的主机没有任何主备角色。</p>
<p>14、 配置热备主机的热备配对号必须为1-255之间的一个整数，并且不能是当前网段已经使用过的热备配对号。</p>
<p>15、 本机配置热备的ip应该与本机配置热备的网卡中的ip一致。</p>
<h6 id="111232">1.1.1.2.3.2<strong>进入主备菜单</strong><a class="headerlink" href="#111232" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.2.1<strong>功能描述</strong></p>
<p>进入主备菜单的时候，要先调用接口查看当前环境的主备相关信息。</p>
<p>如果当前环境没有配置主备，那么功能列表可以展示配置主机热备和配置备机热备按钮。</p>
<p>如果当前环境是热备主机，那么功能列表配置备机热备按钮必须置灰。</p>
<p>如果当前环境是热备备机，那么功能列表配置主机热备按钮必须置灰。</p>
<h6 id="111233">1.1.1.2.3.3<strong>查看主备信息</strong><a class="headerlink" href="#111233" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.3.1<strong>功能描述</strong></p>
<p>查看当前环境主备的相关信息。</p>
<p>1.1.1.2.3.3.2<strong>界面原型</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps71.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps71.jpg"/></a> </p>
<p>1.1.1.2.3.3.3<strong>功能设计</strong></p>
<p>主备信息并没有存储在数据库中，所以主备信息是从主备后台程序获取得到的。</p>
<p>待定：主备信息获取可以有两种方案。</p>
<p>第一种：前端调用系统服务接口获取主备信息，系统服务从数据库或缓存中查询主备信息。数据库或缓存中的主备信息由主备后台服务主备事件处理模块轮询获取，然后调用系统服务提供保存主备信息的接口更新主备信息。这样可能会存在一个问题，假如两台服务器A、B。A为主机，B为备机。A机上面数据库存储的主备信息为：当前主机的主备角色“MASTER”，主备本机的ip地址（172.16.98.110），主备其他机器的ip地址（172.16.98.111），主备切换的时候，假如存储主备信息的表需要同步，那么当前主机的主备角色MASTER这个信息没问题，但是主备本机的ip地址172.16.98.110就不对，应该是172.16.98.111；主备其他机器的ip地址应该是172.16.98.110。 只有等到下次主备后台服务主备事件处理模块轮询的时候才会更新主备信息到数据库或缓存中。假如存储主备信息的表不同步，那么B机器数据库中的主备数据可能还是当前角色为BACKUP，也是有问题的。要解决这个问题必须就在接收到主备切换事件的时候立马更新数据库中的数据。</p>
<p><strong>第二种</strong><strong>：</strong><strong>前端调用系统服务接口获取主备信息</strong><strong>，</strong><strong>系统服务调用主备后台程序接口实时获取主备状态信息</strong><strong>，</strong><strong>最后同步返回给前端</strong><strong>。</strong></p>
<h6 id="111234">1.1.1.2.3.4<strong>配置主机热备</strong><a class="headerlink" href="#111234" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.4.1<strong>功能描述</strong></p>
<p>将当前设备配置为主机，并且可以控制主备服务开启或者关闭</p>
<p>1.1.1.2.3.4.2<strong>界面原型</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps72.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps72.jpg"/></a> </p>
<p>1.1.1.2.3.4.3<strong>功能设计</strong></p>
<p>1、 只有未配置主备的服务器才能配置为主机热备。配置主机热备之前会判断当前服务器是否已经存在于主备角色中。</p>
<p>2、 配置主机热备的参数不会存储在数据库中，而是直接将主机参数传递给后台主备服务程序处理。</p>
<p>3、 如果当前服务器已经是主机热备角色，当点击配置主机热备按钮的时候，会将当前服务器主备信息回显到配置主机热备页面。但是只有主备服务开启\关闭下拉框可以操作，其他按钮置灰。就是说主机热备角色已存在的情况下，只能对主机热备进行停止操作。如果想更改当前服务器的主备配置，那么就将主机热备停止，恢复到没有配置主备的环境下。然后重新进行主备配置。</p>
<p>4、 浮动ip类型必须和本机配置主备使用ip类型一致，如同为ipv4类型和ipv6类型</p>
<p>5、 当前设备的所有服务健康状态都为健康的情况下才能进行主备配置</p>
<p>6、 浮动ip必须为未被使用的ip</p>
<h6 id="111235">1.1.1.2.3.5<strong>配置备机热备</strong><a class="headerlink" href="#111235" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.5.1<strong>功能描述</strong></p>
<p>将当前设备配置为备机，并且可以控制主备服务开启或者关闭</p>
<p>1.1.1.2.3.5.2<strong>界面原型</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps73.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps73.jpg"/></a> </p>
<p>1.1.1.2.3.5.3<strong>功能设计</strong></p>
<p>1、 只有未配置主备的服务器才能配置为备机热备。配置备机热备之前会先判断当前服务器是否已经存在于主备角色之中。</p>
<p>2、 配置备机热备的参数不会存储在数据库中，而是直接将备机参数直接传递给后台主备服务程序处理。</p>
<p>3、 配置备机热备只是申请加入主备环境，还需要主机热备管理员对当前配置备机热备申请进行处理，只有管理员同意申请加入主机热备，才算加入主备成功。</p>
<p>4、 如果当前服务器已经是备机热备角色，当点击配置备机热备按钮的时候，会将当前服务器主备信息回显到配置备机热备页面。但是只有主备服务开启\关闭下拉框可以操作，其他按钮置灰。就是说备机热备角色已存在的情况下，只能对备机热备进行停止操作。如果想更改当前服务器的主备配置，那么就将备机热备停止，恢复到没有配置主备的环境下。然后重新进行主备配置。</p>
<p>5、 主机ip使用类型必须和本机加入主备ip类型一致，如同为ipv4或者ipv6</p>
<p>6、 主机ip必须能够连通，否则无法使用</p>
<p>7、 主机和备机的版本号必须相同，否则不能加入主备</p>
<h6 id="111236">1.1.1.2.3.6<strong>主备</strong><strong>上报</strong><strong>事件接收</strong><a class="headerlink" href="#111236" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.6.1<strong>功能描述</strong></p>
<p>系统服务接收主备后台程序上报的事件并进行相应处理。</p>
<p>1.1.1.2.3.6.2<strong>界面原型</strong></p>
<p>无</p>
<p>1.1.1.2.3.6.3<strong>功能设计</strong></p>
<p>主备后台服务在两种情况下会上报事件：</p>
<p>第一种情况：进行热备配置产生的结果上报；流程如下。</p>
<p>1、 主备后台服务主备事件处理模块接收到配置主机热备事件，然后调用主备后台服务主备配置切换模块配置主机热备。</p>
<p>2、 主备后台服务主备配置切换模块会同步返回结果给主备后台服务主备事件处理模块。</p>
<p>3、 主备后台服务主备事件处理模块调用系统服务主备上报事件接收接口。</p>
<p>4、 系统服务主备上报事件接收接口对上报的主备事件结果入库。</p>
<p>第二种情况：主备状态变化产生的主备事件上报；流程如下。</p>
<p>1、 主备状态发生变化时，主备后台服务主备配置切换模块会执行脚本，脚本内容为调用主备后台服务主备事件处理模块的http主备上报事件接收接口。</p>
<p>2、 主备后台服务主备事件处理模块提供的主备上报事件接收接口将会调用系统服务的主备上报事件接收接口。</p>
<p>3、 系统服务主备上报事件接收接口将会对每种事件都进行入库，会将主备上报事件那条数据设置为待办状态，所有待办状态的上报的事件都需要管理员处理</p>
<p>每种事件的处理方式如下： </p>
<p>l 1、备机请求添加到热备主机，界面展示并通知相关人员。</p>
<p>l 2、主备备机离线，界面展示并通知相关人员。</p>
<p>l 3、数据同步异常，界面展示并通知相关人员。</p>
<p>l 4、主备主备机通讯异常，界面展示并通知相关人员。</p>
<p>l 5、主备机软件版本不一致，界面展示并通知相关人员。</p>
<p>l 6、主备主机同意备机加入申请，界面展示并通知相关人员。</p>
<p>l 7、主备主机拒绝备机加入申请，界面展示并通知相关人员。</p>
<p>l 8、主备备机取消主备，界面展示并通知相关人员。</p>
<p>l 9、主备备机上线，界面展示并通知相关人员。</p>
<p>l 10、主备主机取消热备，界面展示并通知相关人员。</p>
<p>l 11、备机变主机，界面展示并通知相关人员。</p>
<p>l 12、主机变备机，界面展示并通知相关人员。</p>
<p>通知方式由系统参数主备事件类型及主备事件通知模板决定。</p>
<p>相关人员为主备事件通知接收人配置的用户。</p>
<p>1.1.1.2.3.6.4<strong>数据结构</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps74.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps74.jpg"/></a> </p>
<h6 id="111237">1.1.1.2.3.7<strong>处理主备上报事件</strong><a class="headerlink" href="#111237" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.7.1<strong>功能描述</strong></p>
<p>管理员对主备后台服务上报的主备事件进行处理，如备机申请加入主备事件处理。</p>
<p>1.1.1.2.3.7.2<strong>界面原型</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps75.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps75.jpg"/></a> </p>
<p>1.1.1.2.3.7.3<strong>功能设计</strong></p>
<p>1、 管理员处理主备后台服务上报的主备事件，已处理的事件，操作栏那里就不会进行任何操作了。</p>
<p>2、 未处理的事件就有2种情况，第一种是备机申请加入主机热备事件的处理。对于这个事件只能进行同意或拒绝操作，不论是同意还是拒绝，都会调用系统管理api。然后系统管理下发管理员同意或拒绝的主备事件进行后续处理流程。第二种是非备机申请加入主备的事件的处理。由于这类事件不需要额外处理，管理员只需要标记为已处理就行了。</p>
<h6 id="111238">1.1.1.2.3.8<strong>相关服务监控</strong><a class="headerlink" href="#111238" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.8.1<strong>功能描述</strong></p>
<p>系统运行过程中，服务状态监控程序监控相关服务的状态，并根据监控的服务的状态综合判断是否需要执行主备切换。</p>
<p>1.1.1.2.3.8.2<strong>界面原型</strong></p>
<p>无</p>
<p>1.1.1.2.3.8.3<strong>功能设计</strong></p>
<p>热备后台服务负责监控API网关、认证中心、用户管理、DB、消息中心。</p>
<p>守护进程监控服务状态，配置守护进程启动失败自动重试次数为3次，如果服务停了，守护进程会自动去拉取3次服务，如果拉取3次都没有成功，那么守护进程会将该服务状态设置为失败。</p>
<p>1、 热备后台服务服务状态监控模块每分钟进行一次任务调度监测服务状态,同时监听supervisor进程状态变更事件，将主备是否需要进行切换的信息写入HA服务内存中。</p>
<p>2、 热备后台服务服务状态监控模块首先调用守护进程接口获取API网关、认证中心、用户管理进程状态，如果其中一个服务状态为失败，那么将需要进行主备切换的信息写入HA服务内存(内部处理逻辑)。</p>
<p>3、 接下来热备后台服务服务状态监控模块进行api接口定时拨测判断API网关、认证中心、用户管理服务是否正常运行，拨测频率为10秒拨测一次，http接口返回超时就是API网关故障，返回503就是对应的服务不可用。如果拨测3次都没有成功，那么就将需要进行主备切换的信息写入HA服务内存。</p>
<p>4、 然后热备后台服务服务状态监控模块对db进行监控，每10秒执行一次pg连接命令和查询命令，判断是否连接占满或者DB数据库不可用，如果执行3次都是不可用或连接占满，那么就将需要进行主备切换的信息写入HA服务内存。</p>
<p>5、 接下来热备后台服务服务状态监控模块对消息中心进行监控，每10秒执行一次监听消息中心的端口是否正常，如果监听3次都是不可用，那么就将需要进行主备切换的信息写入HA服务内存。</p>
<p>6、 以上3、4、5步骤在子线程中同时进行，如果监控状态都为正常，那么就将不需要进行主备切换的信息写入内存。</p>
<p>7、 主备后台服务服务状态监控模块提供是否需要进行主备切换接口，接口读取内存中的是否需要进行主备切换信息，返回给调用方。主备后台服务主备配置切换模块每隔10秒调用一次主备后台服务服务状态监控模块提供的是否需要进行主备切换接口，如果需要进行主备切换，那么就进行主备切换。</p>
<p>8、 主备后台服务不上报服务状态给系统管理服务，当非主备部署的环境，就不会上报服务转台给系统管理服务。所以应该由系统配置服务上报服务状态给系统管理服务。</p>
<h6 id="111239">1.1.1.2.3.9<strong>主备事件通知接收人配置</strong><a class="headerlink" href="#111239" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.9.1<strong>功能描述</strong></p>
<p>配置用户、短信或邮件通知所配置的用户主备状态切换等信息。</p>
<p>1.1.1.2.3.9.2<strong>界面原型</strong></p>
<p>暂无</p>
<p>1.1.1.2.3.9.3<strong>功能设计</strong></p>
<p>1、 主备上报事件接收列表的功能按钮那里提供按钮配置主备事件接收人，点击按钮展示一个tab页为主备事件通知接收人列表。</p>
<p>2、 列表默认勾选上原有配置了的用户，并且在列表最前方展示。</p>
<p>3、 如果要取消已经配置了的用户，取消列表用户的勾选就行了，如果要新增通知的用用户，勾选上点保存即可。</p>
<h6 id="1112310">1.1.1.2.3.10<strong>版本信息提供</strong><a class="headerlink" href="#1112310" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.10.1<strong>功能描述</strong></p>
<p>提供基础平台系统版本信息供主备后台程序判断主备机系统版本是否相同。</p>
<p>1.1.1.2.3.10.2<strong>界面原型</strong></p>
<p>无</p>
<p>1.1.1.2.3.10.3<strong>功能设计</strong></p>
<p>1、 初始化安装系统的时候由初始化安装脚本写入系统版本号到文件。</p>
<p>2、 系统升级的时候由升级脚本写入系统版本号到文件。</p>
<p>3、 主备配置是同时会检查系统版本号和license授权信息是否一致</p>
<h6 id="1112311">1.1.1.2.3.11<strong>同步的数据库表信息</strong><a class="headerlink" href="#1112311" title="Permanent link">¶</a></h6>
<p>1.1.1.2.3.11.1<strong>功能描述</strong></p>
<p>以json格式提供基础平台的postgresql数据库和表信息。</p>
<p>1.1.1.2.3.11.2<strong>界面原型</strong></p>
<p>无</p>
<p>1.1.1.2.3.11.3<strong>功能设计</strong></p>
<p>主备机间需要将基础平台的数据库数据进行同步，将需要同步的表名写入sync_etc_table.json文件提供给主备后台程序。</p>
<p>具体备份表：除了系统操作日志表、登录日志表、license数据表、热备事件表、配置备份表、系统升级日志表、系统在线用户表，其余表都需要同步。</p>
<p>详细配置参考《统一主备产品集成概要设计》。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps76.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps76.png"/></a></p>
<h5 id="1113_2">1.1.1.3 <strong>系统参数配置</strong><a class="headerlink" href="#1113_2" title="Permanent link">¶</a></h5>
<h6 id="11131_2">1.1.1.3.1<strong>功能描述</strong><a class="headerlink" href="#11131_2" title="Permanent link">¶</a></h6>
<p>提供相关系统参数配置功能。</p>
<h6 id="11132_2">1.1.1.3.2<strong>功能设计</strong><a class="headerlink" href="#11132_2" title="Permanent link">¶</a></h6>
<p>1、 系统参数在tab页展示(或单页分块展示)，根据系统参数的分类在不同tab页下展示(或单页分块展示)。</p>
<p>2、 系统参数项为内置数据，参数项的值是可以用户编辑修改的。</p>
<p><del>3、</del> <del>Redis缓存中存放系统参数数据。</del></p>
<p>4、平台参数类型目前支持登录配置、业务参数配置、系统配置、通知服务配置。</p>
<p>5、当文本框中带有占位符，提示清楚每个占位符代表的含义。</p>
<h6 id="111321_2">1.1.1.3.2.1登录配置<a class="headerlink" href="#111321_2" title="Permanent link">¶</a></h6>
<p>1、 平台密码找回短信模板：文本框类型，用户找回密码短信模板。</p>
<p>2、 平台密码找回邮箱模板：文本框类型，用户找回密码邮件模板。</p>
<p>3、 平台登录短信通知模板：文本框类型，用户登录后短信通知模板。</p>
<p>4、 平台登录邮箱通知模板：文本框类型，用户登录后邮件通知模板。</p>
<p>5、 首次登陆是否改密:单选框类型(进系统后判断cas不处理)</p>
<p>6、 是否开启登陆验证码, 单选框类型 (cas实现)</p>
<p>7、 错误几次开启登录验证码 数字选择框(cas实现)</p>
<p>8、 系统配置的超时锁屏是否开启 单选框、多长时间锁屏数字选择框(进系统后判断cas不处理)</p>
<h6 id="111322_1">1.1.1.3.2.2<strong>业务参数配置</strong><a class="headerlink" href="#111322_1" title="Permanent link">¶</a></h6>
<p>1、 用户默认有效时间配置（/月）：数字选择器类型，用户默认有效时间，单位为月。</p>
<p>2、 用户有效期到期前多少天提醒（/天）：数字选择器类型，用户有效期到期前多少天对用户进行通知，单位为天。</p>
<p>3、 用户僵尸帐号配置：数字选择器类型，多少天未登录的用户算作僵尸帐号。</p>
<p>4、 资源僵尸帐号配置：数字选择器类型，多少天未登录的资源帐号算作僵尸帐号。</p>
<p>5、 用户有效期即将到期通知类型：复选框，短信通知、邮件通知。</p>
<p>6、 用户有效期即将到期短信通知模板：文本框类型。</p>
<p>7、 用户有效期即将到期邮件通知模板：文本框类型。</p>
<h6 id="111323_2">1.1.1.3.2.3<strong>系统配置</strong><a class="headerlink" href="#111323_2" title="Permanent link">¶</a></h6>
<p>1、 服务器CPU告警阈值：数字选择器类型，当CPU使用量超过这个百分比的时候进行告警</p>
<p>2、 服务器内存告警阈值：数字选择器类型，当内存使用量超过这个百分比的时候进行告警。</p>
<p>3、 服务器磁盘告警阈值：数字选择器类型，当磁盘使用量超过这个百分比的时候进行告警。</p>
<p>4、 磁盘清理阈值百分比：数字选择器类型，当磁盘使用量超过这个百分比的时候触发磁盘清理。（提示清理哪些东西）</p>
<h6 id="111324_1">1.1.1.3.2.4<strong>通知服务配置</strong><a class="headerlink" href="#111324_1" title="Permanent link">¶</a></h6>
<p>1、用户创建和改密通知类型：复选框，短信通知、邮件通知。</p>
<p>2、用户创建和改密短信通知模板：文本框类型。</p>
<p>3、用户创建和改密邮件通知模板：文本框类型。</p>
<p>4、用户密码重置通知类型：复选框，短信通知、邮件通知。</p>
<p>5、用户密码重置短信通知模板：文本框类型。</p>
<p>6、用户密码重置邮件通知模板：文本框类型。</p>
<p>7、主备事件通知类型：复选框，短信通知、邮件通知。</p>
<p>8、主备事件通知短信模板：文本框类型。</p>
<p>9、主备事件通知邮件模板：文本框类型。</p>
<p>10、能力组件监控告警通知类型：复选框，短信通知、邮件通知。</p>
<p>11、能力组件监控告警短信通知模板：文本框类型。</p>
<p>12、能力组件监控告警邮件通知模板：文本框类型。</p>
<h6 id="11133_2">1.1.1.3.3<strong>数据结构</strong><a class="headerlink" href="#11133_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps77.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps77.jpg"/></a> </p>
<h5 id="1114_2">1.1.1.4 <strong>系统</strong><strong>权限</strong><strong>管理</strong><a class="headerlink" href="#1114_2" title="Permanent link">¶</a></h5>
<h6 id="11141_2">1.1.1.4.1<strong>功能描述</strong><a class="headerlink" href="#11141_2" title="Permanent link">¶</a></h6>
<p>实现基于角色的权限管理功能，角色树形管理与控制。支持角色增删改查、分配用户、功能权限配置、数据权限配置。功能权限下的功能权限点以URL为粒度，实现URL鉴权，功能权限以功能为控制维度，一个功能权限可包含多个权限点。数据权限以组织机构、资源组为控制维度。角色支持分级管理，即父角色可以管理子角色，包括角色创建、修改、删除、分配权限等，为子角色分配的权限不能大于当前用户拥有的角色。一个用户可以关联多个角色，取权限的并集,系统默认初始化审计管理员、系统管理员、安全管理员三个角色，三个角色预置下列权限</p>
<p>审计管理员包括 系统登录日志，系统操作日志权限</p>
<p>系统管理员包括全部权限</p>
<p>Administrator 角色 不能删也不改 admin授权给他,admin 不能取消授权,admin可用修改名称,要展示</p>
<p>安全管理员包含用户管理和资源管理权限</p>
<p>预置的三个角色可以修改包含的权限以及修改和删除对应的角色信息；</p>
<p>默认初始化超级管理员用户，拥有所有权限，超级管理员用户 id 为 admin 且不可修改，如有需要用户名可通过数据库修改。 <del>普通账号<sub>~</sub><sub>角色</sub><sub>~</sub>和<sub>~</sub>~超级管理员角色</del></p>
<h6 id="11142_2">1.1.1.4.2<strong>功能设计</strong><a class="headerlink" href="#11142_2" title="Permanent link">¶</a></h6>
<h6 id="111421_2">1.1.1.4.2.1<strong>查询角色树</strong><a class="headerlink" href="#111421_2" title="Permanent link">¶</a></h6>
<p>查询角色树，查询当前用户拥有的角色树，只返回当前角色授权了的角色信息。</p>
<h6 id="111422_2">1.1.1.4.2.2<strong>新增/修改角色</strong><a class="headerlink" href="#111422_2" title="Permanent link">¶</a></h6>
<p>新增或修改已有角色，新增、修改角色不涉及角色的权限，仅修改角色数据本身。新增修改角色后均发送角色变更事件。</p>
<h6 id="111423_1">1.1.1.4.2.3<strong>删除角色</strong><a class="headerlink" href="#111423_1" title="Permanent link">¶</a></h6>
<p>删除角色，只能删除叶子节点的角色，删除后角色与用户的<sub>~下</sub><del><sub>用户<sub>~关联关系一起删除</sub>~将会对应删除</sub></del><sub>，</sub><del><sub>删除后</sub></del><sub>角色下用户的权限同步改变</sub>~、角色与功能权限点的关联关系一起删除、角色与数据权限的关联关系一起删除。删除角色后发送角色删除事件,有绑定关系不能删除,要有提示</p>
<h6 id="111424">1.1.1.4.2.4<strong>查询/更新角色下功能权限</strong><a class="headerlink" href="#111424" title="Permanent link">¶</a></h6>
<p>功能权限：权限点集合，可能包含多个权限点，与角色关联的始终是具体权限点，如果一个角色拥有某个功能权限关联的所有权限则这个角色就拥有这个功能权限</p>
<p>查询角色下功能权限指定角色及其下级角色所有的功能权限(过滤lincense不包含的权限点)，或更新角色下功能权限,更新角色功能权限时先检验当前系统license授权的权限是否存在,若不存在提示保存失败，更新角色下功能权限后发送角色功能权限变更事件</p>
<h6 id="111425">1.1.1.4.2.5<strong>查询/更新角色下数据权限</strong><a class="headerlink" href="#111425" title="Permanent link">¶</a></h6>
<p>查询<sub>~获取</sub>~或者更新角色下拥有的数据权限，查询的是指定角色及其下级角色所有的数据权限，更新的是指定角色本身的数据权限。更新时，先删除以前的角色数据权限关联数据，然后再添加指定的新的角色数据权限关联关系。更新角色下数据权限后发送角色数据权限变更事件。默认不配置数据权限不具备数据权限,如配置了任意一条数据权限只有配置的数据权限</p>
<h6 id="111426">1.1.1.4.2.6<strong>角色下用户查询/修改</strong><a class="headerlink" href="#111426" title="Permanent link">¶</a></h6>
<p>分页查询角色下的用户，角色下添加用户、删除用户，角色删除时，角色与用户、角色与各个权限的关联关系都会删除<sub>~后</sub>~。</p>
<h6 id="111427">1.1.1.4.2.7<strong>查询用户菜单树</strong><a class="headerlink" href="#111427" title="Permanent link">¶</a></h6>
<p>查询当前系统license授权的权限中当前用户要显示的菜单，按树形结构返回，根据用户的权限查询出功能权限，再根据功能权限及功能权限与菜单的关联关系查询出用户的菜单信息，最后根据菜单的上下级关系生成用户的菜单树，树的每个节点除了包含节点本身之外还包含当前节点级别的功能权限信息。比如以下树（树的字段名字未定，后面根据实际情况定，这里只是提供一个例子）：</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>{<br/><br/>  “nodeList”: [<br/><br/>    {<br/><br/>      “menuInfo”: {<br/><br/>        “id”: “platformconfiguration”,<br/><br/>        “pid”: “safemanager”,<br/><br/>        “name”: “平台配置”<br/><br/>      },<br/><br/>      “permissionGroups”: [<br/><br/>        {<br/><br/>          “id”: “platformconfiguration_platformconfiguration”,<br/><br/>          “name”: “平台配置”<br/><br/>        }<br/><br/>      ],<br/><br/>      “childNodes”: [<br/><br/>        {<br/><br/>          “menuInfo”: {<br/><br/>            “id”: “resTool”,<br/><br/>            “pid”: “platformconfiguration”,<br/><br/>            “name”: “登录工具管理”<br/><br/>          },<br/><br/>          “”: [<br/><br/>            { permissionGroups<br/><br/>              “id”: “resTool_restool_update_res”,<br/><br/>              “name”: “工具修改资源”<br/><br/>            }<br/><br/>          ]<br/><br/>        }<br/><br/>      ]<br/><br/>    }<br/><br/>  ]<br/><br/>}</td>
</tr>
</tbody>
</table>
<h6 id="111428">1.1.1.4.2.8 <a class="headerlink" href="#111428" title="Permanent link">¶</a></h6>
<h6 id="11143_2">1.1.1.4.3<strong>数据结构</strong><a class="headerlink" href="#11143_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps78.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps78.jpg"/></a> </p>
<h5 id="1115_2">1.1.1.5 <strong>系统日志管理</strong><a class="headerlink" href="#1115_2" title="Permanent link">¶</a></h5>
<h6 id="11151_2">1.1.1.5.1<strong>系统登录日志</strong><a class="headerlink" href="#11151_2" title="Permanent link">¶</a></h6>
<h6 id="111511">1.1.1.5.1.1<strong>功能描述</strong><a class="headerlink" href="#111511" title="Permanent link">¶</a></h6>
<p>日志内容包含登录用户、组织机构、时间、日志级别、源ip、日志类型、操作详情、登录结果，日志支持按照用户分权分域。产品考虑资源分权分域,后期考虑按资源维度分权分域</p>
<h6 id="111512">1.1.1.5.1.2<strong>功能设计</strong><a class="headerlink" href="#111512" title="Permanent link">¶</a></h6>
<p>1.1.1.5.1.2.1<strong>日志查询</strong></p>
<p>可通过用户名、时间、源IP、登录结果、组织机构几个参数分页查询登录日志，分页大小可以指定。</p>
<h6 id="11152_2">1.1.1.5.2<strong>系统操作日志</strong><a class="headerlink" href="#11152_2" title="Permanent link">¶</a></h6>
<h6 id="111521_2">1.1.1.5.2.1<strong>功能描述</strong><a class="headerlink" href="#111521_2" title="Permanent link">¶</a></h6>
<p>日志内容包含用户名、时间、日志级别、源IP、操作类型、操作结果、组织机构，支持按照用户分权分域。</p>
<p>定时上报产生的日志不记录为操作日志。</p>
<p>日志翻译：</p>
<p>操作列提供详情按钮，弹框展示翻译页面，页面分上下两部分，上半部分展示翻译内容，下半部分展示原始报文。</p>
<p>翻译时，当为新增/删除时，翻译字段属性和字段值，翻译来源为通过查询表t_sys_log_translate获取。</p>
<p>当为修改时，分两部分展示，上部分展示修改前数据（翻译），下部分展示修改后数据（翻译）</p>
<p>通过module查询翻译字段，根据属性name进行匹配，匹配上之后则替换之前的值，未匹配或出现异常，则移除该属性。即只展示翻译表里配置的属性</p>
<h6 id="111522_2">1.1.1.5.2.2<strong>功能设计</strong><a class="headerlink" href="#111522_2" title="Permanent link">¶</a></h6>
<p>1.1.1.5.2.2.1<strong>日志查询</strong></p>
<p>可通过用户名、时间、日志级别、源IP、日志类型、操作详情、组织机构几个参数分页查询登录日志，分页大小可以指定。</p>
<h6 id="11153_2">1.1.1.5.3<strong>系统日志</strong><a class="headerlink" href="#11153_2" title="Permanent link">¶</a></h6>
<h6 id="111531">1.1.1.5.3.1<strong>功能描述</strong><a class="headerlink" href="#111531" title="Permanent link">¶</a></h6>
<p>程序内部产生的日志称为系统日志</p>
<p>目前主要包括以下日志：</p>
<p>同步日志</p>
<p>配置备份日志</p>
<p>发送短信、邮件日志</p>
<p>列表展示如下信息：</p>
<p>时间、模块、对象、类型、结果、日志级别、内容</p>
<p>列表默认按照修改时间降序排序</p>
<p>模糊查询按照对象进行查询</p>
<p>高级查询提供按照时间段、模块、对象、类型、结果、日志级别进行查询</p>
<h6 id="111532">1.1.1.5.3.2<strong>功能设计</strong><a class="headerlink" href="#111532" title="Permanent link">¶</a></h6>
<h5 id="1116_2">1.1.1.6 <strong>系统配置</strong><a class="headerlink" href="#1116_2" title="Permanent link">¶</a></h5>
<h6 id="11161_2">1.1.1.6.1<strong>邮件配置</strong><a class="headerlink" href="#11161_2" title="Permanent link">¶</a></h6>
<h6 id="111611">1.1.1.6.1.1<strong>功能描述</strong><a class="headerlink" href="#111611" title="Permanent link">¶</a></h6>
<p>支持邮箱服务器信息的配置，配置变更后发送邮箱配置变更事件,邮件服务完成配置拨测和具体的邮件发送动作。</p>
<h6 id="111612">1.1.1.6.1.2<strong>功能设计</strong><a class="headerlink" href="#111612" title="Permanent link">¶</a></h6>
<p>1.1.1.6.1.2.1<strong>查询邮件</strong><strong>配置信息</strong></p>
<p>返回邮件服务器配置信息,包含用户名,密码,邮件服务器地址,服务器端口号,邮件服务器拨测状态</p>
<p>1.1.1.6.1.2.2<strong>修改邮件配置</strong><strong>信息</strong></p>
<p>修改邮件服务器配置信息,包含用户名,密码,邮件服务器地址,服务器端口号,当保存邮件配置信息后发送邮件配置变更事件,<del>邮件服务接收<sub>~</sub><sub>到</sub><sub>~</sub>事件<sub>~</sub><sub>后开始拨测,</sub><sub>~</sub>拨测<sub>~</sub><sub>完成后调用系统服务邮件</sub><sub>~</sub>修改<sub>~</sub><sub>接口</sub><sub>~</sub>更新<sub>~</sub>~拨测状态</del></p>
<p>1.1.1.6.1.2.3<strong>邮件配置拨测</strong></p>
<p>当提交邮件配置拨测请求后发送邮件配置拨测事件, 邮件服务接收到事件后开始拨测,拨测完成后调用系统服务邮件配置修改接口更新拨测状态</p>
<h6 id="111613">1.1.1.6.1.3<strong>数据结构</strong><a class="headerlink" href="#111613" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps79.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps79.jpg"/></a> </p>
<h6 id="11162_2">1.1.1.6.2<strong>短信配置</strong><a class="headerlink" href="#11162_2" title="Permanent link">¶</a></h6>
<h6 id="111621_2">1.1.1.6.2.1<strong>功能描述</strong><a class="headerlink" href="#111621_2" title="Permanent link">¶</a></h6>
<p>支持三大运营商短信网关的参数配置，配置变更后发送短信配置变更事件,短信服务完成配置拨测和具体的短信发送动作。</p>
<h6 id="111622_2">1.1.1.6.2.2<strong>功能设计</strong><a class="headerlink" href="#111622_2" title="Permanent link">¶</a></h6>
<p>1.1.1.6.2.2.1<strong>查询短信配置</strong></p>
<p>返回短信网关配置信息,包含用户名,密码,短信网关地址,服务器端口号,SP接入号, 短信网关类型, 发送方号码,短信网关拨测状态。</p>
<p>1.1.1.6.2.2.2<strong>修改短信配置</strong></p>
<p>修改短信网关配置信息,包含用户名,密码,短信网关地址,服务器端口号,SP接入号, 短信网关类型, 发送方号码,短信网关拨测状态, 短信服务接收到事件后开始拨测,拨测完成后调用系统服务短信配置修改接口更新拨测状态</p>
<p>1.1.1.6.2.2.3<strong>短信</strong><strong>配置拨测</strong></p>
<p>当提交短信配置拨测请求后发送短信配置拨测事件,短信服务接收到事件后开始拨测,拨测完成后调用系统服务短信配置修改接口更新拨测状态</p>
<h6 id="111623_2">1.1.1.6.2.3<strong>数据结构</strong><a class="headerlink" href="#111623_2" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps80.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps80.jpg"/></a> </p>
<h6 id="11163https">1.1.1.6.3<strong>HTTPS配置</strong><a class="headerlink" href="#11163https" title="Permanent link">¶</a></h6>
<h6 id="111631">1.1.1.6.3.1<strong>功能描述</strong><a class="headerlink" href="#111631" title="Permanent link">¶</a></h6>
<p>提供上传证书功能，用户可以上传自己的安全证书，下发证书更新事件。</p>
<h6 id="111632">1.1.1.6.3.2<strong>功能设计</strong><a class="headerlink" href="#111632" title="Permanent link">¶</a></h6>
<p>1.1.1.6.3.2.1<strong>上传证书</strong></p>
<p>提供上传证书功能，用户可上传自己的安全证书,上传文件分 cert文件和key,证书格式PEM</p>
<p>文件上传后保存到/data/platform/common/traefik/cert目录,</p>
<p>certFile文件名server.crt</p>
<p>keyfile文件名 server_key.pem</p>
<p>同时下发证书更新事件,系统配置服务接收到事件后重启traefik.完成证书刷新.</p>
<h6 id="11164">1.1.1.6.4<strong>日志外发配置</strong><a class="headerlink" href="#11164" title="Permanent link">¶</a></h6>
<h6 id="111641">1.1.1.6.4.1<strong>功能描述</strong><a class="headerlink" href="#111641" title="Permanent link">¶</a></h6>
<p>支持syslog、ftp方式进行日志外发。支持控制外发的系统日志类型(系统操作日志, 系统登录日志),日志服务根据已启用的日志外发配置,以JSON字符串格式外发到对应的端点</p>
<h6 id="111642">1.1.1.6.4.2<strong>功能设计</strong><a class="headerlink" href="#111642" title="Permanent link">¶</a></h6>
<p>1.1.1.6.4.2.1<strong>分页查询日志外发配置列表</strong></p>
<p>分页查询日志外发配置列表，展示字段包括配置名称、发送方式、目标服务器IP、目标服务器端口、传输协议、日志类型、日志格式、状态。</p>
<p>1.1.1.6.4.2.2<strong>新增日志外发配置</strong></p>
<p>1、 syslog日志外发：需要配置日志外发传输协议、syslog服务器IP地址、端口号、以及选择日志类型,。</p>
<p>2、 ftp日志外发：需要配置ftp服务器IP地址、端口号、ftp服务器路径、ftp服务器用户、ftp服务器用户密码、以及选择日志类型。</p>
<p>3、 保存后触发外发配置事件,日志服务接收到事件后根据参数信息判断为启用状态以JSON格式开始外发日志到对应端口</p>
<p>1.1.1.6.4.2.3<strong>删除日志外发</strong></p>
<p>1、 将日志外发配置删除。</p>
<p>2、 保存后触发外发配置事件,日志服务接收到事件后根据参数信息判断为启用状态以JSON格式开始外发日志到对应端口</p>
<p>1.1.1.6.4.2.4<strong>启用禁用日志外发配置</strong></p>
<p>启用的日志外发配置才能够生效，禁用的日志外发配置是不会生效的。</p>
<p>1、 保存后触发外发配置事件,日志服务接收到事件后根据参数信息判断为启用状态以JSON格式开始外发日志到对应端口</p>
<h6 id="11165">1.1.1.6.5<strong>电源管理</strong><a class="headerlink" href="#11165" title="Permanent link">¶</a></h6>
<h6 id="111651">1.1.1.6.5.1<strong>功能描述</strong><a class="headerlink" href="#111651" title="Permanent link">¶</a></h6>
<p>电源管理包含功能重启服务器和关闭服务器,该功能默认只有超级管理员才拥有该权限</p>
<h6 id="111652">1.1.1.6.5.2<strong>功能设计</strong><a class="headerlink" href="#111652" title="Permanent link">¶</a></h6>
<p>1、重启服务器</p>
<p>1、 重启服务器：产生重启服务器事件，系统配置服务接收重启服务器事件后调用系统接口完成服务器重启。</p>
<p>2、 关闭服务器：产生关闭服务器事件，系统配置服务接收重启服务器事件后调用系统接口完成服务器关闭。</p>
<h6 id="11166">1.1.1.6.6<strong>网络配置</strong><a class="headerlink" href="#11166" title="Permanent link">¶</a></h6>
<h6 id="111661">1.1.1.6.6.1<strong>功能描述</strong><a class="headerlink" href="#111661" title="Permanent link">¶</a></h6>
<p>配置服务器的IPV4以及IPV6地址、子网掩码、网关。</p>
<h6 id="111662">1.1.1.6.6.2<strong>功能设计</strong><a class="headerlink" href="#111662" title="Permanent link">¶</a></h6>
<p>1.1.1.6.6.2.1<strong>网卡信息</strong><strong>上报接口</strong></p>
<p>系统配置服务通过该接口上报所属主机的网络配置(过滤掉虚拟网卡)信息网络配置包括IP,NETMASK,GATEWAY,DNS以及接口速率</p>
<p>和架构设计冲突点,主机上部署的系统配置服务都通过接口上报网卡状态,列表展示所有主机的网卡信息,修改配置下发事件后,系统配置服务接收到事件通过 主机名来判断是否本主机的网络配置请求</p>
<p>1.通过系统管理可用管理所有主机网络配置入口单一</p>
<p>2.不再需要登录到后台管理菜单来修改IP</p>
<p>1.1.1.6.6.2.2<strong>查询所有网卡信息</strong></p>
<p>网卡信息包含主机名,网卡名称、各网卡对应的IPV4地址、IPV6地址、子网掩码、网关、网卡状态、接口速率。 </p>
<p>1.1.1.6.6.2.3<strong>配置网卡</strong><strong>I</strong><strong>PV4</strong></p>
<p>配置网卡的IPV4地址、子网掩码、网关等信息。</p>
<p>产生配置网络事件，系统管理服务获取到对应的事件后调用系统接口完成配置,同时重启相关组件。</p>
<p>1.1.1.6.6.2.4<strong>配置网卡</strong><strong>I</strong><strong>PV6</strong></p>
<p>配置网卡的IPV6地址、子网掩码、网关等信息。</p>
<p>产生配置网络事件，系统管理服务获取到对应的事件后调用系统接口完成配置,同时重启相关组件。</p>
<p>1.1.1.6.6.2.5<strong>网络配置事件</strong></p>
<p>1. 系统配置服务更新系统hosts文件中IP和主机名的映射关系。</p>
<p>2. 系统配置服务调用系统接口完成网络配置。</p>
<p>3. 系统配置服务重启该主机上的组件。</p>
<p>4. 写缓存</p>
<h6 id="11167">1.1.1.6.7<strong>时间管理</strong><a class="headerlink" href="#11167" title="Permanent link">¶</a></h6>
<h6 id="111671">1.1.1.6.7.1<strong>功能描述</strong><a class="headerlink" href="#111671" title="Permanent link">¶</a></h6>
<p>获取系统时间、修改系统时间、配置ntp同步时间。</p>
<h6 id="111672">1.1.1.6.7.2<strong>功能设计</strong><a class="headerlink" href="#111672" title="Permanent link">¶</a></h6>
<p>1、 能够获取当前系统所支持的时区列表。</p>
<p>2、 可以获取当前系统所在时区，当前系统时间</p>
<p>3、 可以修改当前系统使用的时区、时间信息，修改系统时间会产生系统时间修改事件。</p>
<p>4、 配置ntp服务器地址 默认包含 阿里云的时间服务器和腾讯的时间服务器 也可以自定义NTP地址(域名或IP)。</p>
<p>1.1.1.6.7.2.1<strong>时间配置上报接口</strong></p>
<p>系统配置服务通过该接口上报所属主机的时间配置信息,包括支持的时区列表,和当前系统配置的时区,NTP启用/禁用状态,NTP服务器地址</p>
<p>1.1.1.6.7.2.2<strong>时间</strong><strong>查询接口</strong></p>
<p>返回系统管理服务所在服务器支持的时区列表和当前服务器所配置的时区信息以及当前时间</p>
<p>格式如下</p>
<p>{</p>
<p> timezones:[“Asia/shanghai”,” Asia/hongkong”]</p>
<p> timezone: Asia/shanghai</p>
<p> time:”2021/02/02 20:20:20”</p>
<p>}</p>
<p>1.1.1.6.7.2.3<strong>时间更新</strong><strong>接口</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps81.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps81.jpg"/></a> </p>
<p>更新当前服务器时间,参数包含时间和时区</p>
<p>1.1.1.6.7.2.4<strong>NTP配置</strong><strong>接口</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps82.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps82.jpg"/></a> </p>
<p>1. 参数包含启用状态,NTP服务器地址,保存后发送事件NTP配置事件,系统配置服务接收到该事件后开启和禁用NTP时间同步</p>
<ol start="2">
<li>当配置的是自定义服务器地址时,需保存当前自定义服务器地址到NTP服务器列表中</li>
</ol>
<p>1.1.1.6.7.2.5<strong>N</strong><strong>TP</strong><strong>地址列表</strong><strong>查询接口</strong></p>
<p>返回系统可配置的ntp服务器地址,启用禁用状态,当前选择的NTP服务器地址NTP时间同步接口</p>
<h6 id="11111_3">1.1.1.1.1<strong>配置备份</strong><a class="headerlink" href="#11111_3" title="Permanent link">¶</a></h6>
<h6 id="111673">1.1.1.6.7.3<strong>功能描述</strong><a class="headerlink" href="#111673" title="Permanent link">¶</a></h6>
<p>备份以及恢复当前服务器数据库数据。</p>
<h6 id="111674">1.1.1.6.7.4<strong>功能设计</strong><a class="headerlink" href="#111674" title="Permanent link">¶</a></h6>
<p>1.1.1.6.7.4.1<strong>配置备份文件</strong><strong>列表</strong></p>
<p>1、 配置备份列表展示文件备份日期，备份文件大小，版本号以及操作列（操作列包含下载备份文件按钮和恢复备份文件按钮）。</p>
<p>2、 配置备份列表按照备份时间倒序排序。</p>
<p>3、 列表查询条件有备份日期范围查询。</p>
<p>1.1.1.6.7.4.2<strong>导入备份文件</strong></p>
<p>1、导入备份文件必须下载后没有修改过的zip后缀类型加密压缩文件。</p>
<p>2、将导入文件放在指定/data/database/backup/目录下。</p>
<p>3、导入配置文件后先做文件校验,判断是否合法备份文件</p>
<p>4、导入备份文件需读取读备份文件的版本信息后入库 </p>
<p>5、产生备份恢复事件，其余工作在备份恢复事件中处理。</p>
<p>1.1.1.6.7.4.3<strong>手动配置备份</strong></p>
<p>产生配置备份事件，其余工作在配置备份事件中处理。</p>
<p>1.1.1.6.7.4.4<strong>删除备份</strong></p>
<p>删除服务器上的备份文件，删除配置备份表中的此备份文件记录信息。</p>
<p>1.1.1.6.7.4.5<strong>下载备份</strong></p>
<p>下载指定的配置备份文件。</p>
<p>1.1.1.6.7.4.6<strong>恢复备份</strong></p>
<p>1、 跨大版本之间的数据不能恢复，小版本默认是数据库结构没有变化允许恢复数据，如果跨大版本即使是数据库结构没有变化也不允许恢复。</p>
<p>2、 产生备份恢复事件。</p>
<p>1.1.1.6.7.4.7<strong>F</strong><strong>TP外发配置</strong></p>
<p>保存ftp外发配置。配置信息包含IP地址、端口、用户名、密码、存放路径（真实存放路径为用户路径+填写的存放路径）。</p>
<p>1.1.1.6.7.4.8<strong>配置备份</strong><strong>上报</strong><strong>接口</strong></p>
<p>配置备份服务通过该接口上报,配置备份信息包含 配置备份时间,配置备份文件大小,配置备份路径。</p>
<h6 id="111675">1.1.1.6.7.5<strong>数据结构</strong><a class="headerlink" href="#111675" title="Permanent link">¶</a></h6>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps83.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps83.jpg"/></a> </p>
<h5 id="1117_2">1.1.1.7 <strong>系统信息</strong><a class="headerlink" href="#1117_2" title="Permanent link">¶</a></h5>
<h6 id="11171_2">1.1.1.7.1<strong>系统</strong><strong>组件管理</strong><a class="headerlink" href="#11171_2" title="Permanent link">¶</a></h6>
<h6 id="111711">1.1.1.7.1.1<strong>功能描述</strong><a class="headerlink" href="#111711" title="Permanent link">¶</a></h6>
<p>组件状态监控主要对平台组件进行监控，目前监控的组件有用户服务、资源服务、系统服务、邮件服务、短信服务、日志服务、数据同步服务、主备服务、系统配置服务、升级服务、API网关、通知服务、定时任务服务、账号采集服务、核查服务</p>
<h6 id="111712">1.1.1.7.1.2<strong>功能设计</strong><a class="headerlink" href="#111712" title="Permanent link">¶</a></h6>
<p>1.1.1.7.1.2.1<strong>系统</strong><strong>组件</strong><strong>状态上报</strong><strong>接口</strong></p>
<p>系统配置服务调用supervisor接口获取主机上运行的系统组件状态包含 服务名、PID、组件名同时调用系统接口获取主机的内存,CPU磁盘使用率一起上报给系统管理服务入库.</p>
<p>1.1.1.7.1.2.2<strong>获取系统</strong><strong>组件</strong><strong>列表</strong></p>
<p>界面列表展示组件名称、IP，当前运行状态（启动中，正在运行、正在停止、已停止）、最后一次启动时间,系统CPU,内存,磁盘使用率。当组件状态为运行中可以对组件进行停止操作，当组件运行状态为已停止可对组件进行启动操作，同时提供下载运行日志链接下载运行日志。</p>
<p>1.1.1.7.1.2.3<strong>停止系统</strong><strong>组件</strong></p>
<p>1.判断组件状态是否为运行中,如果状态为运行中修改系统组件状态为正在停止</p>
<p>2.下发停止组件事件,参数包含系统组件所在主机名,服务名,和PID,系统配置服务接收到事件后,通过主机名判断是否是本机进程,如果是本机进程通过supervisor接口停止对应的组件后调用系统组件状态上报接口更新组件状态为已停止.</p>
<p>1.1.1.7.1.2.4<strong>启动</strong><strong>系统组件</strong></p>
<p>1.判断组件状态是否为停止状态,如果状态为停止修改系统组件状态为正在启动.</p>
<p>2.下发启动组件事件,参数包含系统组件所在主机名,服务名,和PID,系统配置服务接收到事件后,通过主机名判断是否是本机进程,如果是本机进程通过supervisor接口启动对应的组件后调用系统组件状态上报接口更新组件状态为运行中</p>
<p>1.1.1.7.1.2.5<strong>日志</strong><strong>下载接口</strong></p>
<p>下载日志服务收集到的系统运行日志接口,<del>日志<sub>~</sub><sub>服务默认保留</sub><sub>~</sub>7天<sub>~</sub>~日志</del>,不限制日志保存天数依赖定时组件日志清理机制来完成磁盘空间释放,下载文件是需要指定下载那天的文件如果不指定接口默认返回当前的日志,下载文件格式为gzip格式(带密码校验,必须输入密码后才可以节约,日志存储时,过滤敏感字段不做保存)</p>
<h6 id="11172_2">1.1.1.7.2<strong>系统升级</strong><a class="headerlink" href="#11172_2" title="Permanent link">¶</a></h6>
<h6 id="111721_1">1.1.1.7.2.1<strong>功能描述</strong><a class="headerlink" href="#111721_1" title="Permanent link">¶</a></h6>
<p>上传系统升级包，发送系统升级事件，系统升级服务接受到事件后下载对应的升级包后执行升级脚本完成升级。</p>
<h6 id="111722_1">1.1.1.7.2.2<strong>功能设计</strong><a class="headerlink" href="#111722_1" title="Permanent link">¶</a></h6>
<p>1.1.1.7.2.2.1<strong>升级文件目录结构</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps84.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps84.jpg"/></a> </p>
<p>version.json内容</p>
<p>{</p>
<p> “version”:”3.1.1” //系统版本号</p>
<p> “platform-user-service”:”1.0.1”, //组件版本号</p>
<p> “platform-sms-service”:”1.0.1” //组件版本号</p>
<p>}</p>
<p>1.1.1.7.2.2.2<strong>上传</strong><strong>升级文件接口</strong></p>
<p>1、 系统升级前端上传升级包，调用系统升级后端服务，由后端服务完成升级包上传和存储文件存储在/data/files/upload目录。</p>
<p>2、 校验升级文件是否为合法文件，检验升级文件版本是否大于服务版本表内各服务版本信息，如果存在系统版本表内服务版本号小于升级包的版本才可以上传成功</p>
<p>3、 如果文件合法触发系统升级事件,内部包含升级文件名和下载路径，后台升级服务订阅升级通知。</p>
<p>4、 后台升级服务 调用系统服务的HTTP下载接口API下载升级包后解压升级包执行升级脚本开始升。</p>
<p>5、 后台升级服务调用系统升级后端上报升级结果、版本号、升级详情。</p>
<p>6、 系统升级前端通过API轮询升级进度和升级结果。</p>
<p>1.1.1.7.2.2.3<strong>升级</strong><strong>历史记录列表</strong></p>
<p>返回历史升级记录列表包含更新版本号，更新时间，系统升级详情</p>
<p>1.1.1.7.2.2.4<strong>下载</strong><strong>升级文件接口</strong></p>
<p>系统升级服务调用该接口下载升级包</p>
<p>1.1.1.7.2.2.5<strong>升级状态查询接口</strong></p>
<p>查询升级服务上报的升级状态信息</p>
<p>1.1.1.7.2.2.6<strong>升级完成上报</strong><strong>接口</strong></p>
<p>系统升级服务通过该接口上报当前系统上各个组件版本号，包含主机名和组件名，组件版本号,存入系统组件版本表中</p>
<h6 id="11173license">1.1.1.7.3<strong>License管理</strong><a class="headerlink" href="#11173license" title="Permanent link">¶</a></h6>
<h6 id="111731_1">1.1.1.7.3.1<strong>功能描述</strong><a class="headerlink" href="#111731_1" title="Permanent link">¶</a></h6>
<p>License控制系统功能权限，系统会初始化部分功能权限为license管控的功能权限，其中只有授予了license功能权限的功能点才可以使用。</p>
<h6 id="111732_1">1.1.1.7.3.2<strong>功能设计</strong><a class="headerlink" href="#111732_1" title="Permanent link">¶</a></h6>
<p>1.1.1.7.3.2.1<strong>内置默认授权</strong></p>
<p>1、 平台部署完成后自带默认授权。</p>
<p>2、 内置的默认授权类型为试用授权，有效期为30天，带有一定（用户和资源）数量和全部功能。</p>
<p>3、 系统管理服务在第一次安装部署的时候，在主机下新建目录/data/platform/license/default，然后目录下新建default.license默认license授权文件。</p>
<p>4、 第二次重启系统管理服务的时候，会先判断/data/platform/license/default 目录下是否存在default.license文件，或者判断文件是否合法，存在不进行其余操作，如果不存在，那么在/data/platform/license/default目录下新建default.license默认授权文件</p>
<p>5、 默认授权内容如下：<br/>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nt">"deviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"564dfc97-a558-0253-fd1d-f5299aa0b116"</span><span class="p">,</span><span class="w"> </span><span class="err">**产品ID**</span><span class="p">{:</span><span class="w"> </span><span class="err">#产品ID</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~~admin~~试用授权"</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**客户名称**</span><span class="p">{:</span><span class="w"> </span><span class="err">#客户名称</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="nt">"version"</span><span class="p">:</span><span class="s2">"3.0.2.3.1922"</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**系统版本号**</span><span class="p">{:</span><span class="w"> </span><span class="err">#系统版本号</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="nt">"masterLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="nt">"sysResLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="nt">"appResLimit"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">" sensitiveFound # desensitive# conflictSlave "</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;**授权功能点**</span><span class="p">{:</span><span class="w"> </span><span class="err">#授权功能点</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span><span class="w"> </span><span class="err">**分隔**</span><span class="p">{:</span><span class="w"> </span><span class="err">#分隔</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="nt">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="err">**导入日期后</span><span class="mi">30</span><span class="err">天**</span><span class="p">{:</span><span class="w"> </span><span class="err">#导入日期后</span><span class="mi">30</span><span class="err">天</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="p">}</span>
</code></pre></div></p>
<p>6、 最后将json字符串加密存入default.license默认授权文件中。</p>
<p>1.1.1.7.3.2.2<strong>展示授权</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps85.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps85.jpg"/></a> </p>
<p>1、 展示license的基本信息，如客户名称、版本号、产品ID、授权类型、授权到期时间、授权用户数量（总共多少个、已使用多少个、剩余多少个）、授权系统资源数量（总共多少个、已使用多少个、剩余多少个）、授权应用功能资源数量（总共多少个、已使用多少个、剩余多少个），管控功能列表。</p>
<p>2、 正式授权不展示授权到期时间。</p>
<p>1.1.1.7.3.2.3<strong>生成正式授权文件</strong></p>
<p>1、 授权工具生成正式授权。</p>
<p>2、 生成正式授权文件名称为【基础平台产品正式授权_客户名称_用户数XX_系统资源数XX_应用资源数XX.license】。</p>
<p>3、 正式授权内容为</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nt">"deviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"564dfc97-a558-0253-fd1d-f5299aa0b116"</span><span class="p">,</span><span class="w"> </span><span class="err">**产品ID**</span><span class="p">{:</span><span class="w"> </span><span class="err">#产品ID</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**客户名称**</span><span class="p">{:</span><span class="w"> </span><span class="err">#客户名称</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="nt">"version"</span><span class="p">:</span><span class="s2">"3.0.2.3.1922"</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**系统版本号**</span><span class="p">{:</span><span class="w"> </span><span class="err">#系统版本号</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="nt">"masterLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="nt">"sysResLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="nt">"appResLimit"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"official"</span><span class="p">,</span>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">" sensitiveFound # desensitive# conflictSlave "</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;**授权功能点**</span><span class="p">{:</span><span class="w"> </span><span class="err">#授权功能点</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span><span class="w"> </span><span class="err">**分隔**</span><span class="p">{:</span><span class="w"> </span><span class="err">#分隔</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="p">}</span>
</code></pre></div>
<p>4、 正式授权没有结束时间。</p>
<p>5、 最后将json字符串加密存入授权文件中。</p>
<p>1.1.1.7.3.2.4<strong>生成试用授权文件</strong></p>
<p>1、 授权工具生成试用授权。</p>
<p>2、 生成正式授权文件名称为【基础平台产品试用授权_客户名称_用户数XX_系统资源数XX_应用资源数XX_授权到期时间-2021-03-09.license】。</p>
<p>3、 试用授权内容为</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">{</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**客户名称**</span><span class="p">{:</span><span class="w"> </span><span class="err">#客户名称</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nt">"version"</span><span class="p">:</span><span class="s2">"3.0.2.3.1922"</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;&amp;emsp;**系统版本号**</span><span class="p">{:</span><span class="w"> </span><span class="err">#系统版本号</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="nt">"masterLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="nt">"sysResLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="nt">"appResLimit"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">" temporary"</span><span class="p">,</span>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">" sensitiveFound # desensitive# conflictSlave "</span><span class="p">,</span><span class="w"> </span><span class="err">&amp;emsp;**授权功能点**</span><span class="p">{:</span><span class="w"> </span><span class="err">#授权功能点</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span><span class="w"> </span><span class="err">**分隔**</span><span class="p">{:</span><span class="w"> </span><span class="err">#分隔</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a>
<a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="nt">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="err">**导入日期后</span><span class="mi">30</span><span class="err">天**</span><span class="p">{:</span><span class="w"> </span><span class="err">#导入日期后</span><span class="mi">30</span><span class="err">天</span><span class="w"> </span><span class="err">.hash</span><span class="p">}</span>
<a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="p">}</span>
</code></pre></div>
<p>4、 试用授权没有产品ID。</p>
<p>5、 最后将json字符串加密存入授权文件中。</p>
<p>1.1.1.7.3.2.5<strong>导入license授权</strong></p>
<p>1、 正式授权导入：需要校验产品ID，产品ID不匹配提示授权文件不合法，存储于/data/platform/license/normal/normal.license文件中，如果normal.license文件中已存在内容，直接覆盖。</p>
<p>2、 试用授权导入：需要校验产品ID，产品ID不匹配提示授权文件不合法，存储于/data/platform/license/normal/normal.license文件中,如果normal.license文件中已存在内容，直接覆盖。</p>
<p>1.1.1.7.3.2.6<strong>license授权控制</strong></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps86.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps86.jpg"/></a> </p>
<p>1、 在上面的流程中，如果默认授权加载失败（文件丢失或者内容不合法），系统正常启动，在登录系统时给出提示。如果登录帐号有License管理功能权限则跳转到License管理界面，如果登录帐号没有License管理功能则提示联系管理员。</p>
<p>2、 对于试用授权（包括默认授权）到期前5天进行页面提醒重新授权。过期后如果登录帐号有License管理功能权限则跳转到License管理界面，如果登录帐号没有License管理功能则提示“系统授权已到期，请联系管理员”。</p>
<p>1.1.1.7.3.2.7<strong>license信息与license控制功能点入库</strong></p>
<p>1、 在系统生成默认授权文件以及导入license授权文件后，会将license信息写入到数据库中。</p>
<p>2、 将license基本信息存入license授权信息表，这个表里面存储的为当前系统使用的license授权信息。</p>
<p>3、 将liecnse控制的功能点写入license授权控制表中，这个表中的所有数据为需要控制的授权功能点，当license控制功能点改变的时候，更新license授权控制表中的数据即可。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps87.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps87.jpg"/></a> </p>
<h4 id="1118_1">1.1.1.8 <strong>系统登录</strong><a class="headerlink" href="#1118_1" title="Permanent link">¶</a></h4>
<h5 id="11181_1">1.1.1.8.1<strong>统一登录界面</strong><a class="headerlink" href="#11181_1" title="Permanent link">¶</a></h5>
<h6 id="111811">1.1.1.8.1.1<strong>功能描述</strong><a class="headerlink" href="#111811" title="Permanent link">¶</a></h6>
<p>忘记密码：用户忘记密码后可通过短信或邮箱进行身份校验后改密，</p>
<p>相关下载：提供证书、用户手册、环境检测助手、运维客户端等下载功能，</p>
<p>国际化：支持中文和英文之间的切换。</p>
<h6 id="111812">1.1.1.8.1.2<strong>功能设计</strong><a class="headerlink" href="#111812" title="Permanent link">¶</a></h6>
<p>1.1.1.8.1.2.1<strong>忘记密码</strong></p>
<p>忘记密码时通过手机验证码或者邮箱验证码，重置密码，平台提供忘记密码页面，登录服务器提供相关下载页面的跳转链接按钮。</p>
<p>1.1.1.8.1.2.2<strong>相关下载</strong></p>
<p>平台提供相关下载页面，下载内容包含 管理基础控件，监控回放组件 证书, C/S 客户端,用户手册</p>
<p>所有文件都保存在/data/files/download目录</p>
<p>1.1.1.8.1.2.3<strong>国际化</strong></p>
<p>页面提供国际化支持，可通过按钮实现语言切换。</p>
<h5 id="11182_1">1.1.1.8.2<strong>自服务</strong><a class="headerlink" href="#11182_1" title="Permanent link">¶</a></h5>
<h6 id="111821_1">1.1.1.8.2.1<strong>功能描述</strong><a class="headerlink" href="#111821_1" title="Permanent link">¶</a></h6>
<p>展示登录用户的详细信息并提供个人信息修改和密码修改功能。</p>
<h6 id="111822_1">1.1.1.8.2.2<strong>功能设计</strong><a class="headerlink" href="#111822_1" title="Permanent link">¶</a></h6>
<p>1.1.1.8.2.2.1<strong>个人信息管理</strong></p>
<p>展示登录用户的详细信息并提供个人信息修改和密码修改功能</p>
<h3 id="111_4">1.1.1 <strong>系统</strong><strong>后台服务</strong><a class="headerlink" href="#111_4" title="Permanent link">¶</a></h3>
<h4 id="1111_4">1.1.1.1 <strong>通知</strong><strong>服务</strong><a class="headerlink" href="#1111_4" title="Permanent link">¶</a></h4>
<h5 id="11111_4">1.1.1.1.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11111_4" title="Permanent link">¶</a></h5>
<p>通知服务监听kafka需发送短信或邮件相关事件,调用系统管理API获取配置的模板完成通知内容组装后发送对应的邮件或短信发送事件(邮件/短信通过不同topic来区分是发送短信还是发送邮件)</p>
<h5 id="11112_3">1.1.1.1.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11112_3" title="Permanent link">¶</a></h5>
<h6 id="111121_2">1.1.1.1.2.1<strong>事件</strong><strong>处理</strong><a class="headerlink" href="#111121_2" title="Permanent link">¶</a></h6>
<p>1. 短信登录事件</p>
<p>监控kafka消息队列里短信登录事件,解析消息参数后发送邮件,调用系统服务配置平台参数查询接口完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<p>2. 邮件登录事件</p>
<p>监控kafka消息队列里邮件登录事件,解析消息参数后发送邮件,调用系统服务配置平台参数查询接口完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>3. 主备切换事件</p>
<p>监控kafka消息队列里主备切换事件,调用系统服务配置平台参数查询接口获取主备告警配置, 若配置了邮件告警完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>若配置了短信告警完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<p>4. 改密事件</p>
<p>监控kafka消息队列里改密事件,调用系统服务配置平台参数查询接口获取改密配置, 若配置了邮件告警完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>若配置了短信告警完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<p>5. 账号解锁事件</p>
<p>监控kafka消息队列里账号解锁事件,调用系统服务配置平台参数查询接口获取账号解锁配置, 若配置了邮件告警完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>若配置了短信告警完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<p>6. 能力组件告警事件</p>
<p>监控kafka消息队列里能力组件告警事件,调用系统服务配置平台参数查询接口获取能力组件告警配置, 若配置了邮件告警完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>若配置了短信告警完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<p>7. 服务器告警事件</p>
<p>监控kafka消息队列里服务器告警事件,调用系统服务配置平台参数查询接口获取服务器告警配置, 若配置了邮件告警完成邮件内容组装后(包含消息接受人邮箱地址,消息内容),发送邮件发送事件,邮件服务接收到邮件发送事件后完成邮件发送任务</p>
<p>若配置了短信告警完成短信内容组装后(包含消息接受人电话号码,消息内容),发送短信发送事件,短信服务接收到短信发送事件后完成短信发送任务</p>
<h4 id="1112_4">1.1.1.2 <strong>邮件</strong><strong>服务</strong><a class="headerlink" href="#1112_4" title="Permanent link">¶</a></h4>
<h5 id="11121_3">1.1.1.2.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11121_3" title="Permanent link">¶</a></h5>
<p>监听kafka的邮件发送事件完成邮件发送和服务拨测动作</p>
<h5 id="11122_3">1.1.1.2.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11122_3" title="Permanent link">¶</a></h5>
<h6 id="111221_3">1.1.1.2.2.1<strong>事件</strong><strong>处理</strong><a class="headerlink" href="#111221_3" title="Permanent link">¶</a></h6>
<p>1. 邮件发送事件</p>
<p>监控kafka消息队列里的邮件发送事件,当收到邮件发送解析消息参数后发送邮件,发送完成后发送邮件完成事件</p>
<p>2. 配置拨测事件</p>
<p>监控kafka消息队列里的 配置拨测事件,当收到配置拨测事件后解析事件参数尝试发送测试邮件后</p>
<p>重新发送拨测结果事件，系统服务监听事件，完成配置状态更新</p>
<h4 id="1113_3">1.1.1.3 <strong>短信</strong><strong>服务</strong><a class="headerlink" href="#1113_3" title="Permanent link">¶</a></h4>
<h5 id="11131_3">1.1.1.3.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11131_3" title="Permanent link">¶</a></h5>
<p>监听kafka的短信发送事件完成短信发送和短信配置拨测动作</p>
<h5 id="11132_3">1.1.1.3.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11132_3" title="Permanent link">¶</a></h5>
<h6 id="111321_3">1.1.1.3.2.1<strong>事件</strong><strong>处理</strong><a class="headerlink" href="#111321_3" title="Permanent link">¶</a></h6>
<p>1. 短信发送事件</p>
<p>监控kafka消息队列里的短信发送事件,当收到短信发送解析消息参数后发送邮件,发送完成后发送短信完成事件</p>
<p>2. 配置拨测事件</p>
<p>监控kafka消息队列里的 配置拨测事件,当收到配置拨测事件后解析事件参数尝试发送测试短信后, 重新发送拨测结果事件，系统服务监听事件,完成配置状态更新</p>
<h4 id="1114api">1.1.1.4 <strong>API网关</strong><a class="headerlink" href="#1114api" title="Permanent link">¶</a></h4>
<h5 id="11141_3">1.1.1.4.1<strong>权限处理</strong><a class="headerlink" href="#11141_3" title="Permanent link">¶</a></h5>
<p>权限管理时序图：</p>
<p> <a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps88.jpg"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps88.jpg"/></a></p>
<p>流程图：</p>
<p> <a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps89.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps89.png"/></a></p>
<p>网关鉴权说明：</p>
<p>当网关收到请求时，根据URL判断请求是否需要鉴权，不需要鉴权的直接执行反向代理；对于需要鉴权的请求，将请求转发给鉴权服务器校验权限，权限校验通过时鉴权服务器将返回HTTP 200响应（响应头中携带有包含用户信息的）给网关，网关收到[200,300)之间的HTTP 响应码时将请求反向代理到后端服务器；校验失败返回非HTTP [200,300)之间的状态码给网关，网关不会执行后续步骤，直接将鉴权服务器的响应原样返回给客户端。</p>
<p>鉴权服务器说明：</p>
<p>鉴权服务器收到鉴权请求，首先判断是否登录。未登录的，返回HTTP重定向到cas登录服务器给网关，网关将重定向返回给客户端，引导客户端去登录，登录成功后cas登录服务器携带票据ticket重定向到网关，网关将请求转发给鉴权服务器，鉴权服务器判断票据是否有效，无效则再次返回登录重定向引导客户端去登录；票据合法则返回重定向设置cookie来标识当前请求已登录，重定向地址为当前请求地址，随后网关再次收到请求并将请求转发给鉴权服务器，鉴权服务器判断已登录，就校验已登录用户是否有权限访问当前URL，校验通过返回HTTP 200 并在响应头中携带用户信息JWT给网关，网关收到[200,300)之间的HTTP 响应码时将请求反向代理到后端服务器；校验失败返回非HTTP 403状态码给网关，网关不会执行后续步骤，直接将鉴权服务器的403响应原样返回给客户端。</p>
<h5 id="11142_3">1.1.1.4.2<strong>路由配置</strong><a class="headerlink" href="#11142_3" title="Permanent link">¶</a></h5>
<p>网关采用 traefik，路由、路由入口点、service 提供者配置使用静态配置，通过文件配置好，其中service配置为从http 接口中获取，这个http接口由系统管理及组件监控提供。service 对应的应用地址，由各个模块在自己的配置文件中配置好并在启动的时候自动将信息注册到 zookeeper 中，系统管理和组件监控服务在启动时除了将自身注册到zookeeper中，还会配置一个提供traefik service信息的api，这个api在收到请求时会从zookeeper中近乎实时的（本地缓存1-2秒）读取服务注册的信息然后组装成traefik 网关需要的service信息，traefik将会5s定时从这个api中取出service的配置，从而做到服务发现实现动态路由；当服务离线后，zookeeper中的service信息将会被自动删除，traefik从http 接口中获取到的service信息将会减少，从而感知到服务离线；当系统管理或者组件监控其中一个服务离线，对traefik 无影响，当两个都离线时，traefik无法获取新的service信息，traefik已有的老的service信息不会改变，直到系统管理和组件监控服务其中之一或全部重新上线。如下图所示：</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps90.png"><img alt="" src="file:////private/var/folders/rl/gchkw9l93p149mmyj8t07w280000gn/T/com.kingsoft.wpsoffice.mac.global/wps-xiaoluo/ksohtml//wps90.png"/></a></p>
<h4 id="1115_3">1.1.1.5 <strong>日志</strong><strong>服务</strong><a class="headerlink" href="#1115_3" title="Permanent link">¶</a></h4>
<h5 id="11151_3">1.1.1.5.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11151_3" title="Permanent link">¶</a></h5>
<p>系统日志服务为后台服务，提供所有子系统和服务的日志记录功能。所有子系统和服务把日志通过消息中心给系统日志服务，由系统日志服务完成日志持久化及日志外发动作。系统登录日志和系统操作日志清理在定时任务组件中处理。</p>
<h5 id="11152_3">1.1.1.5.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11152_3" title="Permanent link">¶</a></h5>
<h6 id="111521_3">1.1.1.5.2.1<strong>日志外发</strong><a class="headerlink" href="#111521_3" title="Permanent link">¶</a></h6>
<p>外发日志格式为json，当从kafka订阅收到日志的时候，根据日志外发配置决定是否外发、通过何种协议外发，确定外发及外发协议后将日志提交到外发日志队列中，交由日志外发线程池异步发送，不影响后续从kafka收日志。发送的json包含 content（日志内容，从kafka收到的日志内容）、type（日志类型，系统登录日志、系统操作日志、系统运行日志、能力组件日志）、module（日志所属模块，用户管理、系统管理、资源管理）字段。</p>
<h6 id="111522_3">1.1.1.5.2.2<strong>系统登录日志</strong><a class="headerlink" href="#111522_3" title="Permanent link">¶</a></h6>
<p>订阅kafka系统登录日志相关 topic，收到日志后记录到数据库系统登录日志表中。</p>
<h6 id="111523_2">1.1.1.5.2.3<strong>系统操作日志</strong><a class="headerlink" href="#111523_2" title="Permanent link">¶</a></h6>
<p>订阅kafka系统操作日志相关 topic，收到日志后记录到数据库系统操作日志表中。</p>
<h6 id="111524_1">1.1.1.5.2.4<strong>系统运行日志</strong><a class="headerlink" href="#111524_1" title="Permanent link">¶</a></h6>
<p>订阅kafka系统运行日志相关 topic，收到日志后通过log4j记录到文件中，日志保留最近七天。</p>
<h4 id="1116_3">1.1.1.6 <strong>定时</strong><strong>任务服务</strong><a class="headerlink" href="#1116_3" title="Permanent link">¶</a></h4>
<h5 id="11161_3">1.1.1.6.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11161_3" title="Permanent link">¶</a></h5>
<p>完成用户核查等固定频率任务</p>
<h5 id="11162_3">1.1.1.6.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11162_3" title="Permanent link">¶</a></h5>
<ol>
<li>用户核查任务</li>
</ol>
<p>调用用户管理API对用户进行僵尸，孤儿相关核查任务</p>
<ol start="2">
<li>能力组件状态采集</li>
</ol>
<p>能力组件包括2018堡垒机，ASCG</p>
<p>1.调用系统管理服务能力组件API获取能力组件的配置信息，然后调用能力组件状态采集接口完成状态数据采集,最后调用系统管理服务接口上报能力组件状态数据</p>
<p>2. 调用系统管理能力服务组件API获取能力组件的配置信息，然后调用版本查询接口完成查询能力组件版本信息,最后调用系统管理服务接口上报能力组件版本信息</p>
<ol start="3">
<li>调用系统服务参数配置接口获取服务磁盘阈值配置信息，检测系统是否需要清理系统操作日志、系统登录日志，当磁盘使用达到90%的时候，一次删除一天的系统登录日志和系统操作日志，直到磁盘使用低于90%</li>
</ol>
<h4 id="1117_3">1.1.1.7 <strong>数据</strong><strong>同步服务</strong><a class="headerlink" href="#1117_3" title="Permanent link">¶</a></h4>
<h5 id="11171_3">1.1.1.7.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11171_3" title="Permanent link">¶</a></h5>
<p>日志服务监听kafka用户服务,资源服务数据变更事件后补齐数据调用系统服务API查询对应的能力组件配置,调用各能力组件接口完成用户数据,资源数据同步</p>
<h5 id="11172_3">1.1.1.7.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11172_3" title="Permanent link">¶</a></h5>
<p>1.堡垒机数据同步</p>
<p>2.ASCG数据同步</p>
<h6 id="111721_2">1.1.1.7.2.1<strong>能力组件新增事件数据同步</strong><a class="headerlink" href="#111721_2" title="Permanent link">¶</a></h6>
<p>1、 调用堡垒机或ASCG接口通知它们已经在基础平台上进行了注册。</p>
<p>2、 调用用户管理服务组织机构查询查询接口获取所有组织机构信息，然后将组织信息封装，调用堡垒机、ASCG组织机构新增接口同步组织机构数据到能力组件。</p>
<p>3、 调用用户管理服务用户查询接口获取所有用户信息，然后将用户信息封装，调用堡垒机、ASCG用户新增接口同步用户数据到能力组件。</p>
<h6 id="111722_2">1.1.1.7.2.2<strong>组织机构增删改事件数据同步</strong><a class="headerlink" href="#111722_2" title="Permanent link">¶</a></h6>
<p>1、 新增组织机构事件：从事件中拿到新增的组织机构信息，封装数据，然后调用堡垒机、ASCG新增组织机构接口同步组织机构数据。</p>
<p>2、 修改组织机构事件：从事件中拿到修改的组织机构信息，封装数据，然后调用堡垒机、ASCG修改组织机构接口同步组织机构数据。</p>
<p>3、 删除组织机构事件：从事件中拿到删除的组织机构信息，封装数据，然后调用堡垒机、ASCG删除组织机构接口同步组织机构数据。</p>
<h6 id="111723">1.1.1.7.2.3<strong>用户增删改事件数据同步</strong><a class="headerlink" href="#111723" title="Permanent link">¶</a></h6>
<p>1、 新增用户事件：从事件中拿到新增的用户信息，封装数据，然后调用堡垒机、ASCG新增用户接口同步用户数据。</p>
<p>2、 修改用户事件：从事件中拿到修改的用户信息，封装数据，然后调用堡垒机、ASCG修改用户接口同步用户数据。</p>
<p>3、 删除用户事件：从事件中拿到删除的用户信息，封装数据，然后调用堡垒机、ASCG删除用户接口同步用户数据。</p>
<h6 id="111724">1.1.1.7.2.4<strong>资源组增删改事件数据同步</strong><a class="headerlink" href="#111724" title="Permanent link">¶</a></h6>
<p>1、 新增资源组事件：从事件中拿到新增的资源组信息，封装数据，然后调用堡垒机新增资源组接口同步资源组数据。</p>
<p>2、 修改资源组事件：从事件中拿到修改的资源组信息，封装数据，然后调用堡垒机修改资源组接口同步资源组数据。</p>
<p>3、 删除资源组事件：从事件中拿到删除的资源组信息，封装数据，然后调用堡垒机删除资源组接口同步资源组数据。</p>
<h6 id="111725">1.1.1.7.2.5<strong>系统资源增删改事件数据同步</strong><a class="headerlink" href="#111725" title="Permanent link">¶</a></h6>
<p>1、 新增系统资源事件：从事件中拿到新增的资源信息，封装数据，然后调用堡垒机新增资源接口同步资源数据；从事件中拿到资源绑定的协议信息，然后调用堡垒机服务新增接口。</p>
<p>2、 修改系统资源事件：从事件中拿到修改的资源信息，封装数据，然后调用堡垒机修改资源接口同步资源数据；从事件中拿到资源绑定的协议信息，与原来资源下绑定的协议信息进行比对，如果有新增的协议，那么调用堡垒机协议新增接口，如果是修改的协议，那么调用堡垒机协议修改接口，如果是删除的协议，那么调用堡垒机协议删除接口。</p>
<p>3、 删除系统资源事件：从事件中拿到删除的资源信息，封装数据，然后调用堡垒机删除资源接口同步资源数据。</p>
<h6 id="111726">1.1.1.7.2.6<strong>应用资源增删改事件数据同步</strong><a class="headerlink" href="#111726" title="Permanent link">¶</a></h6>
<p>1、 新增应用资源事件：从事件中拿到新增的资源信息，封装数据，然后调用ASCG新增资源接口同步资源数据。</p>
<p>2、 修改应用资源事件：从事件中拿到修改的资源信息，封装数据，然后调用ASCG修改资源接口同步资源数据。</p>
<p>3、 删除应用资源事件：从事件中拿到删除的资源信息，封装数据，然后调用ASCG删除资源接口同步资源数据。</p>
<h6 id="111727">1.1.1.7.2.7<strong>资源帐号增删改事件数据同步</strong><a class="headerlink" href="#111727" title="Permanent link">¶</a></h6>
<p>1、 新增帐号事件：从事件中拿到新增的帐号信息，封装数据，然后调用堡垒机、ASCG新增帐号接口同步帐号数据。</p>
<p>2、 修改帐号事件：从事件中拿到修改的帐号信息，封装数据，然后调用堡垒机、ASCG修改帐号接口同步帐号数据。</p>
<p>3、 删除帐号事件：从事件中拿到删除的帐号信息，封装数据，然后调用堡垒机、ASCG删除帐号接口同步帐号数据。</p>
<h6 id="111728">1.1.1.7.2.8<strong>资源组关联能力组件数据同步</strong><a class="headerlink" href="#111728" title="Permanent link">¶</a></h6>
<p>1、 调用资源管理服务获取关联的资源组信息，然后封装数据，调用堡垒机资源组新增接口同步资源组信息到堡垒机。（ASCG不需要同步资源组数据）</p>
<p>2、 调用资源管理服务获取资源组下的所有资源，然后封装数据，调用堡垒机或ASCG资源新增接口同步资源信息到堡垒机或ASCG。如果是系统资源，那么从获取到的资源信息中拿到协议信息，调用堡垒机协议新增接口同步协议信息到堡垒机。</p>
<p>3、 调用资源管理服务获取资源组下资源的所有帐号信息，然后封装数据，调用堡垒机或ASCG帐号新增接口同步帐号信息到堡垒机或ASCG。</p>
<h6 id="111729">1.1.1.7.2.9<strong>资源组取消关联能力组件数据同步</strong><a class="headerlink" href="#111729" title="Permanent link">¶</a></h6>
<p>1、 调用资源管理服务获取资源组下资源的所有帐号信息，然后封装数据，调用堡垒机或ASCG帐号删除接口同步帐号信息到堡垒机或ASCG。</p>
<p>2、 调用资源管理服务获取资源组下的所有资源，然后封装数据，调用堡垒机或ASCG资源删除接口同步资源信息到堡垒机或ASCG。</p>
<p>3、 调用资源管理服务获取取消关联的资源组信息，然后封装数据，调用堡垒机资源组删除接口同步资源组信息到堡垒机。</p>
<h6 id="1117210">1.1.1.7.2.10<strong>能力组件删除事件数据同步</strong><a class="headerlink" href="#1117210" title="Permanent link">¶</a></h6>
<p>1、 调用堡垒机或ASCG接口通知它们已经在基础平台上取消了注册。</p>
<p>2、 至于能力组件需不需要删除由基础平台同步的数据由能力组件自行决定。</p>
<h4 id="1118root">1.1.1.8 <strong>系统</strong><strong>配置服务</strong><strong>(ROOT)</strong><a class="headerlink" href="#1118root" title="Permanent link">¶</a></h4>
<h5 id="11181_2">1.1.1.8.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11181_2" title="Permanent link">¶</a></h5>
<p>该服务运行在宿主机上,提供网络,时间和主机上运行的组件状态,主机CPU 内存 磁盘使用率上报,以及监听kafka事件实现系统网络配置,时间配置,电源配置功能</p>
<h5 id="11182_2">1.1.1.8.2<strong>功能设计</strong><a class="headerlink" href="#11182_2" title="Permanent link">¶</a></h5>
<h6 id="111821_2">1.1.1.8.2.1 <strong>网络时间</strong><strong>配置</strong><a class="headerlink" href="#111821_2" title="Permanent link">¶</a></h6>
<p>1.服务启动时,通过系统调用获取当前主机的网络配置信息和时间配置信息,调用系统管理网络配置接口上报当前机器网络配置信息,网络配置包括IP,NETMASK,GATEWAY,DNS以及接口速率,时间配置信息包含当前系统所在时区和当前系统支持的时区,NTP启用/禁用状态,NTP服务器地址,系统服务通过读取数据库网络获取时间配置和网络的配置信息</p>
<p>2.系统服务在启动后每30s上报一次网络配置,时间配置,以及系统状态数据(CPU负载,磁盘信息,内存),以及系统运行组件状态信息</p>
<h6 id="111822_2">1.1.1.8.2.2<strong>事件</strong><strong>处理</strong><a class="headerlink" href="#111822_2" title="Permanent link">¶</a></h6>
<p>1.网络配置事件</p>
<p>系统配置服务监控kafka消息队列里的 网络配置事件,当收到网络配置事件</p>
<p>l 根据消息参数中的主机标识判断是否与本机匹配,如果匹配调用系统API修改主机的网络配置</p>
<p>l 发送网络配置完成事件</p>
<p>2.时间配置事件</p>
<p>系统配置服务监控kafka消息队列里的 时间配置事件,当收到事件配置事件</p>
<p>根据消息参数中的主机标识判断是否与本机匹配,如果匹配后调用系统API修改主机的时间配置</p>
<p>3.电源配置事件</p>
<p>系统配置服务监控kafka消息队列里的 电源配置事件,当收到事件配置事件</p>
<p>根据消息参数中的主机标识判断是否与本机匹配,如果匹配后调用系统API重启或关闭主机</p>
<p>4.网络变更完成事件</p>
<p>更新hosts文件中对应的 域名和ip的映射关系</p>
<p>5.服务启动事件</p>
<p>系统配置服务监控kafka消息队列里的 服务启停事件,当收到事件配置事件读取对应的事件参数调用supervisor API 完成服务启停后调用系统组件接口上报对应的组件状态信息</p>
<h4 id="1119root">1.1.1.9 <strong>配置</strong><strong>备份服务</strong><strong>(ROOT)</strong><a class="headerlink" href="#1119root" title="Permanent link">¶</a></h4>
<h5 id="11191_1">1.1.1.9.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#11191_1" title="Permanent link">¶</a></h5>
<p>该服务运行在宿主机上,完成定时备份数据库,以及监听kafka的手工配置备份事件和恢复配置备份事件</p>
<h5 id="11192_1">1.1.1.9.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#11192_1" title="Permanent link">¶</a></h5>
<h6 id="111921">1.1.1.9.2.1<strong>定时</strong><strong>备份</strong><a class="headerlink" href="#111921" title="Permanent link">¶</a></h6>
<p>1.服务启动是已固定频率2小时,读取配置文件中的表集合通过pg_dump命令来完成配置备份</p>
<p>2. 具体备份表：除了系统操作日志表、登录日志表、系统在线用户表 都需要备份</p>
<h6 id="111922">1.1.1.9.2.2<strong>事件处理</strong><a class="headerlink" href="#111922" title="Permanent link">¶</a></h6>
<p>1. 手动备份事件</p>
<p>监控kafka消息队列里的 手动备份事件,当收到事件配置事件读取配置文件中的表集合通过pg_dump命令来完成配置备份,文件备份路径/data/database/backup/ </p>
<p>备份完成后发送配置完成事件后调用系统管理服务接口上报配置备份信息(备份时间,备份文件大小,备份文件路径)</p>
<p>2. 恢复备份事件</p>
<p>监控kafka消息队列里的 恢复备份事件,当收到恢复备份事件调用pg_dump命令完成恢复备份配置</p>
<p>恢复备份配置完成后发送恢复备份配置完成事件 </p>
<h4 id="11110root">1.1.1.10 <strong>升级</strong><strong>服务</strong><strong>(ROOT)</strong><a class="headerlink" href="#11110root" title="Permanent link">¶</a></h4>
<h5 id="111101">1.1.1.10.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#111101" title="Permanent link">¶</a></h5>
<p>该服务运行在宿主机上,监听kafka的升级事件完成系统升级功能</p>
<h5 id="111102">1.1.1.10.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#111102" title="Permanent link">¶</a></h5>
<p>监控kafka消息队列里的升级事件,解析事件参数,通过http接口下载相关升级包,解压执行升级包中的install.sh脚本完成升级。备份、覆盖文件和重启服务功能在脚本内实现,升级服务只解压升级包和调用install.sh脚本</p>
<h4 id="11111root">1.1.1.11 <strong>主备</strong><strong>服务</strong><strong>(ROOT)</strong><a class="headerlink" href="#11111root" title="Permanent link">¶</a></h4>
<p>该服务运行在宿主机上,查看主备章节描述</p>
<h5 id="111111">1.1.1.11.1<strong>功能</strong><strong>描述</strong><a class="headerlink" href="#111111" title="Permanent link">¶</a></h5>
<h5 id="111112">1.1.1.11.2<strong>功能</strong><strong>设计</strong><a class="headerlink" href="#111112" title="Permanent link">¶</a></h5>
<!-- Source file information -->
<!-- taken from 
https://github.com/squidfunk/mkdocs-material/blob/master/src/partials/source-file.html -->
<hr/>
<div class="md-source-file">
<small>
<!-- mkdocs-git-revision-date-localized-plugin -->
<u>最后更新</u> :
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年9月20日</span>
<!-- mkdocs-git-revision-date-plugin -->
<br/>
<u>创建日期</u> :
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年9月20日</span>
<br/>
<u>Auteur</u> : 罗潇
        
        
    </small>
</div>
<!-- Was this page helpful? -->
<!-- Comment system -->
<!-- Giscus -->
<!-- Giscus -->
<script> 
    try {
      const index = document.querySelector('h1').innerHTML;
      if (index === "Index") {
        document.querySelector('h1').innerHTML = "基础平台1.0";
      }
    } catch (error) {
      // console.log(error);
    }
  </script>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            回到页面顶部
          </button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2022 - 2023 启明星辰-天榕
    </div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.path", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>