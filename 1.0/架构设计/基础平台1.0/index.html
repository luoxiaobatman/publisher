
<!DOCTYPE html>

<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="基础平台" name="description"/>
<meta content="罗潇" name="author"/>
<link href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/" rel="next"/>
<link href="../../assets/meta/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.3.1" name="generator"/>
<title>基础平台1.0 - 基础平台</title>
<link href="../../assets/stylesheets/main.046329b4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.85d0ee34.min.css" rel="stylesheet"/>
<style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6v2Z"/></svg>');}</style>
<link href="../../assets/css/custom_attributes.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
<link href="https://unpkg.com/tippy.js@6/animations/scale-subtle.css" rel="stylesheet"/>
<link href="https://unpkg.com/tippy.js@6/themes/translucent.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" referrerpolicy="no-referrer" rel="stylesheet"/>
<meta content="None" name="site_url"/>
<meta content="基础平台1.0" property="og:title"/>
<meta content="基础平台1.0" name="twitter:title"/>
<meta content="基础平台" name="og:description"/>
<meta content="基础平台" name="twitter:description"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="Noneassets/meta/SEO.png" property="og:image"/>
<meta content="Noneassets/meta/SEO.png" name="twitter:image"/>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="light-blue" data-md-color-primary="teal" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="基础平台" class="md-header__button md-logo" data-md-component="logo" href="../.." title="基础平台">
<img alt="logo" src="../../assets/meta/favicons.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            基础平台
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              基础平台1.0
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="teal" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<a aria-label="分享" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="分享">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
          
  
    
  
  架构设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/">
          
  
    
  
  概要设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/%E5%B8%90%E5%8F%B7%E6%A0%B8%E6%9F%A5%E6%94%B9%E7%9B%B8%E5%85%B3/">
          
  
    
  
  详细设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">
          
  
    
  
  数据库设计

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E5%9F%BA%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
          
  
    
  
  接口设计

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="基础平台" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="基础平台">
<img alt="logo" src="../../assets/meta/favicons.png"/>
</a>
    基础平台
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    架构设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            架构设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    基础平台1.0
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    简介
  </a>
<nav aria-label="简介" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    目的
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    范围
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    产品介绍
  </a>
<nav aria-label="产品介绍" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    产品功能说明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    产品构成
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    系统架构设计
  </a>
<nav aria-label="系统架构设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    功能架构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    逻辑架构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    子系统介绍
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    业务流程
  </a>
<nav aria-label="业务流程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    认证鉴权机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    升级流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    能力组件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#354">
    3.5.4. 帐号改密
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    主备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    系统组件管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
    能力组件管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
    短信邮件通知
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
    服务发现和注册
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
    静态架构
  </a>
<nav aria-label="静态架构" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
    前端代码结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
    后端代码结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
    自动化构建和打包
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    安装包结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
    文件系统规划
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
    部署形态
  </a>
<nav aria-label="部署形态" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
    单机部署
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
    分布式部署
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
    微服务云化部署
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
    版本升级
  </a>
<nav aria-label="版本升级" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
    版本规划
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
    软件升级机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#db">
    DB升级机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
    跨版本升级
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
    产品集成
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    概要设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            概要设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0总体设计
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
<span class="md-ellipsis">
    功能设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_2">
<span class="md-nav__icon md-icon"></span>
            功能设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0用户管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0系统管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E4%BA%A7%E7%AE%A1%E7%90%86/">
<span class="md-ellipsis">
    基础平台1.0资产管理
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E5%90%8E%E5%8F%B0%E6%9C%8D%E5%8A%A1/">
<span class="md-ellipsis">
    基础平台1.0系统后台服务
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    详细设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            详细设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/%E5%B8%90%E5%8F%B7%E6%A0%B8%E6%9F%A5%E6%94%B9%E7%9B%B8%E5%85%B3/">
<span class="md-ellipsis">
    帐号核查改相关
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    数据库设计
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            数据库设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    接口设计
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            接口设计
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    基础平台1.0
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            基础平台1.0
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E5%9F%BA%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
<span class="md-ellipsis">
    基础平台1.0基事件源设计文档
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83/">
<span class="md-ellipsis">
    基础平台1.0接口设计规范
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%94%A8%E6%88%B7api%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0用户api设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9Fapi%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0系统api设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/">
<span class="md-ellipsis">
    基础平台1.0系统管理事件源设计文档
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E6%BA%90%E4%B8%AD%E5%BF%83API%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0资源中心API接口设计
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/%E5%9F%BA%E7%A1%80%E5%B9%B3%E5%8F%B01.0%E8%B5%84%E6%BA%90%E4%B8%AD%E5%BF%83%E4%BA%8B%E4%BB%B6%E6%BA%90%E8%AE%BE%E8%AE%A1/">
<span class="md-ellipsis">
    基础平台1.0资源中心事件源设计
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    简介
  </a>
<nav aria-label="简介" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    目的
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    范围
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    产品介绍
  </a>
<nav aria-label="产品介绍" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    产品功能说明
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    产品构成
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    系统架构设计
  </a>
<nav aria-label="系统架构设计" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    功能架构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    逻辑架构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    子系统介绍
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    业务流程
  </a>
<nav aria-label="业务流程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    认证鉴权机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    升级流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    能力组件数据同步
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#354">
    3.5.4. 帐号改密
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    主备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    系统组件管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
    能力组件管理
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
    短信邮件通知
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
    服务发现和注册
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
    静态架构
  </a>
<nav aria-label="静态架构" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
    前端代码结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
    后端代码结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
    自动化构建和打包
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    安装包结构
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
    文件系统规划
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
    部署形态
  </a>
<nav aria-label="部署形态" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
    单机部署
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
    分布式部署
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
    微服务云化部署
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
    版本升级
  </a>
<nav aria-label="版本升级" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
    版本规划
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
    软件升级机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#db">
    DB升级机制
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
    跨版本升级
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
    产品集成
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->
<!-- Tags -->
<!-- Actions -->
<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->
<h1>基础平台1.0</h1>
<!-- Page content -->
<h3 id="_1">简介<a class="headerlink" href="#_1" title="Permanent link">¶</a></h3>
<h4 id="_2">目的<a class="headerlink" href="#_2" title="Permanent link">¶</a></h4>
<p>该文档为基础平台系统架构设计文档，从功能架构、逻辑架构、子系统、业务流程等层面对平台架构进行说明，描述产品功能、产品构成、子系统功能、子系统间的数据交互等，为产品概要设计、开发、测试提供支撑。</p>
<h4 id="_3">范围<a class="headerlink" href="#_3" title="Permanent link">¶</a></h4>
<p>该文档只包含基础平台的系统架构设计，基础平台的API设计、事件设计和特性设计由单独的文档描述，不包含在该文档中。</p>
<p>该文档适用于SE、产品经理、研发经理、开发人员和测试人员。</p>
<p>SE：该文档由SE进行维护，并参考该文档进行其他API、特性等设计，需要修改该文档时需要由SE发起修改评审，评审通过后进行文档修改。</p>
<p>产品经理：确认架构设计是否符合产品需求说明、是否涵盖了产品需求范围。</p>
<p>研发经理：通过该文档指导研发技术方向、验收研发成果。</p>
<p>开发人员：参考该文档进行详细设计并作为后期开发的依据。</p>
<p>测试人员：参考该文档进行测试方案和测试用例编写。</p>
<h3 id="_4">产品介绍<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<p>产品介绍包括产品功能说明和产品构成。</p>
<h4 id="_5">产品功能说明<a class="headerlink" href="#_5" title="Permanent link">¶</a></h4>
<p>基础平台实现统一用户管理、统一资源和帐号管理、实现统一认证、和系统管理功能。基础平台实现用户、资源等统一配置，并把配置下发给能力组件，借助各种能力组件实现相应的管控效果。</p>
<p>基础平台提供的是产品无关的、通用功能开发，核心关注用户、资源、认证和系统管理，对外输出基础平台，其他产品只需开发个性化业务，对于用户、资源、认证和系统管理可以直接复用基础平台。</p>
<h4 id="_6">产品构成<a class="headerlink" href="#_6" title="Permanent link">¶</a></h4>
<p>基础平台实现用户、认证、资源和帐号等配置数据的集中管理，通过数据同步组件把相应的配置数据同步给堡垒机、ASCG、DataServer和UIAM等能力组件，借助能力组件实现运维通道、业务通道和文件通道等管控，如下图：</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/%E4%BA%A7%E5%93%81%E6%9E%84%E6%88%90.excalidraw.svg"><img alt="产品构成.excalidraw" src="../../assets/img/%E4%BA%A7%E5%93%81%E6%9E%84%E6%88%90.excalidraw.svg" title="产品构成.excalidraw"/></a></p>
<p>以下介绍的基础平台架构设计只包含平台本身，不包括堡垒机、ASCG、DataServer、UIAM等能力组件。</p>
<h3 id="_7">系统架构设计<a class="headerlink" href="#_7" title="Permanent link">¶</a></h3>
<p>系统架构设计从产品的功能架构、逻辑架构、功能架构、子系统划分、子系统核心功能说明、子系统之间的数据交互、业务流程、静态架构、产品集成、产品部署等方面进行描述。</p>
<h4 id="_8">功能架构<a class="headerlink" href="#_8" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230919094214.png"><img alt="media/Pasted image 20230919094214.png" src="../../assets/img/Pasted%20image%2020230919094214.png" title="media/Pasted image 20230919094214.png"/></a></p>
<p>基础平台包括前端、网关、业务层、中间件和后台服务。</p>
<p>前端提供平台界面，实现系统登录、用户管理、资源管理、系统管理等功能。</p>
<p>网关为所有请求提供路由功能。</p>
<p>业务层包括认证中心、用户管理、资源管理和系统管理，和后台服务及数据层交互，为前端提供数据支撑。</p>
<p>中间件包括消息中心和缓存中心，实现业务层和后台服务的事件和数据交互。</p>
<p>后台服务包括系统配置、系统日志、数据同步、帐号采集、帐号改密等后台业务功能，并通过守护进程监控基础平台所有服务的运行状态。</p>
<p>同时包括各种功能依赖包, 为加速开发, 增加安全提供便利.</p>
<p>也包括字节码打桩工具, 提供不改变源码的情况下灵活增加/改变功能的可能性.</p>
<h4 id="_9">逻辑架构<a class="headerlink" href="#_9" title="Permanent link">¶</a></h4>
<p>整体逻辑架构分为视图、业务逻辑和数据层。</p>
<p>视图层提供前端展示，支持浏览器、api、PC端、移动端等多种访问手段，保证安全性都通过https进行访问。</p>
<p>业务逻辑层实现认证、用户、资源、系统的业务逻辑处理和业务控制，除四大业务中心外，还包括API网关、消息中心、缓存中心、后台服务及进程守护程序。</p>
<p>数据层实现数据存取，认证中心、用户管理、资源管理和系统管理数据库相互独立，可以单独部署，也可以在同一个库上运行四个数据库实例。</p>
<h4 id="_10">子系统介绍<a class="headerlink" href="#_10" title="Permanent link">¶</a></h4>
<p>基础平台包括：认证中心、用户管理、资源管理、系统管理、API网关、消息中心、缓存中心、系统配置、系统日志、短信服务、邮件服务、数据同步、定时任务、帐号采集、帐号改密、升级服务、主备服务和进程守护服务。</p>
<p>认证中心提供统一登录界面，实现多种认证因子的身份认证、票据管理、认证转发，实现基于CAS、OAuth、SAML等多种标准协议的应用接入认证和单点登录功能。</p>
<p>认证中心同时提供票据服务，为API网关的请求提供票据生成和校验功能。</p>
<ul>
<li>用户管理</li>
</ul>
<p>用户管理包括用户属性管理、用户组织/用户组管理、用户口令策略管理、用户登录策略管理和OTP认证因子管理。</p>
<ul>
<li>资源管理</li>
</ul>
<p>实现资源管理、资源组管理、帐号管理、口令策略以及基于资源的敏感数据发现、帐号核查、一致性稽核、帐号改密等功能。</p>
<ul>
<li>系统管理</li>
</ul>
<p>系统管理主要实现系统角色管理、系统配置管理、系统信息管理、堡垒机管理、接口管理和热备管理。</p>
<ul>
<li>API网关</li>
</ul>
<p>API网关为所有内外部请求的入口。基于安全考虑，所有外部请求通过https协议请求API网关，由API网关转发请求给具体子系统，为提高效率，内部子系统之间的请求通过http协议请求API网关，由API网关转发请求给相应的子系统。</p>
<p>请求到API网关后，API网关和认证中心联动完成当前请求的鉴权，鉴权通过后进行后续的业务操作。为避免API网关出现瓶颈，不承载业务处理，具体业务由各子系统和后台服务完成。</p>
<p>API网关采用traefik实现，traefik设计上考虑了更多的安全性，支持docker状态监控。</p>
<ul>
<li>消息中心</li>
</ul>
<p>消息中心实现子系统和后台服务之间的数据交互。</p>
<p>子系统向后台服务同步消息时，在不增加业务复杂度的前提下尽可能把后台服务所需的信息都同步过去，减少后台服务再次查询数据。</p>
<p>后台服务需要查询数据时，优先通过API网关查询子系统的API查询数据，如果需要查询的数据过于复杂，可以考虑由后台服务直接访问数据库。</p>
<p>消息中间件采用kafka。</p>
<ul>
<li>缓存中心</li>
</ul>
<p>缓存中心把频繁使用的配置信息缓存起来，提高访问性能、减少DB操作，比如堡垒机地址每次调用接口执行运维操作时都用到，可以写入缓存中心。</p>
<p>缓存中心采用Redis。</p>
<ul>
<li>系统配置服务</li>
</ul>
<p>系统配置服务为后台服务，以root运行，承载对操作系统的配置，包括网络配置、电源配置、时间配置、服务启停和各服务地址维护。系统管理子系统提供业务操作，驱动系统配置服务完成具体的配置动作。</p>
<ul>
<li>系统日志服务</li>
</ul>
<p>系统日志服务为后台服务，提供所有子系统和服务的日志记录功能。所有子系统和服务把日志通过消息中心给系统日志服务，由系统日志服务完成日志持久化及日志外发动作。</p>
<ul>
<li>短信服务</li>
</ul>
<p>承载系统所有短信的发送功能，短信服务从消息中心订阅需要发送短信的事件，完成短信网关连接管理和具体的发送。</p>
<ul>
<li>邮件服务</li>
</ul>
<p>承载系统所有邮件的发送功能，邮件服务从消息中心订阅需要发送邮件的事件，完成邮件服务器连接管理和具体的发送。</p>
<ul>
<li>数据同步</li>
</ul>
<p>数据同步实现平台和堡垒机、ASCG、DataServer等能力组件之间的数据同步，由平台适配能力组件的接口把数据推送给各能力组件。</p>
<ul>
<li>定时任务</li>
</ul>
<p>提供系统运行日志清理、配置备份、堡垒机状态周期查询等定时和周期执行的任务。</p>
<ul>
<li>帐号采集服务</li>
</ul>
<p>帐号采集服务为后台服务，实现从目标资源采集帐号到平台。</p>
<ul>
<li>帐号改密服务</li>
</ul>
<p>帐号改密服务为后台服务，实现修改目标资源上帐号的密码的功能。</p>
<ul>
<li>升级服务</li>
</ul>
<p>升级服务为后台服务，以root运行，实现升级包下载、服务升级和升级结果上报功能。</p>
<ul>
<li>主备服务</li>
</ul>
<p>主备服务为后台服务，完成主备机器之间的状态监控、主备机之间的数据同步和事件处理功能。</p>
<ul>
<li>进程守护服务</li>
</ul>
<p>进程守护服务提供对所有前端服务、后端服务、中间件和后台服务的进程进行监控和启停，当监控到服务异常时进行服务重启，最多尝试重启三次，最大程度保证业务连续性。</p>
<p>进程守护服务采用supervisor。</p>
<ul>
<li>通知服务</li>
</ul>
<p>通知服务用于订阅前台服务发送的提醒、告警、验证码等事件，完成事件和提醒、告警、验证码模板的整合，形成以明确的通知方式的通知内容，以事件的方式把内容发送到消息中心，由短信服务、邮件服务等服务订阅并完成提醒、告警和验证码的发送。</p>
<h3 id="_11">业务流程<a class="headerlink" href="#_11" title="Permanent link">¶</a></h3>
<p>基础平台运行过程中涉及多种业务流程，以下从Web请求、系统升级、数据同步、帐号改密等主要场景对基础平台的业务流程进行描述。</p>
<h4 id="_12">认证鉴权机制<a class="headerlink" href="#_12" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920134535.png"><img alt="media/Pasted image 20230920134535.png" src="../../assets/img/Pasted%20image%2020230920134535.png" title="media/Pasted image 20230920134535.png"/></a></p>
<p>针对浏览器、外部API和后台服务发起的业务请求，API网关把业务请求统一转发给认证中心的票据服务进行票据验证，只有携带合法票据的请求会被转发给相应的服务，由相应的服务提供响应。一次完整的业务请求流程如下：</p>
<p>1） API网关接收业务请求，把业务请求转发给认证中心的票据服务；</p>
<p>2） 票据服务进行判断有效性校验，分以下三种情况</p>
<ul>
<li>浏览器访问的场景，跳转认证中心登录界面完成用户和密码输入并提交认证请求到认证中心身份认证服务进行身份认证，继续步骤3和4；</li>
<li>外部API访问的场景，转发请求到认证中心身份认证服务进行身份认证，继续步骤3和4；</li>
<li>后台服务访问的场景，转发请求到认证中心身份认证服务进行身份认证，继续步骤3和4；</li>
</ul>
<p>3） 身份认证成功，返回认证结果；</p>
<p>4） 票据服务根据认证结果生成合法票据，并把携带票据和校验结果的请求返回给调用者；</p>
<p>5） 浏览器、外部API和后台服务携带合法票据请求API网关，API网关转发转发请求到认证中心的票据服务；</p>
<p>6） 票据服务校验票据合法，把携带票据和校验结果的请求返回给API网关（通过状态判断，不再请求认证中心）</p>
<p>7） API网关根据票据校验结果把请求路由到用户管理服务完成业务操作；</p>
<p>8） 用户管理需要请求资源管理的API，携带票据发送请求到API网关；</p>
<p>9） API网关转发携带票据的请求给票据服务；</p>
<p>10） 票据服务校验票据合法，返回校验结果给API网关（通过状态判断，不再请求认证中心）；</p>
<p>11） API网关把请求路由到资源管理服务完成业务操作。</p>
<p>通过浏览器登录平台时通过界面输入用户和密码换取票据后执行后续业务请求；外部API和后台服务需要携带用户身份请求API网关换取票据后执行后续业务请求，不同的请求对API网关透明，身份认证、票据生成、鉴权机制相同。</p>
<p>平台为浏览器、外部API和后台服务的访问分配不同的用户，用于区分不同来源的业务请求，给外部API和后台服务分配的用户控制禁止通过浏览器登录。</p>
<h4 id="_13">升级流程<a class="headerlink" href="#_13" title="Permanent link">¶</a></h4>
<p>系统升级考虑单机部署和分布式部署情况下的升级，以下以分布式情况下的升级为准进行描述，单机部署升级流程相同。</p>
<p>系统升级涉及系统升级前端、后端、消息中心和后台升级服务。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920134916.png"><img alt="media/Pasted image 20230920134916.png" src="../../assets/img/Pasted%20image%2020230920134916.png" title="media/Pasted image 20230920134916.png"/></a></p>
<p>1） 系统升级前端上传升级包，完成升级文件前端校验，调用系统升级后端服务，由后端服务完成升级包上传和存储；</p>
<p>2） 后端服务发送升级通知到消息中心；</p>
<p>3） 后台升级服务订阅升级通知；</p>
<p>4） 后台升级服务从缓存中心获取系统管理服务地址，调用系统升级后端的API下载升级包到本地，执行停容器、备份历史软件、根据本机安装的组件拷贝新软件覆盖安装、启容器等动作来实现相关服务升级；</p>
<p>5） 后台升级服务调用系统升级后端上报升级结果、版本号、升级详情；</p>
<p>6） 系统升级前端通过API轮询升级进度和升级结果。</p>
<p>以上流程中，前端、后台升级服务调用后端的API需要经过API网关，以上流程中未体现这些细节。</p>
<p>系统配置（网络、时间、电源）流程与系统升级类似，只是没有升级包下载动作。</p>
<h4 id="_14">能力组件数据同步<a class="headerlink" href="#_14" title="Permanent link">¶</a></h4>
<p>基础平台支持两种方式和能力组件对接实现数据同步，一种方式是拉的方式，由能力组件适配平台，能力组件主动到平台获取变更的数据，另一种方式推动的方式，由平台适配能力组件的接口，平台主动把变更的数据推送给能力组件。</p>
<ul>
<li>拉的方式</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135101.png"><img alt="media/Pasted image 20230920135101.png" src="../../assets/img/Pasted%20image%2020230920135101.png" title="media/Pasted image 20230920135101.png"/></a></p>
<p>能力组件直接到消息中心订阅数据变更事件，事件中的信息能满足能力组件需求情况下，无需执行步骤3，否则能力组件需要根据事件中的对象ID，调用数据同步服务为能力组件开发的统一API，数据同步服务调用后端服务的原子API把查询到的各类原子数据进行业务封装后通过统一API返回数据。</p>
<ul>
<li>推的方式</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135115.png"><img alt="media/Pasted image 20230920135115.png" src="../../assets/img/Pasted%20image%2020230920135115.png" title="media/Pasted image 20230920135115.png"/></a></p>
<p>由数据同步组件订阅数据变更事件，事件中的信息能满足数据同步需求情况下，数据同步服务调用后端服务的原子API，否则数据同步服务需要根据事件中的对象ID，调用后端服务的原则API把获取到的数据进行封装后，按照能力组件的API主动向能力组件推送数据。</p>
<h4 id="354">3.5.4. <strong>帐号改密</strong><a class="headerlink" href="#354" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135418.png"><img alt="media/Pasted image 20230920135418.png" src="../../assets/img/Pasted%20image%2020230920135418.png" title="media/Pasted image 20230920135418.png"/></a></p>
<p>基础平台和堡垒机对于改密都是异步调用，所以基础平台上发起改密动作后，把帐号状态置为改密中，数据库还是保存老密码，不影响帐号正常使用。</p>
<p>目标资源改密完成后堡垒机会进行密码拨测，保证改密结果，拨测完成后，堡垒机回调数据同步服务接口，通知改密结果，根据改密结果修改帐号状态、修改密码、同步帐号给堡垒机等能力组件，保持数据一致。</p>
<p>注：使用改密中的帐号登录时，如果目标资源还未完成改密，可能导致登录失败。</p>
<h4 id="_15">主备<a class="headerlink" href="#_15" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135520.png"><img alt="media/Pasted image 20230920135520.png" src="../../assets/img/Pasted%20image%2020230920135520.png" title="media/Pasted image 20230920135520.png"/></a></p>
<p>前端调用系统管理服务API发起主备配置操作，系统管理服务向消息中心发送主备配置命令，后台主备服务订阅消息执行主备动作：主备数据同步，数据同步后通过主备事件处理程序上报主备切换完成事件给消息中心，同时通过API上报给系统管理后端用于界面展示，通知服务订阅该事件，并通过短信服务或邮件服务给管理员发送通知。</p>
<ul>
<li>服务状态监控</li>
</ul>
<p>系统运行过程中，服务状态监控程序（HA）监控相关服务的状态，并根据监控的服务的状态综合判断是否需要执行主备切换。</p>
<p>服务状态监控来源于两个方面：</p>
<p>1） 从守护进程获取服务状态，获取拉取三次都不成功的服务的状态</p>
<p>2） 由服务状态监控程序执行业务拨测进行判断。针对数据库真正执行一条sql检查pg的可用性、连接是否占满；针对API网关真正执行一次http请求，检查网关是否有响应。</p>
<p>主备切换的判断依据是以下服务中任何一个启动三次失败或业务拨测失败则进行主备切换。</p>
<p>1） API网关</p>
<p>2） 认证中心</p>
<p>3） 用户管理</p>
<p>4） DB</p>
<p>5） 消息中心</p>
<p>除以上服务外，其他服务异常时不会进行准备切换，依赖系统组件监控模块进行监控并人工参与来恢复服务。</p>
<ul>
<li>主备数据同步</li>
</ul>
<p>主备配置完成或主备切换完成后，会利用切换后的主机的数据覆盖备机的数据，达到主备数据一致的效果。</p>
<p>正常运行过程中心，主机数据变更时会利用pglogical准实时地、主动推送数据到备机。</p>
<ul>
<li>主备事件处理</li>
</ul>
<p>把服务状态监控结果、主备数据同步结果及问题以事件的形式上报到消息中心、上报给系统管理，分别为短信邮件通知、日志记录、系统组件状态监控提供基础。</p>
<p>说明：主备只考虑单机部署的情况，不考虑分布式部署和云化部署。</p>
<h4 id="_16">系统组件管理<a class="headerlink" href="#_16" title="Permanent link">¶</a></h4>
<p>系统组件管理实现系统各服务状态监控、性能监控、服务启停和服务运行日志下载功能。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135809.png"><img alt="media/Pasted image 20230920135809.png" src="../../assets/img/Pasted%20image%2020230920135809.png" title="media/Pasted image 20230920135809.png"/></a></p>
<ul>
<li>服务状态监控</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135821.png"><img alt="media/Pasted image 20230920135821.png" src="../../assets/img/Pasted%20image%2020230920135821.png" title="media/Pasted image 20230920135821.png"/></a></p>
<p>服务状态监控通过守护进程supervisor实现系统所有组件的在线状态监控，提供服务是否在线的信息。服务状态监控流程如下：</p>
<p>1） 守护进程supervisor通过配置，主动监控每个服务的状态，包括自己开发的服务和引入的第三方服务比如缓存中心Redis；</p>
<p>2） 系统配置服务通过定时任务，周期性从守护进程查询服务状态；</p>
<p>3） 系统配置服务把获取到的服务状态信息发送到消息中心；</p>
<p>4） 系统管理服务从消息中心订阅服务状态信息；</p>
<p>5） 系统管理服务把订阅到的服务状态信息存入DB；</p>
<p>6） 前端通过系统管理服务API查询服务状态，实现服务状态监控，呈现系统组件状态； </p>
<ul>
<li>服务性能监控</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135835.png"><img alt="media/Pasted image 20230920135835.png" src="../../assets/img/Pasted%20image%2020230920135835.png" title="media/Pasted image 20230920135835.png"/></a></p>
<p>服务性能监控监控的是当前服务所在的服务器的性能指标，由每台服务器上部署的系统配置服务获取服务器的性能指标上报给系统管理，包括内存、CPU和磁盘使用。</p>
<ul>
<li>服务启停</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135845.png"><img alt="media/Pasted image 20230920135845.png" src="../../assets/img/Pasted%20image%2020230920135845.png" title="media/Pasted image 20230920135845.png"/></a></p>
<p>当系统服务异常时，第一道防线由守护进程负责服务的重启，如果重启三次失败则服务在前端的表现为停止，需要人工参与服务启动。</p>
<p>由系统管理发送服务重启命令给消息中心，系统配置服务通过订阅消息中心的命令实现对服务的启停。</p>
<ul>
<li>服务运行日志下载</li>
</ul>
<p>当服务异常时，可通过前端界面下载每个服务的系统运行日志进行问题排查，下载的系统运行日志需要加密，并且可指定下载指定时间范围内的日志文件。</p>
<h4 id="_17">能力组件管理<a class="headerlink" href="#_17" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920135938.png"><img alt="media/Pasted image 20230920135938.png" src="../../assets/img/Pasted%20image%2020230920135938.png" title="media/Pasted image 20230920135938.png"/></a></p>
<p>能力组件管理实现能力组件地址配置和能力组件状态监控。</p>
<p>能力组件地址配置后会把能力组件信息写入缓存中心，定时任务从缓存中心读取数据、访问能力组件的指定地址的接口获取能力组件的性能指标，并根据性能指标判断能力组件状态是否在线。</p>
<h4 id="_18">短信邮件通知<a class="headerlink" href="#_18" title="Permanent link">¶</a></h4>
<p>通知服务负责订阅各服务产生的事件，把事件转化为实际需要发送的通知，并以事件的形式经由消息中心给到短信服务、邮件服务完成事件发送。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920140031.png"><img alt="media/Pasted image 20230920140031.png" src="../../assets/img/Pasted%20image%2020230920140031.png" title="media/Pasted image 20230920140031.png"/></a></p>
<p>以用户改密事件为例，短信邮件通知流程如下</p>
<p>7） 用户管理服务完成改密后发送改密事件；</p>
<p>8） 通知服务订阅改密事件；</p>
<p>9） 通知服务调用用户管理服务的API，查询用户改密通知的模板后，根据模板组装通知内容；</p>
<p>10） 通知服务把具体的通知内容、发送地址（手机、邮箱）以事件的形式发送给消息中心；</p>
<p>11） 短信服务订阅短信通知事件、邮件服务订阅邮件通知事件，完成短信通知或邮件通知。</p>
<h4 id="_19">服务发现和注册<a class="headerlink" href="#_19" title="Permanent link">¶</a></h4>
<p>平台通过服务主动上报的方式实现服务发现和注册。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920140132.png"><img alt="media/Pasted image 20230920140132.png" src="../../assets/img/Pasted%20image%2020230920140132.png" title="media/Pasted image 20230920140132.png"/></a></p>
<p>服务发现、注册及使用流程如下：</p>
<p>1） 各个服务通过集成通用模块，在服务启动时主动上报服务信息给zookeeper，上报的服务信息包括服务名称、URL地址。zookeeper通过监控服务的心跳实现服务准实时监控，当服务下线时zookeeper会取消该服务的信息，达到服务发现并掌握服务实时状态的效果。</p>
<p>2） 鉴权服务auth-server主动从zookeeper查询服务信息（因为traefik和zookeeper直接交互存在问题，所以引入auth-server实现服务信息查询）；</p>
<p>3） API网关traefik调用鉴权服务提供的API，周期性轮询所有服务信息，并把服务信息缓存在内存中，供API网关做服务路由时使用；</p>
<h3 id="_20">静态架构<a class="headerlink" href="#_20" title="Permanent link">¶</a></h3>
<h4 id="_21">前端代码结构<a class="headerlink" href="#_21" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920140723.png"><img alt="media/Pasted image 20230920140723.png" src="../../assets/img/Pasted%20image%2020230920140723.png" title="media/Pasted image 20230920140723.png"/></a></p>
<p>以src/app/routes/system为例，对组件下级目录规划如下</p>
<table>
<thead>
<tr>
<th>service</th>
<th>所有访问后台的service方法存放目录</th>
</tr>
</thead>
<tbody>
<tr>
<td>statis-data</td>
<td>存放一些前端的基本配置，比如key-v的映射关系，键值等信息</td>
</tr>
<tr>
<td>system-list</td>
<td>系统管理下子菜单的具体内容</td>
</tr>
<tr>
<td>system.component.</td>
<td>系统管理模块的母版页，所有内容都会经过这个页面，配置系统管理的菜单栏链接具体子菜单</td>
</tr>
<tr>
<td>system.module</td>
<td>系统管理模块的路由配置管理文件，与系统管理相关的所有url,外部引用的私有组件引入位置（只引用系统管理部分的私有组件，如FormsModule,DatePipe,ConfirmInfoComponent等每个模块都有可能使用的公共组件在父级路由文件里引用）</td>
</tr>
</tbody>
</table>
<h4 id="_22">后端代码结构<a class="headerlink" href="#_22" title="Permanent link">¶</a></h4>
<p>所有的后端代码都存放于backend目录下，各子工程平级并且不允许代码依赖,数据交互依赖 API接口和消息总线。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920140821.png"><img alt="media/Pasted image 20230920140821.png" src="../../assets/img/Pasted%20image%2020230920140821.png" title="media/Pasted image 20230920140821.png"/></a></p>
<p>各服务子目录如下：</p>
<table>
<thead>
<tr>
<th>工程名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform-user-service</td>
<td>用户管理</td>
</tr>
<tr>
<td>platform-resource-service</td>
<td>资源管理</td>
</tr>
<tr>
<td>platform-system-service</td>
<td>系统管理</td>
</tr>
<tr>
<td>platform-system-config-service</td>
<td>系统配置服务</td>
</tr>
<tr>
<td>platform-upgrade-service</td>
<td>升级服务</td>
</tr>
<tr>
<td>platform-notice-service</td>
<td>通知服务</td>
</tr>
<tr>
<td>platform-email-service</td>
<td>邮件服务</td>
</tr>
<tr>
<td>platform-sms-service</td>
<td>短信服务</td>
</tr>
<tr>
<td>platform-log-service</td>
<td>日志服务</td>
</tr>
<tr>
<td>platform-sync-service</td>
<td>数据同步服务</td>
</tr>
<tr>
<td>platform-schedule-service</td>
<td>定时任务</td>
</tr>
<tr>
<td>platform-ha-service</td>
<td>主备服务</td>
</tr>
<tr>
<td>platform-collect-service</td>
<td>帐号采集服务</td>
</tr>
<tr>
<td>platform-pwd-service</td>
<td>帐号改密服务</td>
</tr>
<tr>
<td>platform-base-common</td>
<td>全局公共类,如分页,全局状态码..</td>
</tr>
<tr>
<td>platform-base-common-utils</td>
<td>全局公共工具类,如时间,日期处理类</td>
</tr>
<tr>
<td>产品名称-子系统名称-service</td>
<td>其他产品扩展工程</td>
</tr>
</tbody>
</table>
<ul>
<li>单个服务的工程包结构</li>
</ul>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920140842.png"><img alt="media/Pasted image 20230920140842.png" src="../../assets/img/Pasted%20image%2020230920140842.png" title="media/Pasted image 20230920140842.png"/></a></p>
<p>说明：</p>
<p>1、有通用的util放置到platform-base-common-utils工程中</p>
<p>2、框架通用类请放置到platform-base-common工程中</p>
<p>3、domain的实体类必须保持干净，不允许有额外字段和逻辑，数据校验参数接收通过bo完成，返回前端数据通过vo完成，bo和vo一进一出。</p>
<p>4、一些与项目业务本身无关的封装可以放到manager中</p>
<p>5、基础平台开源组件、依赖包的引入必须通过SE评审，开发人员不能擅自引入，同时基础平台对引入的开源组件和依赖包必须保证版本统一，避免不同服务依赖不同版本的外部资源而导致服务冲突。</p>
<ul>
<li>产品扩展</li>
</ul>
<p>其他项目集成基础平台在backend目录下新起对应的扩展服务</p>
<p>1. 工程命名以 {项目名}-{子工程名}-service来新建服务</p>
<p>2. 工程代码参考上文描述结构来新建工程</p>
<p>3. 禁止代码级依赖基础平台相关服务，数据交互以API调用和消息总线来实现。</p>
<p>4. 例外:platform-base-common, platform-base-common-utils 相关jar可以代码级依赖。</p>
<h4 id="_23">自动化构建和打包<a class="headerlink" href="#_23" title="Permanent link">¶</a></h4>
<p>基础平台使用Jenkins实现自动化构建和打包，Jenkins可通过控制台操作项目创建、配置和自动化构建，以下从Jenkins安装、后端服务构建、前端服务构建、打安装包几个方面进行说明。</p>
<ul>
<li>Jenkins安装</li>
</ul>
<p>在打包机上新建centos操作系统的虚拟机，在虚拟机上部署Jenkins，Jenkins安装软件和详细安装步骤参考官方文档。Jenkins配置要求如下</p>
<p>l 2G以上可用内存</p>
<p>l 100G以上可用磁盘空间</p>
<p>l JDK1.8</p>
<ul>
<li>后端服务构建</li>
</ul>
<p>为每个后端服务创建任务并指定项目名称，因为我们使用maven，所以后端服务选择构建maven项目。</p>
<p>源码管理步骤指定基础平台相应服务对应的SVN地址并配置SVN的帐号和密码。</p>
<p>Build步骤指定pom文件和mvn命令，比如pom文件默认为“pom.xml”、mvn命令为“clean install -DskipTests”。</p>
<p>其他操作步骤保持默认即可，也可以根据业务需要进行配置，比如工程有依赖时在构建触发器章节选择“Build after other projects are built”并指定依赖的前序工程。</p>
<ul>
<li>前端构建</li>
</ul>
<p>为前端服务创建任务并指定项目名称，基础平台前端使用angular框架，选择Freestyle project项目。</p>
<p>构建步骤指定前端服务打包命令，比如“source /etc/profile &amp;&amp; cnpm install &amp;&amp; ng build –prod”</p>
<p>其他操作步骤配置和后端服务构建相同。</p>
<ul>
<li>打安装包</li>
</ul>
<p>所有服务构建好以后，需要把所有服务打成安装包，需要在SVN上提前规划好安装包的框架，包括安装脚本、编译脚本、依赖包、自定义脚本等，详细参考3.6.4安装包结构。</p>
<p>同样创建任务并指定项目名称，选择Freestyle project项目。</p>
<p>源码管理步骤，指定SVN上安装包框架地址并配置帐号和密码。</p>
<p>构建步骤，把每个服务已经构建好的包按照安装包框架要求拷贝到指定的目录下。</p>
<p>构建后操作步骤，指定ant命令和安装包框架下的build脚本。</p>
<p>通过以上配置即可实现基础平台自动化打包，打好的安装包统一存储在打包机上，需要定时打包时在构建触发器步骤配置周期性时间即可。</p>
<p>对于多品牌的情况，多品牌涉及到不同的logo、icon等静态文件，在SVN上可以为每个品牌创建一个安装包架构，同样在Jenkins上为每个品牌创建一个打安装包的项目指定对应的SVN地址即可</p>
<h4 id="_24">安装包结构<a class="headerlink" href="#_24" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141021.png"><img alt="media/Pasted image 20230920141021.png" src="../../assets/img/Pasted%20image%2020230920141021.png" title="media/Pasted image 20230920141021.png"/></a></p>
<h4 id="_25">文件系统规划<a class="headerlink" href="#_25" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141210.png"><img alt="media/Pasted image 20230920141210.png" src="../../assets/img/Pasted%20image%2020230920141210.png" title="media/Pasted image 20230920141210.png"/></a></p>
<h3 id="_26">部署形态<a class="headerlink" href="#_26" title="Permanent link">¶</a></h3>
<p>基础平台通过容器化方式部署，支持单机部署、分布式部署和云化部署。</p>
<h4 id="_27">单机部署<a class="headerlink" href="#_27" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141334.png"><img alt="media/Pasted image 20230920141334.png" src="../../assets/img/Pasted%20image%2020230920141334.png" title="media/Pasted image 20230920141334.png"/></a></p>
<p>用户管理、认证中心、资源管理、系统管理、数据同步、系统日志服务、邮件服务、短信服务等前后台服务每个服务都运行在一个容器中，系统配置服务、升级服务和DB运行在宿主机上。</p>
<p>用户管理、认证中心、资源管理、系统管理等服务的数据库独立，以不同的实例跑在同一个数据库软件上，数据库软件运行在宿主机上。</p>
<p>系统管理通过消息中心下发系统配置事件给系统配置服务，由系统配置服务完成对宿主机的时间配置、网络配置和电源配置。</p>
<p>系统管理完成升级包上传、校验和存储，通过消息中心通知升级服务，升级服务从指定服务器的指定路径下载升级包、完成对本机服务升级。</p>
<h4 id="_28">分布式部署<a class="headerlink" href="#_28" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141412.png"><img alt="media/Pasted image 20230920141412.png" src="../../assets/img/Pasted%20image%2020230920141412.png" title="media/Pasted image 20230920141412.png"/></a></p>
<p>分布式部署的情况下，优先安装DB、缓存中心和消息中心，在安装其他服务的时候必须指定DB、缓存中心和消息中心的地址。</p>
<p>各服务安装后，主动上报自身地址到缓存中心，由缓存中心统一维护所有服务的地址（DB地址除外），供API网关路由查找各服务时使用，同时向消息中心上报服务地址。</p>
<ul>
<li>服务地址变更</li>
</ul>
<p>系统管理所在的服务器，通过前端界面修改本服务器地址，驱动后台系统配置服务完成本服务地址变更、向消息中心上报地址变更事件、更新缓存中心缓存的本服务的地址。</p>
<p>其他服务所在的服务器，通过后台管理菜单修改服务器地址，同样驱动系统配置服务完成本服务器的地址变更，其他逻辑与界面修改地址相同。</p>
<p>当服务地址变更时，被通知者的系统配置服务订阅消息中心其他服务地址变更事件，并更新本地的host文件，用于各服务交互通信时使用。各服务通信时使用域名进行通信，不使用IP地址，避免IP地址变更导致的频繁切换访问地址。</p>
<ul>
<li>部署约束</li>
</ul>
<p>分布式部署情况下，以下服务要和系统管理部署在同一个服务器上</p>
<p>1) 系统日志服务，系统管理提供管理界面需要下载系统日志服务在本机记录的日志。</p>
<p>2) NTP时间服务器和系统管理部署在一台服务器上，方便通过界面配置NTP。</p>
<ul>
<li>时间配置</li>
</ul>
<p>系统管理所在的服务器安装NTP时间服务器，通过系统管理可以实现以下几种方式的时间配置。</p>
<p>1） 以国家授权中心时间为准</p>
<p>2） 以我们部署的NTP服务器时间为准</p>
<p>3） 手工配置时间</p>
<p>分布式部署情况下，其他服务器作为客户端同步系统管理所在的服务器的时间，无论以上哪种方式配置时间，都可以达到分布式的各服务器时间一致的效果。</p>
<ul>
<li>安全性考虑</li>
</ul>
<p>分布式部署情况下，消息中心和缓存中心考虑通过IP绑定和使用非默认端口的方式实现安全控制，防止外部地址非法访问和恶意扫描。</p>
<h4 id="_29">微服务云化部署<a class="headerlink" href="#_29" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141459.png"><img alt="media/Pasted image 20230920141459.png" src="../../assets/img/Pasted%20image%2020230920141459.png" title="media/Pasted image 20230920141459.png"/></a></p>
<p>微服务云环境部署情况下，系统配置由云平台提供，各服务的升级通过镜像方式升级，无需部署系统配置服务和升级服务，同样数据库软件由云平台提供。</p>
<h3 id="_30">版本升级<a class="headerlink" href="#_30" title="Permanent link">¶</a></h3>
<p>基础平台版本升级从版本号规划、软件升级机制、DB升级机制三方面进行考虑。</p>
<h4 id="_31">版本规划<a class="headerlink" href="#_31" title="Permanent link">¶</a></h4>
<p>版本格式：主版本号.次版本号.修订号，版本号递增规则如下：</p>
<p>主版本号：当做了无法向下兼容的修改时修改主版本号；</p>
<p>次版本号：当做了向下兼容的功能性变更时修改次版本号；</p>
<p>修订号：当做了向下兼容的BUG修正时修改修订号；</p>
<p>基础平台第一个版本，版本号规划为1.0.0。</p>
<h4 id="_32">软件升级机制<a class="headerlink" href="#_32" title="Permanent link">¶</a></h4>
<p>各个服务软件升级时，升级流程会先停服务、备份历史软件到备份目录、拷贝新软件覆盖软件安装目录、再启动容器实现服务升级。</p>
<p>升级后，如果验证服务异常，则可以手工恢复历史软件来实现升级回退。</p>
<p>考虑到磁盘空间的使用，备份目录只保留最近一次历史软件的备份。</p>
<h4 id="db">DB升级机制<a class="headerlink" href="#db" title="Permanent link">¶</a></h4>
<p>DB升级机制没有备份恢复，DB升级通过设置约束向下兼容来规避升级回滚的需求。DB变更遵循以下约束：</p>
<ul>
<li>新增表</li>
</ul>
<p>新增表时，在升级脚本中通过SQL完成表创建、数据初始化和表约束配置。</p>
<ul>
<li>删除表</li>
</ul>
<p>DB升级，不允许删除表。</p>
<ul>
<li>新增字段</li>
</ul>
<p>新增字段时，在升级脚本中通过SQL完成字段新增、类型设置、必填项时的默认值设置</p>
<ul>
<li>修改字段</li>
</ul>
<p>DB升级，不允许修改字段，比如字段类型、字段约束，对于字段类型修改只能新增一个字段并把老字段的值拷贝到新字段来使用；字段约束通过业务控制或默认值实现。</p>
<ul>
<li>删除字段</li>
</ul>
<p>DB升级，不允许删除字段。</p>
<ul>
<li>修改初始化数据</li>
</ul>
<p>新增、修改、删除初始化数据时，同样在升级脚本中通过SQL完成。</p>
<p>说明：任何版本的DB升级，必须基于上版本DB的基础上对DB进行修改，比如1.0.0有一条初始化数据，1.0.1版本删除了该数据，1.0.2该数据时需要基于1.0.1执行insert语句，而非基于1.0.0执行update。</p>
<h4 id="_33">跨版本升级<a class="headerlink" href="#_33" title="Permanent link">¶</a></h4>
<p>以上的升级机制能够满足次版本号和修订号的跨版本升级。</p>
<h3 id="_34">产品集成<a class="headerlink" href="#_34" title="Permanent link">¶</a></h3>
<p>DSMP或新产品在基础平台基础上集成产品的特性功能，比如授权、风险中心等。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../../assets/img/Pasted%20image%2020230920141731.png"><img alt="media/Pasted image 20230920141731.png" src="../../assets/img/Pasted%20image%2020230920141731.png" title="media/Pasted image 20230920141731.png"/></a></p>
<ul>
<li>前端</li>
</ul>
<p>在基础平台的前端工程中规划产品目录，新增产品特性的前端功能，并把相应功能注册到前端框架中；特殊情况可能需要对基础平台前端业务进行修改，比如在用户管理列表增加授权入口，这种情况下需要对基础平台相应前端进行修改，这种修改放在产品侧维护，基础平台不关注。</p>
<ul>
<li>后端</li>
</ul>
<p>后端根据产品特性需求新增一个或多个独立工程，并搭配多个相互独立的DB，产品打包时把基础平台和产品特性工程打包到一起。</p>
<ul>
<li>消息中心和缓存中心</li>
</ul>
<p>消息中心和缓存中心不影响。</p>
<ul>
<li>后台服务</li>
</ul>
<p>后台服务根据产品需求新增相应的后台服务，不允许修改基础平台已有的后台服务。</p>
<p>守护进程新增对产品特性服务进行监控。</p>
<!-- Source file information -->
<!-- taken from 
https://github.com/squidfunk/mkdocs-material/blob/master/src/partials/source-file.html -->
<hr/>
<div class="md-source-file">
<small>
<!-- mkdocs-git-revision-date-localized-plugin -->
<u>最后更新</u> :
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年9月20日</span>
<!-- mkdocs-git-revision-date-plugin -->
<br/>
<u>创建日期</u> :
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2023年9月20日</span>
<br/>
<u>Auteur</u> : 罗潇
        
        
    </small>
</div>
<!-- Was this page helpful? -->
<!-- Comment system -->
<!-- Giscus -->
<!-- Giscus -->
<script> 
    try {
      const index = document.querySelector('h1').innerHTML;
      if (index === "Index") {
        document.querySelector('h1').innerHTML = "基础平台1.0";
      }
    } catch (error) {
      // console.log(error);
    }
  </script>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            回到页面顶部
          </button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2022 - 2023 启明星辰-天榕
    </div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.path", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>