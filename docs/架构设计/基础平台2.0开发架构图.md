---
created: 2023-09-22
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 开发架构图
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 基础平台2.0开发架构图
platform: true
category: 架构设计
---

# 开发架构图

平台开发框架图按照前后端工程划分。
从工程的依赖、构建和组织, 安装包目录及文件系统几个方面进行描述。

## 前端工程

[//]: # (前端工程分为用户管理, 系统管理, 资产管理三个子项目，每个项目拥有一致的工程组织外观。)  
  
[//]: # ()  
[//]: # (所有的前端代码都存放于frontend目录下，所有前端统一为一个独立工程，功能代码结构如下：)  
  
[//]: # ()  
[//]: # (![[../assets/img/frontend_file_layout.svg|diagram/architecture/platform2.0/frontend_file_layout.svg]])


## 后端工程

基础平台的后端工程，不仅仅是一个工程项目，它融合了所有项目的源码，与此同时，各服务和其依赖以精细的模块方式组织，构建了紧密而有序的工程结构。

### **依赖视角**

![[../assets/img/基础平台2.0开发架构图_模块依赖视角.excalidraw.svg|基础平台2.0开发架构图_模块依赖视角.excalidraw]]

**网关模块**: 这是一个完全独立的模块，融合了auth模块, 提供了路由, 认证鉴权凭证等功能。

**公共服务模块**：涵盖了用户、系统和资产等三大核心服务，每个服务都能独立地进行。

**公共依赖模块**：根据技术领域进行划分，给开发赋能。我们也会提供聚合依赖 (1) 来做方便引入和版本管理。
{ .annotate }

1. 它将多个相关的子依赖组合在一起，使得外部项目可以通过单一的依赖引入多个子模块。当一个大型项目或库提供了多个模块，并希望用户能够轻松地引入所有模块而不必逐一指定它们时。这种方法的一个缺点是，它可能会导入项目实际上不需要的依赖，从而增加了最终构建产物的大小。

**插件和低代码工具集合**：一个字节码编辑，服务低代码编程的工具集合。给业务方编译时增强和运行时增强的能力。

### **构建视角**

![[../assets/img/基础平台2.0开发架构图_模块打包视角.excalidraw.svg|基础平台2.0开发架构图_模块打包视角.excalidraw]]

其中：
- 产品的公共服务工程选择性的引入用户服务, 系统服务和资源服务. 引入后, 工程便具备了对应的能力, 能对外提供相应的服务. 
- 插件和低代码工程除了完成字节码注入的工作外, 还能修改运行时环境, 通过直接以agent或者运行时依赖的模式与产品代码一起运行, 为非功能性业务赋能.
- 元数据工程是存放元数据信息，主要包括依赖管理, 插件管理和公共的maven属性管理。
- gateway使用了不同的体系, 与其他部分不兼容。其完全独立于以上架构体系之外。故不在以上图中体现。我们会在编译过程中引入(可选)GraalVM, 进一步提高路由和认证的速度, 减少内存占用。

### **工程组织视角**

![[../assets/img/file_layout.svg|file_layout]]

说明：

1. 当前的工程代码组织并不完整，仅作为项目代码组织方式和约束的示意。
2. 对于公共组件，我们的设计哲学是确保在分解工程的同时，还能保持领域设计的独立进化。
3. 数据库脚本以Flyway管理。
4. 服务间接口调用走[[./基础平台2.0逻辑架构图#内置服务部署|虚拟通道]], 兼顾整合服务在一起部署和拆分部署两种。


### 构建与自动化构建

通过CI/CD管道完成构建测试发布流程, 打通所有中间环节

包括
1. 基于jekins构建的CI/CD管道
2. 编写jekins脚本, 从源码仓库拉取特定版本源码, 运行自动化测试, 打包等
3. 支持自动构建在线文档
4. 将打好的包自动上传到maven私仓上面

## 安装包结构

我们不要求任何安装包结构.

## 文件系统规划

公共服务, 强绑定文件名, 但强不绑定任何文件目录(默认 /data/p2/ 目录下).

我们会在项目中声明配置文件名和其所在目录, 这些是强制规定的.

同时, 我们也不严格规定日志目录(默认目录: /data/p2/logs/), 最终可由业务方配置.


### **编译策略**

利用maven的整合包工程，不仅能提供基本的源码编译包，还深入地定义了整合包。不止于简化一键引入所有依赖的操作，更进一步提供了版本升级和管理功能。

针对gateway、认证与鉴权凭证，我们引入了（可选择的）GraalVM技术。这不仅大大提升了路由和认证的速度，更有效地降低了内存消耗。

### **构建与自动化流程**

我们构建的目的不只是为了产生jar包，更是为了构建一条自动化的、从编码到发布的连贯流程。

其中包括：
1. 基于Jenkins的强大CI/CD管道。
2. 精心编写的Jenkins脚本，能够从源码仓库自动拉取指定版本的源码、执行自动化测试并完成打包工作。
3. 优秀的在线文档自动构建功能。
4. 自动将构建好的包上传到maven私有仓库。

### **安装包策略**

我们不要求任何安装包结构。

### **文件系统策略**

在公共服务方面，采用了强约束的文件命名策略，但对于文件目录（默认是`/data/p2/`目录下）可配。项目中包含了高度可配置的配置文件，它们的文件名和存储目录遵循固定规则。

日志，提供默认目录(`/data/p2/logs/`)，但业务方可以根据自己的需求进行配置。
