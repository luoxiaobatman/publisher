---
created: 2023-09-22
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 开发架构图
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 基础平台2.0开发架构图
platform: true
category: 架构设计
---

# 开发架构图

平台开发框架图按照前后端工程划分。
包括工程依赖结构、工程组织结构、编译构建、安装包目录及文件系统几个方面进行描述。

## 前端工程

前端工程分为用户管理, 系统管理, 资产管理三个子项目，每个项目拥有一致的工程组织外观。

所有的前端代码都存放于frontend目录下，所有前端统一为一个独立工程，功能代码结构如下：

![[../assets/img/frontend_file_layout.svg|frontend_file_layout]]


## 后端工程

基础平台的后端工程，不仅仅是一个工程项目，它融合了所有项目的源码，与此同时，各服务和其依赖以精细的模块方式组织，构建了紧密而有序的工程结构。

### **从工程依赖角度看**

![[../assets/img/基础平台2.0开发架构图_模块依赖视角.excalidraw.svg|基础平台2.0开发架构图_模块依赖视角.excalidraw]]

- **网关模块**: 这是一个完全独立的模块，融合了auth模块, 提供了路由, 认证鉴权凭证等功能。

- **公共服务模块**：这是一个包罗万象的模块，涵盖了用户、系统和资产等三大核心服务，每个服务都能独立地进行进化和相互通信。
    
- **公共依赖模块**：它根据技术领域进行精确划分，既可以为单独的依赖提供服务，也可以全方位地提供服务。
    
- **ASM工具**：一个关于字节码编辑的强大工具，服务低代码编程。给与使用方项目编译时增强和运行时增强的能力。

### **从工程构建的视角看**

![[../assets/img/基础平台2.0开发架构图_模块打包视角.excalidraw.svg|基础平台2.0开发架构图_模块打包视角.excalidraw]]

其中：

- **common模块**：我们的实用工具包。根据工具的专业领域，我们进行了分解，确保每个工具都能独立开发和进化。此外，我们还为整个包提供了统一的版本管理和一键式引入功能。
    
- **service-xxx模块**：针对当前的微服务架构，我们有三个此类模块。
    
- **meta**：存放元数据信息，主要包括依赖管理和公共的maven属性管理。
    
- **asm-xxx** 和 **agent-xxx**：分别为字节码打桩工具和agent工具，为低代码工程提供支持。

- gateway使用了不同的体系, 与其他部分不兼容。其完全独立于该架构体系之外。

### **从工程组织视角看**

- **公共服务**：采用直接引入jar包的来实现模块的灵活组织，以满足服务的多样性需求。
- **公共依赖**：严格按技术领域进行划分，保证技术的独立进化。同时，提供了common-all等包，旨在简化业务方的依赖管理。
- **元数据工程**
- **gateway**
- **字节码工具**

项目代码组织视图：

![[../assets/img/file_layout.svg|file_layout]]

说明：

1. 当前的工程代码组织并不完整，仅作为项目代码组织方式和约束的示意。
2. 我们的设计哲学是确保在分解工程的同时，还能保持领域设计的独立进化。
3. 数据库脚本以Flyway管理。
4. 服务间接口调用走虚拟通道, 兼顾整合服务在一起部署和拆分部署。

### 编译

模仿maven整合包工程, 除了基础的源码编译包外, 我们还会定义了整合包, 除了提供一键引入所有依赖外, 还提供了版本升级和管理能力.

对于gateway以及认证鉴权凭证, 我们会在编译过程中引入(可选)GraalVM, 进一步提高路由和认证的速度, 减少内存占用.

### 构建与自动化构建

构建用于构建jar包, 通过CI/CD管道, 打通编码到发布jar包的中间环节

包括
1. 基于jekins构建的CI/CD管道
2. 编写jekins脚本, 从源码仓库拉取特定版本源码, 运行自动化测试, 打包等
3. 支持自动构建在线文档
4. 将打好的包自动上传到maven私仓上面

## 安装包结构

我们不要求任何安装包结构.

## 文件系统规划

公共服务, 我们强绑定文件名, 但强不绑定任何文件目录(默认/data/p2/ 目录下).

会在项目中提供灵活多变的配置文件, 这些配置文件的文件名和目录是强制规定的.

同时, 我们也不严格规定日志目录(/data/p2/logs/), 最终由业务方配置


### **编译策略**

利用maven的整合包工程，不仅能提供基本的源码编译包，还深入地定义了整合包。不止于简化一键引入所有依赖的操作，更进一步提供了版本升级和管理功能。

针对gateway、认证与鉴权凭证，我们引入了（可选择的）GraalVM技术。这不仅大大提升了路由和认证的速度，更有效地降低了内存消耗。

### **构建与自动化流程**

我们构建的目的不只是为了产生jar包，更是为了构建一条自动化的、从编码到发布的连贯流程。

其中包括：
1. 基于Jenkins的强大CI/CD管道。
2. 精心编写的Jenkins脚本，能够从源码仓库自动拉取指定版本的源码、执行自动化测试并完成打包工作。
3. 优秀的在线文档自动构建功能。
4. 自动将构建好的包上传到maven私有仓库。

### **安装包策略**

我们不要求任何安装包结构。

### **文件系统策略**

在公共服务方面，采用了强约束的文件命名策略，但对于文件目录（默认是`/data/p2/`目录下）可配。项目中包含了高度可配置的配置文件，它们的文件名和存储目录遵循固定规则。

至于日志，提供默认目录(`/data/p2/logs/`)，但允许业务方根据自己的需求进行配置，保障了存储的灵活性。
