---
created: 2023-09-22
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 开发架构图
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 基础平台2.0开发架构图
platform: true
category: 架构设计
---

# 开发架构图

平台开发框架图主要从前后端工程划分和代码结构、产品构建和打包、安装包目录及文件系统几个方面进行描述。

## 前端工程

TODO

前端工程分为用户管理, 系统管理, 资产管理三个子项目，每个项目拥有一致的工程组织外观。

所有的前端代码都存放于frontend目录下，所有前端统一为一个独立工程，功能代码结构如下：

![[../assets/img/frontend_file_layout.svg|frontend_file_layout]]


## 后端工程

### 项目视角看

基础平台，作为一个项目工程，包含所有项目源码，各服务和依赖以工程模块形式组织。工程模块逻辑关系：

![[../assets/img/基础平台2.0开发架构图_模块依赖视角.excalidraw.svg|基础平台2.0开发架构图_模块依赖视角.excalidraw]]


* Base基础模块

封装全局公共资源，包括实体定义、DAO操作层、DTO、BO、工具类、配置类等等，以及全局共享的基础服务，其他业务模块依赖此模块。

* 消息通道抽象层

在基础模块中定义通道抽象层，此层中定义服务模块Controller层的抽象接口IController、Feign调用客户端实现FeignClient，以分别实现本地调用和跨服务调用。

* 模块服务

基于4.2章节划分的后端微服务，一个模块服务即实现一个微服功能。在此模块中定义与当前服务相关的controller、service等，且Controller实现通道抽象层中定义的IController接口抽象。

以下是项目组织划分：

工程划分

![[../assets/img/基础平台2.0开发架构图_模块打包视角.excalidraw.svg|基础平台2.0开发架构图_模块打包视角.excalidraw]]

其中：

common模块是我们的工具包, 里面我们会根据工具的领域情况, 单独拆分部分工具独立开发独立进化, 我们也会提供ALL依赖, 并编排版本, 一键引入. service-xxx，模块服务，根据当前微服务划分，共有3个此类模块。meta, 元数据信息, 包括依赖管理, 公共的maven properties管理. asm-xxx, 字节码打桩工具, agent-xxx, agent工具, 以上两项均为低代码工程引用

gateway由于使用了不同的体系, 与其他部分不兼容.

### 从工程构建视角看

公共服务来看:
我们采用直接import的方式实现模块的随意拆分合并, (代码里面定义好了controller service dao等, 依赖包里有这个jar, spring会自动加载的), 以实现服务的拆分与合并

公共依赖来看:
common模块作为工具类，实现我们的服务赋能的同时, 对外也暴露依赖接口, 提供维护服务。同时, 提供platform-commons-all等包, 简化依赖引入, 控制版本发布. 同时也允许在all包后面声明进化后的版本(前提是依赖要兼容)

项目代码组织：

![[../assets/img/file_layout.svg|file_layout]]


说明：

1） 当前工程代码组织，非完整结构，只是示意项目代码组织方式和约束

2） 一个工程，独立进化, 独立版本, 独立jar，业务方按需引入, 以匹配单机、集群、容器化部署等多场景

3） 公共依赖组织形式按技术领域切割, 公共服务组织形式按业务领域切割

4） 除业务服务模块外，项目其他代码，在运行时是公共的

5） 数据库脚本以Flyway管理, (如何管理TODO)

6） 服务间接口调用走rpc通道, web调用走rest controller

### 编译

模仿maven整合包工程, 除了基础的源码编译包外, 我们还会定义了整合包, 除了提供一键引入所有依赖外, 还提供了版本升级和管理能力. 同时, 支持引入子模块, 覆盖(必须与父模块兼容)
项目上按需引入和使用.

对于gateway, 我们提供


### 构建与自动化构建

构建用于构建jar包, 
依赖CI/CD管道, 打通编码到发布jar包的中间环节

包括
1. 运行CI/CD管道的工具, 选用jekins
2. 编写jekins脚本, 从源码仓库拉取特定版本源码, 运行自动化测试, 打包等
3. 自动构建在线文档
4. 将打好的包自动上传到maven私仓上面

## 安装包结构

我们不要求任何安装包结构, 作为架构,编码和设计的时候设计哲学


## 文件系统规划

公共服务, 我们强绑定文件名, 但不绑定任何文件目录(默认/data/p2/ 目录下), 业务方可配
公共组件, 

会在项目中提供灵活多变的配置文件(格式由我们来定), 由业务方声明配置文件所在目录

同时, 我们也不严格规定日志目录, 而是提供默认日志目录, 最终由业务方配置
