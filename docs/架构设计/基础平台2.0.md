---
created: 2023-09-22
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 基础平台2.0
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 基础平台2.0
platform: true
category: 架构设计
---

| **版本** | **作者** | **修改时间** | **修改内容** |
| -------- | -------- | ------------ | ------------ |
| V1.0     | 陈亮     | 2023.9.20    | 起草架构设计 |


> [!info] TLDR
> 1. **简介：**
>     - 该文档介绍了基础平台2.0的架构设计，涵盖功能架构、逻辑架构、开发架构、运行架构和物理架构。
>     - 旨在为研发人员提供一个对基础平台的深入理解，并为其业务功能的快速开发提供支持。
>     - 文档主要适用于SE、研发经理和开发人员阅读。
> 2. **设计目标与原则：**
>     - **设计目标：**
>         - 简化技术难度，降低人力成本。
>         - 提供公共服务，避免重复劳动。
>         - 平台代码和产品代码进行隔离。
>         - 提供多种部署方式，包括低资源消耗或高性能支撑。
>     - **关键功能：**
>         - 包括网关服务、系统服务、用户服务、消息模块和公共代码。
>     - **关键质量属性：**
>         - 详细列出了硬件配置和性能要求。
>         - 着重强调了规范性、易用性和接口化。
>     - **部署方式：**
>         - 提供低资源部署、高性能部署和容器化部署三种方式。
>     - **设计约束：**
>         - 对服务间交互和操作系统交互都有明确的约束。
>     - **设计原则：**
>         - 功能与业务功能隔离，强调配置与扩展的重要性。
> 
> 3. **技术选型：**
>    - 后端采用 Spring Boot、Spring security、MyBatis-Plus；前端使用 AngularJS。
>    - API服务网关基于Spring cloud gateway。
>    - 引入ActiveMQ作为嵌入式MQ，满足低资源部署需求。
> 
> 4. **功能架构：**
>    - 基础平台主要由基础功能、API网关、公共服务和前端组成。
>    - 基础能力通过Maven依赖注入，无需部署。
>   - 前端负责提供平台界面，包括系统登录、用户管理等功能。
>   - API网关负责路由加载、登录认证等。
>   - 功能服务包括系统管理、用户管理和资产管理。
>   - 中间件主要依赖Postgresql，但不强依赖Kafka和Redis。

  
# 1. **简介**

本文档为基础平台2.0架构设计文档，包括功能架构、逻辑架构、开发架构、运行架构、物理架构。

## 1.1. **目的**

本文档为基础平台2.0架构设计文档，从功能架构、逻辑架构、开发架构、运行架构、物理架构等五个方面介绍了基础平台2.0，为研发人员了解基础平台并快速开发业务功能提供支撑。

## 1.2. **阅读范围**

该文档适用于SE、研发经理和开发人员。

SE：本文档由平台SE进行维护，产品SE通过文档理解平台设计，并指导产品开发人员进行二次开发。

研发经理：通过本文档理解平台设计，为平台提供指导意见。

开发人员：学习平台设计，并利用平台进行二次开发。

  

# 2. **设计目标与原则**

## 2.1. **设计目标**

* **降低技术难度，节省人力成本，<mark style="background: #6082C5A6;">增强代码安全性</mark> **：基础平台的主要目的是能够让开发人员快速的开发出复杂的业务功能，让其专注业务开发，由有平台来封装技术细节，缩短项目周期。封装技术细节时强制插入安全规范，增加代码安全性。<mark style="background: #6082C5A6;">在基础平台设计中，代码的安全性被视为一项核心目标。为了确保开发人员在开发复杂业务功能时遵循最佳的安全实践。</mark> 
* **提供公共服务**：系统管理，用户管理，网关转发，登录认证等业务功能在各产品大体相同，平台提供统一功能，并预留功能扩展点，避免各产品重复开发，浪费人力。
* **平台代码和产品代码隔离**：平台代码以编译版本发布，产品二次开发时直接引用，避免平台和产品代码混合。
* **支持低资源消耗或高性能支撑部署方式**：平台部署时需兼顾资源消耗和性能支撑，灵活切换部署方式。

<mark style="background: #6082C5A6;">**增强代码安全性**</mark> (1)
{ .annotate }
1. **封装技术安全细节**：平台自动为开发人员处理诸如输入验证、SQL注入防护、跨站脚本攻击(XSS)防范等安全细节，使开发人员可以更专注于业务逻辑，而不是安全实现。
    **强制安全规范**：平台内部集成了自动化安全检查工具，确保在开发过程中自动检查和遵循已定义的安全规范。
    **安全培训和文档**：提供针对性的安全培训和文档，确保开发人员了解并遵循平台推荐的安全策略。
    **定期审计与更新**：随着技术和威胁的发展，平台定期进行安全审计，确保代码库始终与当前的安全标准相匹配。

### 2.1.1. **关键功能**

**网关服务：**API服务路由，统一身份认证和鉴权，支持密码，OAuth，Cas，OTP等多种认证方式 。

**系统服务：**提供IP，SSH，时间，防火墙，升级，公告等常用系统管理功能。涉及操作系统交互都是用ITR接口。

**用户服务：**用户和权限管理。

**消息模块：**提供嵌入式或高性能两种模式，灵活切换，自由选择。

**公共代码：**封装常用非业务功能，例如：工具类，Web，ORM，消息，缓存，RPC，邮件，短信，配置等，降低框架使用难度，提升开发效率。

### 2.1.2. **关键质量属性**

* 最低硬件配置

CPU：4核

内存：2G

* 最低硬件性能

身份认证：不小于100次/秒

路由转发：不小于100次/秒

操作鉴权：不小于100次/秒

* 规范化：严格按照先设计后开发原则，设计优于开发，每个功能必须出详细设计文档

* 易用性：方便好用是开发平台基本要求，每个功能力争做到配置化开发，考虑后期扩展，预留扩展点和事件

* 接口化：公共服务面向接口编程，按插件接口设计和开发

### 2.1.3. **部署方式**

基础平台用户产品二次开发，需要灵活部署方式适应各种需求。

**低资源部署：**资源受限情况下，合并服务与组件，以较低资源进行部署，架构简单，部署便捷，业务流转快。

**高性能部署：**服务与组件采用单独部署，充分利用资源，服务间不强制依赖，独立运行，不存在单点问题，支撑大数据和高并发。

**容器化部署：** 满足上云需求，服务和组件都支持镜像部署。

### 2.1.4. **设计约束**

由于部门架构的要求，基础平台遵循以下技术约束：

1. 服务间交互

为了服务高内聚低耦合，减少服务内部变化导致外部影响，服务间交互都采用Rest接口，禁止直接连接服务数据库或中间件获取数据，并且服务接口需考虑后期维护和扩展，尽量做到接口不改或少改。

2. 操作系统交互

系统服务存在大量与操作系统交互操作，例如：IP，DHCP，时间，防火墙，只要ITR系统平台已提供的功能，都需通过ITR完成与操作系统交互，严禁支持使用操作系统命令。

## 2.2. **设计原则**

* **基础功能和业务功能隔离**

基础功能是业务无关，为服务赋能，独立工程开发，即插即用。

业务功能是产品间共性功能，例如：网关，系统管理，用户管理，资产管理。各服务需边界明确，高内聚低耦合，通过接口交互，数据库独立设计。

* **配置与扩展**

平台做为二次开发底座，交付每个功能都要考虑产品使用时的个性化需求，做到易使用，易扩展。功能设计预先考虑变化点，设计相关配置项，提前预留相关扩展点。公共服务需遵循插件化设计原则，以适应功能不满足需求时的复写扩展。

## 2.3. **技术选型**

* 后端基于 Spring Boot、Spring security、MyBatis-Plus，前端采用 AngularJS。前后端框架都在业界广泛使用，受众广，易使用，社区活跃，文档全面，二次开发时能做到无缝连接。

* API服务网关改为自研，引入Spring cloud gateway。Spring Cloud Gateway是基于WebFlux框架实现的，而WebFlux框架底层则使用了高性能的Reactor模式通信框架Netty，并提供动态路由、限流、均衡负载等高级特性。

* 为减轻对Kafka依赖，引入ActiveMQ作为嵌入式MQ。Apache ActiveMQ是一款老牌消息中间件，稳定性高，功能丰富，作为低资源部署时Message Broker。

# 3. **功能架构图**

![[../assets/img/Pasted image 20230922094258.png|Pasted image 20230922094258]]

* 基础平台包括基础功能、API网关、公共服务、前端。

* 基础能力无需部署，通过Maven依赖注入，即插即用。

* 前端提供平台界面，实现系统登录、用户管理、资源管理、系统管理等功能。

* API网关提供路由加载、登录认证、操作鉴权、访问会话管理等功能。

* 功能服务包括系统管理，用户管理，资产管理。

* 中间件只强依赖Postgresql，消息与缓存不强依赖Kafka和Redis，可通过嵌入式中间件提供服务。

# 4. **逻辑架构图**
