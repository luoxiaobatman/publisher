---
created: 2023-09-20
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 认证鉴权机制.架构设计.p1
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 认证鉴权机制.架构设计.p1
platform: true
category: hide
---

### 认证鉴权机制

![[../assets/img/Pasted image 20230920134535.png|Pasted image 20230920134535]]

针对浏览器、外部API和后台服务发起的业务请求，API网关把业务请求统一转发给认证中心的票据服务进行票据验证，只有携带合法票据的请求会被转发给相应的服务，由相应的服务提供响应。一次完整的业务请求流程如下：

1） API网关接收业务请求，把业务请求转发给认证中心的票据服务；

2） 票据服务进行判断有效性校验，分以下三种情况

* 浏览器访问的场景，跳转认证中心登录界面完成用户和密码输入并提交认证请求到认证中心身份认证服务进行身份认证，继续步骤3和4；
* 外部API访问的场景，转发请求到认证中心身份认证服务进行身份认证，继续步骤3和4；
* 后台服务访问的场景，转发请求到认证中心身份认证服务进行身份认证，继续步骤3和4；

3） 身份认证成功，返回认证结果；

4） 票据服务根据认证结果生成合法票据，并把携带票据和校验结果的请求返回给调用者；

5） 浏览器、外部API和后台服务携带合法票据请求API网关，API网关转发转发请求到认证中心的票据服务；

6） 票据服务校验票据合法，把携带票据和校验结果的请求返回给API网关（通过状态判断，不再请求认证中心）

7） API网关根据票据校验结果把请求路由到用户管理服务完成业务操作；

8） 用户管理需要请求资源管理的API，携带票据发送请求到API网关；

9） API网关转发携带票据的请求给票据服务；

10） 票据服务校验票据合法，返回校验结果给API网关（通过状态判断，不再请求认证中心）；

11） API网关把请求路由到资源管理服务完成业务操作。

通过浏览器登录平台时通过界面输入用户和密码换取票据后执行后续业务请求；外部API和后台服务需要携带用户身份请求API网关换取票据后执行后续业务请求，不同的请求对API网关透明，身份认证、票据生成、鉴权机制相同。

平台为浏览器、外部API和后台服务的访问分配不同的用户，用于区分不同来源的业务请求，给外部API和后台服务分配的用户控制禁止通过浏览器登录。
