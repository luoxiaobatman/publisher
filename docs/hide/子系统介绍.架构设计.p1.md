---
created: 2023-09-20
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 子系统介绍.架构设计.p1
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 子系统介绍.架构设计.p1
category: hide
platform: true
---

### 子系统介绍

基础平台包括：认证中心、用户管理、资源管理、系统管理、API网关、消息中心、缓存中心、系统配置、系统日志、短信服务、邮件服务、数据同步、定时任务、帐号采集、帐号改密、升级服务、主备服务和进程守护服务。


认证中心提供统一登录界面，实现多种认证因子的身份认证、票据管理、认证转发，实现基于CAS、OAuth、SAML等多种标准协议的应用接入认证和单点登录功能。

认证中心同时提供票据服务，为API网关的请求提供票据生成和校验功能。

* 用户管理

用户管理包括用户属性管理、用户组织/用户组管理、用户口令策略管理、用户登录策略管理和OTP认证因子管理。

* 资源管理

实现资源管理、资源组管理、帐号管理、口令策略以及基于资源的敏感数据发现、帐号核查、一致性稽核、帐号改密等功能。

* 系统管理

系统管理主要实现系统角色管理、系统配置管理、系统信息管理、堡垒机管理、接口管理和热备管理。

* API网关

API网关为所有内外部请求的入口。基于安全考虑，所有外部请求通过https协议请求API网关，由API网关转发请求给具体子系统，为提高效率，内部子系统之间的请求通过http协议请求API网关，由API网关转发请求给相应的子系统。

请求到API网关后，API网关和认证中心联动完成当前请求的鉴权，鉴权通过后进行后续的业务操作。为避免API网关出现瓶颈，不承载业务处理，具体业务由各子系统和后台服务完成。

API网关采用traefik实现，traefik设计上考虑了更多的安全性，支持docker状态监控。

* 消息中心

消息中心实现子系统和后台服务之间的数据交互。

子系统向后台服务同步消息时，在不增加业务复杂度的前提下尽可能把后台服务所需的信息都同步过去，减少后台服务再次查询数据。

后台服务需要查询数据时，优先通过API网关查询子系统的API查询数据，如果需要查询的数据过于复杂，可以考虑由后台服务直接访问数据库。

消息中间件采用kafka。

* 缓存中心

缓存中心把频繁使用的配置信息缓存起来，提高访问性能、减少DB操作，比如堡垒机地址每次调用接口执行运维操作时都用到，可以写入缓存中心。

缓存中心采用Redis。

* 系统配置服务

系统配置服务为后台服务，以root运行，承载对操作系统的配置，包括网络配置、电源配置、时间配置、服务启停和各服务地址维护。系统管理子系统提供业务操作，驱动系统配置服务完成具体的配置动作。

* 系统日志服务

系统日志服务为后台服务，提供所有子系统和服务的日志记录功能。所有子系统和服务把日志通过消息中心给系统日志服务，由系统日志服务完成日志持久化及日志外发动作。

* 短信服务

承载系统所有短信的发送功能，短信服务从消息中心订阅需要发送短信的事件，完成短信网关连接管理和具体的发送。

* 邮件服务

承载系统所有邮件的发送功能，邮件服务从消息中心订阅需要发送邮件的事件，完成邮件服务器连接管理和具体的发送。

* 数据同步

数据同步实现平台和堡垒机、ASCG、DataServer等能力组件之间的数据同步，由平台适配能力组件的接口把数据推送给各能力组件。

* 定时任务

提供系统运行日志清理、配置备份、堡垒机状态周期查询等定时和周期执行的任务。

* 帐号采集服务

帐号采集服务为后台服务，实现从目标资源采集帐号到平台。

* 帐号改密服务

帐号改密服务为后台服务，实现修改目标资源上帐号的密码的功能。

* 升级服务

升级服务为后台服务，以root运行，实现升级包下载、服务升级和升级结果上报功能。

* 主备服务

主备服务为后台服务，完成主备机器之间的状态监控、主备机之间的数据同步和事件处理功能。

* 进程守护服务

进程守护服务提供对所有前端服务、后端服务、中间件和后台服务的进程进行监控和启停，当监控到服务异常时进行服务重启，最多尝试重启三次，最大程度保证业务连续性。

进程守护服务采用supervisor。

* 通知服务

通知服务用于订阅前台服务发送的提醒、告警、验证码等事件，完成事件和提醒、告警、验证码模板的整合，形成以明确的通知方式的通知内容，以事件的方式把内容发送到消息中心，由短信服务、邮件服务等服务订阅并完成提醒、告警和验证码的发送。
