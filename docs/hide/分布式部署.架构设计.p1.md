---
created: 2023-09-20
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 分布式部署.架构设计.p1
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 分布式部署.架构设计.p1
platform: true
category: hide
---

### 分布式部署

![[../assets/img/Pasted image 20230920141412.png|Pasted image 20230920141412]]

分布式部署的情况下，优先安装DB、缓存中心和消息中心，在安装其他服务的时候必须指定DB、缓存中心和消息中心的地址。

各服务安装后，主动上报自身地址到缓存中心，由缓存中心统一维护所有服务的地址（DB地址除外），供API网关路由查找各服务时使用，同时向消息中心上报服务地址。

* 服务地址变更

系统管理所在的服务器，通过前端界面修改本服务器地址，驱动后台系统配置服务完成本服务地址变更、向消息中心上报地址变更事件、更新缓存中心缓存的本服务的地址。

其他服务所在的服务器，通过后台管理菜单修改服务器地址，同样驱动系统配置服务完成本服务器的地址变更，其他逻辑与界面修改地址相同。

当服务地址变更时，被通知者的系统配置服务订阅消息中心其他服务地址变更事件，并更新本地的host文件，用于各服务交互通信时使用。各服务通信时使用域名进行通信，不使用IP地址，避免IP地址变更导致的频繁切换访问地址。

* 部署约束

分布式部署情况下，以下服务要和系统管理部署在同一个服务器上

1) 系统日志服务，系统管理提供管理界面需要下载系统日志服务在本机记录的日志。

2) NTP时间服务器和系统管理部署在一台服务器上，方便通过界面配置NTP。

* 时间配置

系统管理所在的服务器安装NTP时间服务器，通过系统管理可以实现以下几种方式的时间配置。

1） 以国家授权中心时间为准

2） 以我们部署的NTP服务器时间为准

3） 手工配置时间

分布式部署情况下，其他服务器作为客户端同步系统管理所在的服务器的时间，无论以上哪种方式配置时间，都可以达到分布式的各服务器时间一致的效果。

* 安全性考虑

分布式部署情况下，消息中心和缓存中心考虑通过IP绑定和使用非默认端口的方式实现安全控制，防止外部地址非法访问和恶意扫描。
