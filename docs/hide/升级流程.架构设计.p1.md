---
created: 2023-09-20
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 升级流程.架构设计.p1
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 升级流程.架构设计.p1
platform: true
category: hide
---

### 升级流程

系统升级考虑单机部署和分布式部署情况下的升级，以下以分布式情况下的升级为准进行描述，单机部署升级流程相同。

系统升级涉及系统升级前端、后端、消息中心和后台升级服务。

![[../assets/img/Pasted image 20230920134916.png|Pasted image 20230920134916]]

1） 系统升级前端上传升级包，完成升级文件前端校验，调用系统升级后端服务，由后端服务完成升级包上传和存储；

2） 后端服务发送升级通知到消息中心；

3） 后台升级服务订阅升级通知；

4） 后台升级服务从缓存中心获取系统管理服务地址，调用系统升级后端的API下载升级包到本地，执行停容器、备份历史软件、根据本机安装的组件拷贝新软件覆盖安装、启容器等动作来实现相关服务升级；

5） 后台升级服务调用系统升级后端上报升级结果、版本号、升级详情；

6） 系统升级前端通过API轮询升级进度和升级结果。

以上流程中，前端、后台升级服务调用后端的API需要经过API网关，以上流程中未体现这些细节。

系统配置（网络、时间、电源）流程与系统升级类似，只是没有升级包下载动作。