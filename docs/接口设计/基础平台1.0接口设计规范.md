---
created: 2023-09-21
number headings: first-level 2, start-at 1, max 6, 1.1-
title: 基础平台1.0接口设计规范
author: 罗潇
cssclass: wideTable
first-level: 1
pdf-filename: 基础平台1.0接口设计规范
platform: true
category: 接口设计
---

## 1.1 **概****述**

### 1.1.1 **编写目的**

为了更好地推进前后端分离的技术理念，统一后端暴露API的方式、风格；在前后端解耦的原则下，即能保障接口开发的独立性，又能保障接口特性的一致性。该文档基于业界先进的使用理念，对RESTful API的命名方式、版本控制、请求、响应等相关细节做了统一性约束。具体细节请阅读后文中的描述。

### 1.1.2 **读者**

产品经理、项目经理、开发设计工程师、测试设计工程师、开发工程师、测试工程师；

### 1.1.3 **要求**

架构师：在产品系统层面做相关性设计、引导，保障规范的可落地性。

产品经理：在产品需求层面保障需求特性的细节内容同规范的一致性。

后端开发：严格遵循规范内容，保障平台暴露接口的一致性。

前端开发：严格遵循规范内容，保障平台暴露接口的一致性。

测试：严格按照规则内容对各模块暴露API进行规范性测试，保障平台暴露接口的一致性。

### 1.1.4 **相关术语**

|   |   |
|---|---|
|REST|一种基于HTTP协议的API约束规则|
|Resource||
|||

## 1.2 **设计****说****明**

### 1.2.1 **设计****目标**

* 保障前端、后端。测试（自动化）对接口一致性的要求

## 1.3 **基本约定**

### 1.3.1 **服务****地址**

[{schema}://{host}:{port}/{prefix}**/{version}/{resource}**](http://waf_ip:waf_port/api.version/rest/)

如：http://10.65.10.1:8080/api/v1/dashborads

| **字段** | **说明**                          |
| -------- | --------------------------------- |
| schema   | API接口支持的协议（http或https）  |
| host     | 提供API服务的主机名称或IP         |
| port     | 提供API服务的主机端口             |
| prefix   | 系统API服务的前缀，如/api         |
| version  | API的版本号，后文有具体的命名规则 |
| resource | 资源名称，后文有具体的命名规则    |

### 1.3.2 **命名****约束**

#### 1.3.2.1  **API命名**

API名称（资源名称）若无特殊需求场景，均要求采用小写加连字符命名。

* 仅限使用小写字母、数字、英文连字符（-）

* 单词之间以英文连字符（-）连接

如：/api/v1/asset-group/dev1

#### 1.3.2.2  **参数****命名**

API请求、响应参数中参数名称若无特殊需求场景，均要求采用小驼峰命名法，即：

* 仅限使用大小写字母、数字

* 单词要求首字母大写，但打头的单词小写

如：

{

  "groupName": "dev",

  "groupId": "82ec1585-89f5-48b9-818e-a16f43c09ed1"

}

### 1.3.3 **版本****控制**

API的版本控制由各API服务提供方进行控制，版本演进格式约定为：vN(N=1,2,3…)

如：v1, v2

_注__：__在因__产品__版本__演进__而导致__功能特性迭代__的__场景下，__同一特性__的__API__遵循版本升级策略，__以__做到向后兼容__，最大__限度保障__已有__业务逻辑的__可用性__。_

### 1.3.4 **资源名称**

REST接口通过资源（Resources）来暴露数据（data）和算法（algorithms），对资源名称的抽象拥有一定的方法论，可参考 [《Restful Web Services》](https://ieeexplore.ieee.org/document/5365234/) 中对此话题的描述。我们这里有以下约束规则：

1) 资源名称中不允许出现动词

2) 用路径遍历来表达资源的层次结构，如：/parent/child

3) 父级用资源的复数形式表示，如：/users/1234

4) 在路径变量里加上标点符号（仅限英文逗号和英文分号），以消除误解

如：/users/1,2 

5) 用查询变量（条件参数）表达算法的输入，如：/search?**page=1&num=20**

6) 资源名称为变量参数时，用{resourceId}表示

如：/users/{userId}

7) 资源名称中的"/"必须转义，否则可能会引起服务端错误地识别资源，例如：GET [http://1.1.1.1/api/v1/interfaces/G1/1 ，其中想表示G1/1](http://1.1.1.1/api/v1/interfaces/G1/1%20，其中想表示G1/1)资源，但服务端可能会错误地识别此资源。

8) 不允许以"/"作为API结尾

9) 资源名称为复数时，其响应必为列表；资源名称为单数时，其响应必为字典。

如：

GET /api/v1/users

响应为：
```json
[  
  {  
    "id": 1001,  
    "name": "john"  
  },  
  {  
    "id": 1002,  
    "name": ""  
  }  
]
```
GET /api/v1/users/profile

响应为：
```json
{
    "id":1001,
    "name": "john",
}
```

### 1.3.5 **认证****授权**

推荐使用token方式，将token放入header头即

Authorization：token

Token的生成有业务确定

### 1.3.6 **统一方法**

REST API操作使用统一的HTTP方法，以保证操作的一致性。具体限定如下：

| HTTP方法 | CRUD类型 | 描述                       | 实现约束   |
| -------- | -------- | -------------------------- | ---------- |
| POST     | CREATE   | 创建一个新的资源           | 视接口功能 |
| GET      | RETRIEVE | 获取指定资源的表示         | 视接口功能 |
| PUT      | UPDATE   | 更新指定资源               | 视接口功能 |
| DELETE   | DELETE   | 删除指定资源               | 视接口功能 |
| OPTIONS  | N/A      | 获取指定资源支持的HTTP方法 | 必须       |

### 1.3.7 **请求****约束**

* 资源的表示数据均以消息主体的形式隐式暴露，如新建用户时的用户数据

* 非资源的表示数据均以条件参数的形式显式暴露，如认证信息、过滤条件

² 条件参数：URL中跟在 ? 后面形如key1=value1**&**key2=value2的参数，其编码格式为：application/x-www-form-urlencoded

² 如果无特殊说明请求content-type用json 即Content-Type: application/json

### 1.3.8 **响应****约束**

如调用方在请求头Accept中无具体指定，所有API响应数据类型默认为：application/json；否则以请求头中Accept指定的数据格式响应。其它约束规则如下：

* 以HTTP标准响应码为API调用成功与否的唯一判断依据

* API调用成功，则响应数据为请求资源本身的描述，特定场景详见：[[基础平台1.0接口设计规范#1.4 特定场景约定|1.4 特定场景约定]]

* API调用失败，则响应数据为失败描述

* 仅在获取单一资源对象时，响应结果使用字典

如：GET /api/v1/dashboards/asset

* 获取结果是多资源对象时，响应结果使用数组

如：GET /api/v1/dashboards

#### 1.3.8.1  **报文示例**

**成功**：

HTTP/1.1 200 OK

Content-Type: application/json; charset="UTF-8"

Content-Length: XXXX

```json
{
"id": 0,
"userName": "john",
"email": "123@",
}
```

**失败**：

HTTP/1.1 500 INTERNAL SERVER ERROR

Content-Type: application/json; charset="UTF-8"

Content-Length: XXXX

```json
{

"code": 3,

"message": "参数不合法",

"details": [],

}
```

#### 1.3.8.2  **报文****说明**

| 消息头部 | 响应码                                                   | 标准的HTTP响应码，仅2xx表示请求成功，请求成功时消息体为响应数据域 |
| -------- | -------------------------------------------------------- | ----------------------------------------------------------------- |
| 消息类型 | 若请求方未指定，默认为：application/json                 |                                                                   |
| 消息主体 | 响应码为2xx时，消息主体为响应数据域，非2xx时返回如下结构 |                                                                   |
| code     | 异常错误码                                               |                                                                   |
| message  | 异常错误描述信息                                         |                                                                   |
| detail   | 异常的补充描述信息 非必须                                |                                                                   |

#### 1.3.8.3  **统一****约束**

| **HTTP方法** | **响应数据**    | **描述**                                    |
| ------------ | --------------- | ------------------------------------------- |
| POST         | Resource Format | Response-body域包含新建资源的完整表示(可选) |
| GET          | Resource Format | Response-body域包含指定资源的请求表示(可选) |
| PUT          | Resource Format | Response-body域包含指定资源的完整表示(可选) |
| DELETE       | N/A             | Response-body域无资源表示数据               |
| OPTIONS      | N/A             | 无响应消息主体                              |

### 1.3.9 **错误码**

错误码用于在系统出现异常、错误、故障等非正常状态时，保障对外暴露问题的一致性，统一由前端根据错误码描述信息展示对应的Tip信息。

另，错误码信息会出现在调试日志中，要求合理使用错误码，为精准定位、分析问题服务，切勿滥用。

此部分具体错误码参照附录部分

### 1.3.10 **错误重试**

客户端应该在遇到500，503和504错误的时候重试。 最小延迟应为1s，除非另有说明。 对于429错误，客户端可能会以最少30秒的延迟重试。对于所有其他错误，重试可能不适用-首先确保您的请求是幂等的，并检查错误消息指引。

### 1.3.11 **字符集****约定**

* REST接口请求、响应数据默认均以UTF-8字符集编码。

* 如果请求头无Accept-Charset字段，则响应为默认编码；否则，以请求编码响应。

如：Accept-Charset: GB2312,utf-8;q=0.7,*;q=0.7

### 1.3.12 **JSONP****支持**

若在某些特定场景中需要使用JSONP，遵循以下约束即可：

* 支持JSONP的API必须在条件参数中暴露callback关键字，如：callback=callbackFunc

* 支持JSONP的API必须指定响应头参数：

Content-type: application/javascript

### 1.3.13 **国际化****支持**

简体中文：zh_CN

繁体中文：zh_TW

英文    ：en_US

API的国际化要支持页面直接调用（无法指定HTTP头）、跨域调用（无法指定Cookie）的场景，因此要支持以下两种方式（默认为简体中文）：

* 在HTTP请求头中由Accept-Language字段表示，如：

Accept-Language: zh-cn,zh;q=0.5

* 在条件参数中表示，如: locale=zh_CN

 

### 1.3.14 **资源表示****约束**

API的请求、响应参数以JSON表示时：

* 字符型参数中不允许出现数字表示

* 参数值要求能见名知意，具有可读性

* 布尔型参数不允许以字符串形式表示

* 空值统一以空字符串表示：""，不允许出现null, undefined, None等

* 时间统一以Linux秒级时间戳表示

### 1.3.15 **404使用****约束**

HTTP标准响应码404用于表示访问的资源对象不存在，即URL不存在，并不适用检索、筛选场景下未找到匹配的数据，切勿滥用404。示例如下：

1. GET /api/v1/dashboards/asset/top-10-assets-by-risk

2. GET /api/v1/views?viewId=top-10-assets-by-risk

其中，请求1表示获取资产仪表板下视图top-10-assets-by-risk的数据，响应码为404时表示不存在这个视图。

请求2表示从全部视图中检索标识为top-10-assets-by-risk的视图，响应码为404时表示/api/v1/views对应的资源对象不存在，并不能用于表示没有找到标识为top-10-assets-by-risk的视图;若要标识没有找到，只需在响应数据中将结果集置为空即可。

### 1.3.16 **取值****约束**

#### 1.3.16.1 **数据****类型**

REST API以JSON数据作为载体，因此在接口的请求、响应报文中，凡是参数取值的数据类型不应超出以下类型（在JSON的表达能力之内）：

| 数据类型    | 描述                                            | 示例                          |
| ----------- | ----------------------------------------------- | ----------------------------- |
| **String**  | 字符型；双引号包裹的Unicode字符和反斜杠转义字符 | "hello"<br><br>"\u4f60\u597d" |
| **Number**  | 数值型；双精度浮点型格式                        | 1234<br><br>123.22            |
| **Boolean** | 布尔型；true 或 false                           | true<br><br>false             |
| **Object**  | 对象型；无序的键值对集合                        | {"a":1, "b":true}             |
| **Array**   | 数据型；有序的值序列                            | [1,2,3,4]                     |
| **null**    | 空                                              | null                          |

#### 1.3.16.2 **空值**

如上，JSON定义了一种数据类型null，用来表示空（什么都没有）。在其它大多数编程语言中，也有许多类似的表示，如：Null,NULL,nil,None。为了保证接口的一致性，对空值做如下约束：

* 字符型参数空值：""

* 数值型参数空值：0

* 对象型参数空值：{}

* 数组型参数空值：[]

* 布尔型数据不允许存在空值

_注__：此条约定需在做数据表设计、数据插入\__编辑__时__设定__默认值。_

#### 1.3.16.3 **日期****\****时间约定**

通常情况下，对于日期\时间在不同的国家、不同的业务场景下会有相当多种类的不同表示，为保证接口的一致性，对日期\时间做如下约束：

* 接口层面统一使用GMT/UTC时间戳（即Unix时间戳）传递日期\时间

* 建议后端时间存储也采用GMT/UTC时间戳方案

* 前端根据用户的时区、业务场景自行处理呈现

* 时间戳可按具体的业务场景选择秒级、毫秒级

## 1.4 特定场景约定

### 1.4.1 **分页排序**

分页排序在前后端交互过程中极为普遍，为保障不同模块前后端间交互的一致性，对此场景的请求响应做如下约束：

请求约束：

* 分页参数：?**page**=5&**size**=100

* 排序参数：?**orderBy**=field1,-field2,field3

* 筛选参数：?**field1**=1&**field2**=2

参数说明：

| **参数** | **描述**                                                                                                                                                                                                                                                 |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| page     | 指定请求的页数，如page=5表示请求第5页的数据                                                                                                                                                                                                              |
| size     | 指定每页的数量，如size=100表示每页限定100条数据                                                                                                                                                                                                          |
| orderBy  | 指定排序的字段，需要多值排序时，多个字段以英文逗号分隔，默认为升序排序，排序优先级自左至右降低；字段名称前以英文连字符打头时，表明按该字段值降序排序。<br><br>如：**orderBy**=field1,-field2,field3表示按字段field1升序,field2降序，field3升序进行排序。 |
| fieldN   | 指定其它筛选条件的字段                                                                                                                                                                                                                                   |

响应约束：
```json
{  
  "page": 5,  
  "size": 100,  
  "orderBy": "field1,-field2,field3",  
  "total": 110000,  
  "data": [  
    {},  
    {}  
  ]  
}
```

参数说明：

| **参数** | **描述**                                                           | 
| -------- | ------------------------------------------------------------------ |
| page     | 客户端指定的请求页数，必须项                                       |
| size     | 客户端指定的每页数量，必须项                                       |
| orderBy  | 客户端指定的排序字段，如客户端有指定则为必须项                     |
| total    | 符合客户端筛选条件的数据总条数                                     |
| data     | 客户端指定页数的数据内容，若没有符合筛选条件的数据，则以空数组表示 |

### 1.4.2 **树形****结构**

树形结构也是在前后端交互过程中极为普遍的一种数据结构，同理也对其数据结构做如下约束：

示例：
```json
[  
  {  
    "id": 1,  
    "name": "全部",  
    "parent": null,  
    "children": [  
      {  
        "id": 2,  
        "name": "主机资产",  
        "parent": 1,  
        "children": [  
          {  
            "id": 3,  
            "name": "研发一部",  
            "parent": 3  
          }  
        ]  
      },  
      {  
        "id": 4,  
        "name": "网站资产",  
        "parent": 1,  
        "children": []  
      }  
    ]  
  }  
]
```

参数说明：

| 参数     | 描述                                         |
| -------- | -------------------------------------------- |
| id       | 节点唯一标识，同一颗树种不允许重复           |
| name     | 节点名称                                     |
| parent   | 节点父节点的唯一标识，根节点父节点取值为null |
| children | 节点的子节点，列表                           |

## 1.5 **附录**

### 1.5.1 **HTTP****常用****响应码·**

| 响应码 | 描述                                                                                                                             | 
| ------ | -------------------------------------------------------------------------------------------------------------------------------- |
| 200    | OK – 操作顺利完成                                                                                                                |
| 201    | Created – 客户端请求成功创建了一个新资源时，可发送此响应码                                                                      |
| 204    | No Content – 服务器端拒绝对PUT、POST或DELETE请求返回任何状态信息或表示，可发送此响应码                                           |
| 301    | Moved Permanently – 客户端触发的动作引起资源URI变化时发送此响应码，或者客户端请求一个资源的旧url时也发送此响应码                 |
| 400    | Bad Request – 客户端请求参数不合法                                                                                               |
| 401    | Unauthorized – 客户端试图操作一个受保护资源，却又没有提供正确的认证证书，可发送此响应码                                          |
| 403    | Forbidden – 客户端请求正确，认证也正确，但由于请求资源只允许在指定时间段内，或者只允许指定IP的用户访问，可发送此响应码           |
| 404    | Not Found – 客户端请求的资源不存在                                                                                               |
| 405    | Method Not Allowed – 客户端试图使用一个本资源不支持的HTTP方法时，可发送此响应码                                                  |
| 409    | Conflict – 客户端试图执行一个“会导致一个或多个资源处于不一致状态”的操作时，可发送此响应码                                        |
| 410    | Gone – 服务器知道被请求资源曾经指向一个资源，但该资源现在不存在了，可发送此响应码                                                |
| 413    | Request Entity Too Large – 客户端发送的表示太大以至于服务器无法处理时，可发送此响应码                                            |
| 414    | Request-URI Too Long – 客户端请求URL长度超过服务端处理能力时，可发送此响应码                                                     |
| 415    | Unsupported Media Type – 客户端在发送表示时采用了一个服务端无法理解的媒体类型，可发送此响应码                                    |
| 500    | Internal Server Error – 服务器端发生未知故障                                                                                     |
| 503    | Service Unavailable – 服务器正常，但由于下层服务不正常（如系统资源不足或正在遭受大量恶意请求）以至于不能全部处理，可发送此响应码 |

 

### 1.5.2 **错误码****分配表**

| 错误码段      | 模块名称                                |
| ------------- | --------------------------------------- |
| 0 - 9999      | 平台框架使用 参照下面表格中定义的错误码 |
| 10000 - 99999 | 其它模块使用 有业务自己定义             |
| ……            | ……                                      |

下面列举了状态码code及http 对应关系，该状态码已覆盖大部分场景

| **错误码 code** | **对应http状态码** | **错误描述**                                                                                                            |
| --------------- | ------------------ | ----------------------------------------------------------------------------------------------------------------------- |
| 0               | 200                |                                                                                                                         |
| 1               | 499                | CANCELLED：操作被取消                                                                                                   |
| 2               | 500                | UNKNOWN-未知的错误。 通常是服务器错误                                                                                   |
| 3               | 400                | INVALID_ARGUMENT-客户端指定了无效的参数。 检查错误消息和错误详细信息以获取更多信息。                                    |
| 4               | 504                | DEADLINE_EXCEEDED已超过请求期限。如果重复发生，请考虑降低请求的复杂性。                                                 |
| 5               | 404                | NOT_FOUND找不到指定的资源                                                                                               |
| 6               | 409                | ALREADY_EXISTS客户端尝试创建的资源已存在。                                                                              |
| 7               | 403                | PERMISSION_DENIED客户端没有足够的权限。这可能是因为OAuth令牌没有正确的范围，客户端没有权限，或者客户端项目尚未启用API。 |
| 8               | 429                | RESOURCE_EXHAUSTED资源配额达到速率限制。如磁盘已满                                                                      |
| 9               | 400                | FAILED_PRECONDITION失败具有前提条件<br><br>请求不能在当前系统状态下执行，例如删除非空目录。                             |
| 10              | 409                | ABORTED并发冲突，例如读-修改-写冲突                                                                                     |
| 11              | 400                | OUT_OF_RANGE客户端指定了无效的范围。                                                                                    |
| 12              | 501                | UNIMPLEMENTED服务器未实现该API方法。                                                                                    |
| 13              | 500                | INTERNAL内部服务错误。 通常是服务器错误。                                                                               |
| 14              | 503                | UNAVAILABLE暂停服务。通常是服务器已经关闭。                                                                             |
| 15              | 500                | DATA_LOSS不可恢复的数据丢失或数据损坏。 客户端应该向用户报告错误                                                        |
| 16              | 401                | UNAUTHENTICATED由于遗失，无效或过期的OAuth令牌而导致请求未通过身份验证。                                                |

### 1.5.3 **参考文档**

规范：

a) [RESTful Web Service](https://ieeexplore.ieee.org/document/5365234/)

b) [https://cloud.google.com/apis/design/](https://cloud.google.com/apis/design/)

实例：

c) [https://docs.github.com/en/rest/reference/repos](https://docs.github.com/en/rest/reference/repos)

d) [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20)
